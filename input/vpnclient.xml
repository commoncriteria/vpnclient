<?xml version="1.0" encoding="utf-8"?>
<?xsl-stylesheet type="text/xsl" href="../transforms/module/module2html.xsl"?>

<?xml-model href="https://github.com/commoncriteria/transforms/raw/master/schemas/CCModule.rng" type="application/xml" schematypens="http://relaxng.org/ns/structure/1.0"?>

<Module boilerplate="yes" target-products="Virtual Private Network (VPN) Clients" xmlns="https://niap-ccevs.org/cc/v1" name="Virtual Private Network (VPN) Clients" xmlns:h="http://www.w3.org/1999/xhtml">
  <PPReference>
    <ReferenceTable>
      <PPVersion>2.2</PPVersion>
      <PPAuthor>National Information Assurance Partnership</PPAuthor>
      <PPPubDate>2021-01-05</PPPubDate>
      <Keywords>VPN, VPN Client</Keywords>
    </ReferenceTable>
  </PPReference>
  <RevisionHistory>
    <entry>
      <version>2.1</version>
      <date>2019-11-14</date>
      <subject>Initial Release</subject>
    </entry>
  </RevisionHistory>

  <!-- 1.0 Introduction -->
  <chapter title="Introduction" id="int">
    
    <!-- 1.1 Overview -->
    <section title="Overview" id="ppoverview">
      The scope of this PP-Module is to describe the security functionality of a virtual private network (VPN)
      client in terms of  <cite linkend="bibCC"/> and to define functional and assurance requirements for such
      products. This PP-Module is intended for use with the following Base-PPs:

      <h:ul>
        <h:li>Protection Profile for General Purpose Operating Systems (OS PP), Version 4.2.1</h:li>
        <h:li>Protection Profile for Mobile Device Fundamentals (MDF PP), Version 3.1</h:li>
        <h:li>Protection Profile for Application Software (App PP), Version 1.3</h:li>
        <h:li>Protection Profile for Mobile Device Management (MDM PP), Version 4.0</h:li>
      </h:ul>

      These Base-PPs are all valid because a VPN client may be a specific type of stand-alone software
      application or a built-in component of an operating system, whether desktop or mobile. Regardless of
      which Base-PP is claimed, the VPN client functionality defined by this PP-Module will rely on the Base-PP.
      Sections 5.1, 5.2, and 5.3 of this PP-Module describe the relevant functionality for each Base-PP,
      including specific selections, assignments, or inclusion of optional requirements that must be made as
      needed to support the VPN client functionality.
     </section>

    <!-- 1.2 Terms -->
    <!-- 1.2.1 Common Criteria Terms -->
      <!-- Boilerplate -->
    <!-- 1.2.2 Technology Terms  -->
    <tech-terms>
      <term full="Administrator">
        A user that has administrative privilege to configure the TOE in privileged
        mode. </term>
      <term full="Authorized">
        An entity granted access privileges to an object, system or system entity.
      </term>
      <term abbr="CSP" full="Critical Security Parameter">
        Security related information, e.g. secret and private cryptographic keys, and
        authentication data such as passwords and PINs, whose disclosure or
        modification can compromise the security of a cryptographic module. </term>
      <term full="Entropy Source">
        This cryptographic function provides a seed for a random number generator
        by accumulating the outputs from one or more noise sources. The
        functionality includes a measure of the minimum work required to guess a
        given output and tests to ensure that the noise sources are operating
        properly.
      </term>
      <term full="IT Environment">
        Hardware and software that are outside the TOE boundary that support the
        TOE functionality and security policy. </term>
      <term full="Operational Environment">
        The environment in which the TOE is operated.</term>
      <term full="Private Network">
        A network that is protected from access by unauthorized users or entities.
      </term>
      <term full="Privileged Mode">
        A TOE operational mode that allows a user to perform functions that require
        IT Environment administrator privileges.
      </term>
      <term full="Public Network">
        A network that is visible to all users and entities and does not protect against
        unauthorized access (e.g. internet).
      </term>
      <term full="Threat Agent">
        An entity that tries to harm an information system through destruction,
        disclosure, modification of data, and/or denial of service.</term>
      <term full="Unauthorized User">
        An entity (device or user) who has not been authorized by an authorized
        administrator to access the TOE or private network.
      </term>
      <term full="Unprivileged Mode">
        A TOE operational mode that only provides VPN client functions for the VPN
        Client user. </term>
      <term full="VPN Client">
        The TOE; allows remote users to use client computers to establish an
        encrypted IPsec tunnel across an unprotected public network to a private
        network.
      </term>
      <term full="VPN Client User">
        A user operating the TOE in unprivileged mode.</term>
      <term full="VPN Gateway">
        A component that performs encryption and decryption of IP packets as they
        cross the boundary between a private network and a public network. </term>
      <term abbr="AES" full="Advanced Encryption Standard"/>
      <term abbr="CRL" full="Certificate Revocation List"/>
      <term abbr="DH" full="Diffie-Hellman"/>
      <term abbr="DN" full="Distinguished Name"/>
      <term abbr="DSS" full="Digital Signature Standard"/>
      <term abbr="ECC" full="Elliptic Curve Cryptography"/>
      <term abbr="ESP" full="Encapsulating Security Protocol"/>
      <term abbr="EUD" full="End-User Device"/>
      <term abbr="FFC" full="Finite Field Cryptography"/>
      <term abbr="FIPS" full="Federal Information Processing Standards"/>
      <term abbr="FQDN" full="Fully Qualified Domain Name"/>
      <term abbr="OS" full="(General Purpose) Operating System"/>
      <term abbr="ICMP" full="Internet Control Message Protocol"/>
      <term abbr="IKE" full="Internet Key Exchange"/>
      <term abbr="IP" full="Internet Protocol"/>
      <term abbr="IT" full="Information Technology"/>
      <term abbr="MD" full="Mobile Device (Fundamentals)"/>
      <term abbr="NAT" full="Network Address Translation"/>
      <term abbr="NIST" full="National Institute of Standards and Technology"/>
      <term abbr="OCSP" full="Online Certificate Status Protocol"/>
      <term abbr="OS" full="Operating System"/>
      <term abbr="OSP" full="Organizational Security Policy"/>
      <term abbr="PP" full="Protection Profile"/>
      <term abbr="PUB" full="Publication"/>
      <term abbr="RBG" full="Random Bit Generation"/>
      <term abbr="RFC" full="Request For Comment"/>
      <term abbr="SA" full="Security Association"/>
      <term abbr="SD" full="Supporting Document"/>
      <term abbr="SHA" full="Secure Hash Algorithm"/>
      <term abbr="SPD" full="Security Policy Database"/>
      <term abbr="TCP" full="Transmission Control Protocol"/>
      <term abbr="UDP" full="User Datagram Protocol"/>
      <term abbr="VPN" full="Virtual Private Network"/>
    </tech-terms>
    
    <!-- 1.3 Compliant Targets of Evaluation -->
    <section title="Compliant Targets of Evaluation" id="TOEdescription">
      The TOE defined by this PP-Module is the VPN client, a software application that runs on a physical or
      virtual host platform, used to establish a secure IPsec connection between that host platform and a
      remote system. The VPN client is intended to be located outside or inside of a private network, and
      establishes a secure tunnel to an IPsec peer. For the purposes of this PP-Module, IPsec peers are defined
      as:

      <h:ul>
        <h:li>VPN gateways</h:li>
        <h:li>Other VPN clients</h:li>
        <h:li>An IPsec-capable network device (supporting IPsec for the purposes of management)</h:li>
      </h:ul>

      The tunnel provides confidentiality, integrity, and data authentication for information that travels across
      a less trusted (sometimes public) network. All VPN clients that comply with this document will support
      IPsec.<h:p/>

      This PP-Module extends the GPOS PP when the VPN client is installed on an operating system discussed
      in that PP (e.g., Windows, Mac OS, Linux). This PP-Module extends the MDF PP when the VPN client is
      installed on a self-contained mobile device that is bundled with an operating system (e.g. Android,
      BlackBerry OS, iOS, Windows Mobile). This PP-Module extends the App PP when the VPN client is
      provided by a third party and is a standalone application that is not a bundled part of an operating
      system or mobile device. This PP-Module extends the MDM PP when the VPN Client is included with
      MDM Server software that is used for centralized deployment and administration of enterprise mobile
      device policies.  <h:p/>

      As a PP-Module of any of these PPs, it is expected that the content of this PP-Module and the chosen
      Base-PP be appropriately combined in the context of each product-specific Security Target. This PPModule has been specifically defined such that there should be no difficulty or ambiguity in doing so.
      When this PP-Module is used, conformant TOEs are obligated to implement the functionality required in
      the claimed Base-PP with the additional functionality defined in this PP-Module in response to the
      threat environment discussed subsequently herein.

      <!-- 1.3.1 TOE Boundary -->
      <subsection title="TOE Boundary" id="TOEboundary">
      The TOE defined by this PP-Module is purely a software solution executing on a platform (some sort of
      operating system running on hardware). Depending on the Base-PP claimed as part of the TOE, the
      platform may also be part of the TOE or it may be an environmental component that the TOE vendor has
      no control over. Regardless of whether the platform itself is within the scope of the evaluation, the VPN
      client itself will rely on the platform for its execution domain and proper usage. The vendor is expected
      to provide sufficient installation and configuration instructions to identify an Operational Environment
      with the necessary features and to provide instructions for how to configure it correctly.<h:p/>

      The PP-Module contains requirements that must be met by the TOE. Depending on the Base-PP that is
      claimed, there may be some variation in the applicable requirements. This is because a given Base-PP
      may include one or more requirements that the VPN client can inherit but are not shared amongst each
      possible Base-PP.<h:p/>

      This is somewhat different than other PPs, but addresses most implementations of VPN clients where
      some part of the functionality of the IPsec tunnel is provided by the platform. In terms of the
      cryptographic primitives (random bit generation, encryption/decryption, key generation, etc.) it is
      actually desirable that a well-tested implementation in the platform is used rather than trying to
      implement these functions in each client.<h:p/>

      Requirements that can be satisfied by either the TOE or the platform are identified in Section 5 by text
      such as “The [selection: TSF, TOE platform] shall…” The ST author will make the appropriate selection
      based on where that element is implemented. It is allowable for some elements in a component to be 
      implemented by the TOE, while other elements in that same component be implemented by the
      platform (requirements on the usage of X.509 certificates is an example of where this might be the case,
      where using the information contained in the certificates and the implementation of revocation
      checking may be done by the TOE, but storage and protection of the certificates may be done by the
      platform). Note that in the cases where this PP-Module is used to extend the GPOS PP or MDF PP, the
      TOE includes both the VPN client and the platform. In this case, it is appropriate to indicate that the TOE
      satisfies this requirement. However, the ST author should make it clear, for each of these components,
      which are implemented by the VPN client portion of the TOE versus the platform portion.<h:p/>

      A Supporting Document (SD) accompanies this PP-Module and contains guidance for how to evaluate
      the requirements defined by the PP-Module, expressed as Evaluation Activities (EAs). EAs will differ
      based on where the function that meets the requirement is implemented. In most cases, requirements
      implemented by the platform will require that the evaluator examine documents pertaining to the
      platform (generally the ST), while requirements implemented by the TOE may require examination of
      the TSS, examination of the Operational Guidance, and/or execution of evaluator testing. For
      requirements implemented by the platform there may also be requirements that the evaluators
      examine the interfaces used by the TOE to access these functions on the platform to ensure that the
      functionality being invoked to satisfy the requirements of this PP-Module is the same functionality that
      was evaluated.<h:p/>

      Given the degree of coupling between a VPN client and its underlying platform, it is expected that the
      client will be tested on each platform claimed in the ST. In cases where the platforms are simply
      different versions of the same operating system (provided by the same platform vendor), an equivalency
      argument may be made in lieu of testing on each version. The argument would have to demonstrate
      that the client interacts in exactly the same way with the versions of the OS - e.g., same APIs are used
      with the same parameters, the network stack is modified with exactly the same kernel modules. The
      evaluator uses the operational guidance to configure the TOE and underlying platform.<h:p/>

      A TOE that conforms to this PP-Module will implement the Internet Engineering Task Force (IETF)
      Internet Protocol Security (IPsec) Security Architecture for the Internet Protocol, RFC 4301, as well as
      the IPsec Encapsulating Security Payload (ESP) protocol. IPsec ESP is specified in RFC 2406 and RFC 4303.
      The IPsec VPN client will support ESP in either tunnel mode, transport mode, or both modes.  <h:p/>

      The IPsec VPN client will use the Internet Key Exchange (IKE)v1 protocol, IKEv2, or both. IKEv1 is
      implemented as defined in RFCs 2407, 2408, 2409, 4109, and IKEv2 is implemented as specified in RFC
      7296 (with mandatory support for NAT traversal as specified in section 2.23) and 4307 to authenticate
      and establish session keys with the VPN entities. <h:p/>

      In order to show that the TSF implements the RFCs correctly, the evaluator will perform EAs
      documented in the Supporting Document that accompanies this PP-Module. In future versions of this
      PP-Module, EAs may be augmented, or new ones introduced that cover more aspects of RFC compliance
      than is currently described in this publication.<h:p/>

      The IPsec VPN client enables encryption of all information that flows between itself and its IPsec peer.
      The VPN client serves as an endpoint for an IPsec VPN connection and performs a number of
      cryptographic functions related to establishing and maintaining that connection. If the cryptography
      used to perform endpoint authentication, generate keys, and encrypt information is sufficiently robust
      and the implementation has no critical design mistakes, an adversary will be unable to exhaust the
      encryption key space to obtain the data. Compliance with IPsec standards, use of a properly seeded
      Random Bit Generator (RBG), and secure authentication factors will ensure that access to the 
      transmitted information cannot be obtained with less work than a full exhaust of the key space. Any
      plaintext secret and private keys or other cryptographic security parameters will be zeroized when no
      longer in use to prevent disclosure of security critical data.
      </subsection>
    </section>
    
    <!-- 1.4 Use Cases -->
    <section title="Use Cases" id="usecases">
      A VPN client allows users on the TOE platform to establish secure IPsec communications, providing
      confidentiality, integrity, and protection of data, across a less trusted network in order to secure data in
      transit. This PP-Module defines three use cases for VPN clients. A conformant TOE will implement one or
      more of the use cases specified below:<h:p/>
      
      <usecases>
        <usecase id="usecase1" title="TOE to VPN Gateway">
          <description>A VPN client allows users on the TOE platform to establish an encrypted IPsec tunnel across a
            less trusted, often unprotected public, network to a private network (see Figure 1). In this case,
            the TOE provides encryption/decryption of network packets as they leave/arrive the VPN client’s
            underlying platform. IP packets crossing from the private network to the public network will be
            encrypted if their destination is a remote access VPN client supporting the same VPN policy as
            the source network. <h:p/>
            The TOE is responsible for encrypting the packets that are intended to be received by the target
            on the private network and then encapsulating these packets in a way that allows the VPN
            gateway to securely receive them and forward them to their final destination.
            <figure entity="images/usecase1.png" title="TOE to VPN Gateway" id="fig-usecase1"/>
			<figref ref-id="fig-usecase1"/>
          </description>
        </usecase>

          <usecase id="usecase2" title="TOE to VPN Client">
            <description>A VPN client may additionally or alternatively allow a client computer to connect directly to
              another computer running a VPN client (see Figure 2). In this case, the functionality of the VPN
              client is to connect directly to another endpoint system in order to facilitate communications
              directly to that system.<h:p/>
              IPsec transport mode is used for end-to-end communications. In this use case, the content of
              the packet data (payload) is encrypted but the original IP header is preserved. Inherent to this
              use case, when two peers are communicating directly, is the disclosure of the
              source/destination of the packets. Users should take into consideration any security risks
              associated with this disclosure when architecting their networks in line with this use case.
              <figure entity="images/usecase2.png" title="TOE to VPN Client" id="fig-usecase2"/>
			  <figref ref-id="fig-usecase2"/>
            </description>
          </usecase>

        <usecase id="usecase3" title="TOE to IPsec-capable Network Device">
          <description>Similar to Use Case 2 above, a VPN client TOE can also be used to establish a secure connection
            to an IPsec-capable network device using IPsec, similar to how SSH can be used. In this case,
            where a network device is being managed remotely over an IPsec connection, the network
            device itself must contain IPsec functionality to act as the peer for the connection (see Figure 3).
            <h:p/>
            While this will behave functionally the same way as the scenario described by Use Case 2, the
            user of the TOE in Use Case 3 is a network administrator who is assumed to have administrative
            access to the network device they are connecting to.
            <figure entity="images/usecase3.png" title="TOE to IPsec-capable Network Device" id="fig-usecase3"/>
		    <figref ref-id="fig-usecase3"/>
          </description>
        </usecase>
      </usecases>

      Regardless of the specific usage of the TOE, the focus of the Security Functional Requirements in this PPModule
      is on the following fundamental aspects of a VPN client:
      <h:ul>
        <h:li>Authentication of the IPsec peer</h:li>
        <h:li>Cryptographic protection of data in transit</h:li>
        <h:li>Implementation of services</h:li>
      </h:ul>

      A VPN client can establish VPN connectivity either to a VPN gateway with traffic bound for a remote
      endpoint in the private network that is protected by the VPN gateway (Use Case 1), to a VPN client peer
      residing on a remote endpoint in the same network as the TOE (Use Case 2), and/or to a network device
      with IPsec capability for the purposes of managing that device (Use Case 3). In the first case, the entire
      IP packet is encapsulated and a new header is applied so that the gateway can route the packet to its 
      intended destination. This is known as tunnel mode. In the latter two cases, the original IP header is
      preserved and only the payload is encrypted. This is known as transport mode.<h:p/>

      Beyond the implementation differences specified by these use cases, the remaining security
      functionality is expected to be implemented by all VPN clients, regardless of whether it supports one or
      more of the use cases. Regardless of the intended use case, VPN endpoints authenticate each other to
      ensure they are communicating with an authorized external IT entity. Authentication of IPsec peers is
      performed as part of the Internet Key Exchange (IKE) negotiation. The IKE negotiation uses a pre-existing
      public key infrastructure for authentication and can optionally use a pre-shared key. When IKE
      completes, an IPsec tunnel secured with Encapsulating Security Payload (ESP) is established.<h:p/>

      It is assumed that the VPN client is implemented properly and contains no critical design mistakes. The
      VPN client relies on the system or device on which it is installed for its proper execution. The vendor is
      required to provide configuration guidance (AGD_PRE, AGD_OPE) to correctly install and administer the
      client machine and the TOE for every operational environment supported.
    </section>
  </chapter>
  
  <!-- 2. Conformance Claims -->
  <chapter title="Conformance Claims" id="ConformanceClaims">
    
    <!-- 2.1 CC Conformance -->
    <cclaims>
      <cclaim title="Conformance Statement">
        <description> This PP-Module inherits exact conformance as required from the specified Base-PPs and as defined
          in the CC and CEM addenda for Exact Conformance, Selection-Based SFRs, and Optional SFRs (dated
          May 2017).<h:br/><h:br/> 
          The following PPs and PP-Modules are allowed to be specified in a PP-Configuration with this PP-Module: <h:ul>
            <h:li>PP-Module for MDM Agents, Version 1.0</h:li>
            <h:li>PP-Module for File Encryption Enterprise Management, Version 1.0</h:li>
            <h:li>PP-Module for File Encryption, Version 2.0</h:li>
          </h:ul>
        </description>
      </cclaim>
      <cclaim title="CC Conformance Claims">
        <description>This PP-Module is conformant to Parts 2 (extended) and 3 (extended) of Common Criteria Version
          3.1, Revision 5 [CC] when App PP, GPOS PP, or MDF is the Base-PP. <h:p/>
          This PP-Module is conformant to Parts 2 (extended) and 3 (conformant) of Common Criteria Version
          3.1, Revision 5 [CC] when MDM PP is the Base-PP.
        </description>
      </cclaim>
      <cclaim title="PP Claim">
        <description>This PP-Module does not claim conformance to any Protection Profile.</description>
      </cclaim>
      <cclaim title="Package Claim">
        <description>This PP-Module does not claim conformance to any packages.</description>
      </cclaim>
    </cclaims>
  </chapter>
    
  <!-- Security Problem Description -->
  <chapter title="Security Problem Description" id="spd">
    The security problem is described in terms of the threats that the TOE is expected to address,
    assumptions about its operational environment, and any organizational security policies that the TOE is
    expected to enforce.<h:p/>
    This PP-Module is written to address the situation in which a user accesses a private network (e.g. the
    user’s office network) or terminal endpoint (e.g. a network device) using a less trusted network (such as
    a public Wi-Fi network or local area network). Protection of network packets is desired as they traverse
    a public network. To protect the data in-transit from disclosure and modification, a VPN is created to
    establish secure communications. The VPN client provides one end of the secure VPN tunnel and
    performs encryption and decryption of network packets in accordance with a VPN security policy
    negotiated between the VPN client (TOE) and its IPsec peer.<h:p/>
    The proper installation and configuration of the VPN client is critical to its correct operation such that
    proper handling of the TOE by an administrator is also addressed.<h:p/>
    Note that as a PP-Module, all threats, assumptions, and OSPs defined in the Base-PP will also apply to a
    TOE unless otherwise specified, depending on which of the Base-PPs it extends. The Security Functional
    Requirements defined in this PP-Module will mitigate the threats that are defined in the PP-Module but
    may also mitigate some threats defined in the Base-PPs in more comprehensive detail due to the
    specific capabilities provided by a VPN client.
    
    <!-- 3.1 Threats -->
    <section title="Threats" id="threats">
      The following threats defined in this PP-Module extend the threats defined by the Base-PPs.
      <threats>
        <threat id="T.UNAUTHORIZED_ACCESS">
          <description>This PP-Module does not include requirements that can protect against an insider threat. Authorized
            users are not considered hostile or malicious and are trusted to follow appropriate guidance. Only
            authorized personnel should have access to the system or device that contains the IPsec VPN client.
            Therefore, the primary threat agents are the unauthorized entities that try to gain access to the
            protected network (in cases where tunnel mode is used) or to plaintext data that traverses the
            public network (regardless of whether transport mode or tunnel mode is used). <h:p/>
            The endpoint of the network communication can be both geographically and logically distant from
            the TOE, and can pass through a variety of other systems. These intermediate systems may be under
            the control of the adversary, and offer an opportunity for communications over the network to be
            compromised. <h:p/>
            Plaintext communication over the network may allow critical data (such as passwords, configuration
            settings, and user data) to be read and/or manipulated directly by intermediate systems, leading to
            a compromise of the TOE or to the secured environmental system(s) that the TOE is being used to
            facilitate communications with. IPsec can be used to provide protection for this communication;
            however, there are myriad options that can be implemented for the protocol to be compliant to the
            protocol specification listed in the RFC. Some of these options can have negative impacts on the
            security of the connection. For instance, using a weak encryption algorithm (even one that is
            allowed by the RFC, such as DES) can allow an adversary to read and even manipulate the data on
            the encrypted channel, thus circumventing countermeasures in place to prevent such attacks.
            Further, if the protocol is implemented with little-used or non-standard options, it may be compliant 
            with the protocol specification but will not be able to interact with other, diverse equipment that is
            typically found in large enterprises. <h:p/>
            Even though the communication path is protected, there is a possibility that the IPsec peer could be
            duped into thinking that a malicious third-party user or system is the TOE. For instance, a
            middleman could intercept a connection request to the TOE, and respond to the request as if it were
            the TOE. In a similar manner, the TOE could also be duped into thinking that it is establishing
            communications with a legitimate IPsec peer when in fact it is not. An attacker could also mount a
            malicious man-in-the-middle-type of attack, in which an intermediate system is compromised, and
            the traffic is proxied, examined, and modified by this system. This attack can even be mounted via
            encrypted communication channels if appropriate countermeasures are not applied. These attacks
            are, in part, enabled by a malicious attacker capturing network traffic (for instance, an
            authentication session) and “playing back” that traffic in order to fool an endpoint into thinking it
            was communicating with a legitimate remote entity.</description>
          <objective-refer ref="O.AUTHENTICATION">
            <rationale>The TOE mitigates the threat of unauthorized access by requiring IPsec
              communications to be properly authenticated.
            </rationale>
          </objective-refer>
          <objective-refer ref="O.CRYPTOGRAPHIC_FUNCTIONS">
            <rationale>The TOE mitigates the threat of unauthorized access by implementing IPsec
              using strong cryptographic algorithms.
            </rationale>
          </objective-refer>
        </threat>

        <threat id="T.TSF_CONFIGURATION">
          <description> Configuring VPN tunnels is a complex and time-consuming process, and prone to errors if the
            interface for doing so is not well-specified or well-behaved. The inability to configure certain aspects
            of the interface may also lead to the mis-specification of the desired communications policy or use
            of cryptography that may be desired or required for a particular site. This may result in unintended
            weak or plaintext communications while the user thinks that their data are being protected. Other
            aspects of configuring the TOE or using its security mechanisms (for example, the update process)
            may also result in a reduction in the trustworthiness of the VPN client.</description>
          <objective-refer ref="O.KNOWN_STATE">
            <rationale>The TOE mitigates the threat of inadequate configuration by providing a management
              interface that allows all security-relevant functionality to be configured.</rationale>
          </objective-refer>
          <objective-refer ref="OE.TRUSTED_CONFIG">
            <rationale>This objective mitigates the threat of misconfiguration by ensuring that a
              malicious actor is not given direct administrative control over the TOE.</rationale>
          </objective-refer>
        </threat>

        <threat id="T.USER_DATA_REUSE">
          <description>Data traversing the TOE could inadvertently be sent to a different user; since these data may be
            sensitive, this may cause a compromise that is unacceptable. The specific threat that must be
            addressed concerns user data that is retained by the TOE in the course of processing network traffic
            that could be inadvertently re-used in sending network traffic to a user other than that intended by
            the sender of the original network traffic.
          </description>
          <objective-refer ref="O.NONDISCLOSURE">
            <rationale>The TOE mitigates the threat of data reuse by ensuring that persistently stored data is
              protected from unauthorized access, nonpersistently stored data is appropriately
              purged, and potentially to ensure that no network traffic is inadvertently transmitted
              outside of the IPsec tunnel.</rationale>
          </objective-refer>
        </threat>

        <threat id="T.TSF_FAILURE">
          <description> Security mechanisms of the TOE generally build up from a primitive set of mechanisms (e.g.,
            memory management, privileged modes of process execution) to more complex sets of
            mechanisms. Failure of the primitive mechanisms could lead to a compromise in more complex
            mechanisms, resulting in a compromise of the TSF.
          </description>
          <objective-refer ref="O.KNOWN_STATE">
            <rationale>The TOE mitigates the threat of TSF failure by enforcing the use of self-tests so that the
              TOE remains in a known state, and potentially to generate audit records that
              allow for potential failures to be diagnosed.</rationale>
          </objective-refer>
        </threat>
      </threats>
    </section>
    
    <!-- 3.2 Assumptions -->
    <section title="Assumptions" id="assumption">
      These assumptions are made on the operational environment in order to be able to ensure that the
      security functionality specified in the PP-Module can be provided by the TOE. If the TOE is placed in an
      operational environment that does not meet these assumptions, the TOE may no longer be able to
      provide all of its security functionality.
      <assumptions>
        <assumption id="A.NO_TOE_BYPASS">
          <description>Information cannot flow onto the network to which the VPN client's host is connected without
            passing through the TOE.
          </description>
          <objective-refer ref="OE.NO_TOE_BYPASS">
            <rationale>This assumption is satisfied by the environmental objective that ensures
              network routes do not exist that allow traffic to be transmitted from the TOE system to its
              intended destination without going through the TOE’s IPsec tunnel.</rationale>
          </objective-refer>
        </assumption>
        <assumption id="A.PHYSICAL">
          <description>Physical security, commensurate with the value of the TOE and the data it contains, is assumed to
            be provided by the environment.
          </description>
          <objective-refer ref="OE.PHYSICAL">
            <rationale>This assumption is satisfied by the environmental objective that ensures the
              TOE is not deployed on a system that is vulnerable to loss of physical custody.</rationale>
          </objective-refer>
        </assumption>
        <assumption id="A.TRUSTED_CONFIG">
          <description>Personnel configuring the TOE and its operational environment will follow the applicable security
            configuration guidance.
          </description>
          <objective-refer ref="OE.TRUSTED_CONFIG">
            <rationale>This assumption is satisfied by the environmental objective that ensures that
              anyone responsible for administering the TOE can be trusted not to misconfigure it,
              whether intentionally or not.</rationale>
          </objective-refer>
        </assumption>
      </assumptions>
    </section>
    
    <!-- 3.3 Organizational Security Policies -->
    <section title="Organizational Security Policies" id="osp"> 
      This PP-Module defines no additional organizational security policies beyond those defined in the
      supported Base-PPs.    
    </section>
  </chapter>
    
  <!-- 4. Security Objectives -->  
  <chapter title="Security Objectives" id="obj">
    
    <!-- 4.1 Security Objectives for the TOE -->
    <section title="Security Objectives for the TOE" id="SecurityObjectivesTOE">
      <SOs>
        <SO id="O.AUTHENTICATION">
          <description>To address the issues associated with unauthorized disclosure of information in transit, a compliant
            TOE’s authentication ability (IPsec) will allow the TSF to establish VPN connectivity with a remote
            VPN gateway or peer and ensure that any such connection attempt is both authenticated and
            authorized.
          </description>
          <addressed-by>FIA_X509_EXT.3 (when GPOS PP is Base-PP)</addressed-by>
			<consistency-rationale>This SFR supports the objective by enforcing the use
				of X.509 certificate authentication for IPsec.</consistency-rationale>
          <addressed-by>FIA_X509_EXT.2 (refined from MDF PP)</addressed-by>
			<consistency-rationale>This SFR supports the objective by enforcing the use
				of X.509 certificate authentication for IPsec.</consistency-rationale>
          <addressed-by>FIA_X509_EXT.2 (refined from App PP)</addressed-by>
			<consistency-rationale>This SFR supports the objective by enforcing the use
				of X.509 certificate authentication for IPsec.</consistency-rationale>
          <addressed-by>FIA_X509_EXT.2 (refined from MDM PP)</addressed-by>
			<consistency-rationale>This SFR supports the objective by enforcing the use
				of X.509 certificate authentication for IPsec.</consistency-rationale>
          <addressed-by>FCS_IPSEC_EXT.1</addressed-by>
			<consistency-rationale>This SFR supports the objective by requiring the
				TOE’s implementation of IPsec to include requirements for how the remote VPN gateway or
				peer is authenticated.</consistency-rationale>
          <addressed-by>FIA_PSK_EXT.1 (optional)</addressed-by>
			<consistency-rationale>This SFR supports the objective by optionally
				requiring support for pre-shared keys as an alternate authentication method for IPsec.</consistency-rationale>
        </SO>
        <SO id="O.CRYPTOGRAPHIC_FUNCTIONS">
          <description>To address the issues associated with unauthorized disclosure of information in transit, a compliant
            TOE will implement cryptographic capabilities. These capabilities are intended to maintain
            confidentiality and allow for detection and modification of data that is transmitted outside of the
            TOE.
          </description>
          <addressed-by>FCS_CKM.1 (refined from GPOS PP)</addressed-by>
			<consistency-rationale>This SFR supports the objective by requiring that the
				TOE implement key generation using certain methods.</consistency-rationale>
          <addressed-by>FCS_CKM.2 (refined from GPOS PP)</addressed-by>
			<consistency-rationale>This SFR supports the objective by requiring that the
				TOE implement key establishment using certain methods. </consistency-rationale>
          <addressed-by>FCS_COP.1(1) (refined from GPOS PP)</addressed-by>
			<consistency-rationale>This SFR supports the objective by requiring that the
				TOE implement symmetric encryption and decryption using certain methods.</consistency-rationale>
          <addressed-by>FTP_ITC.1 (when GPOS PP is Base-PP)</addressed-by>
			<consistency-rationale>This SFR supports the objective by requiring the TOE
				to support the use of IPsec as a trusted channel.</consistency-rationale>
          <addressed-by>FCS_CKM.1 (refined from MDF PP)</addressed-by>
			<consistency-rationale>This SFR supports the objective by requiring that the
				TOE implement key generation using certain methods.</consistency-rationale>
          <addressed-by>FCS_CKM.2(1) (refined from MDF PP)</addressed-by>
			<consistency-rationale>This SFR supports the objective by requiring that the
				TOE implement key establishment using certain methods.</consistency-rationale>
          <addressed-by>FCS_COP.1(1) (refined from MDF PP)</addressed-by>
			<consistency-rationale>This SFR supports the objective by requiring that the
				TOE implement symmetric encryption and decryption using certain methods.</consistency-rationale>
          <addressed-by>FTP_ITC_EXT.1 (refined from MDF PP)</addressed-by>
			<consistency-rationale>This SFR supports the objective by requiring the TOE
				to support the use of IPsec as a trusted channel.</consistency-rationale>
          <addressed-by>FCS_CKM.1(1) (refined from App PP)</addressed-by>
			<consistency-rationale>This SFR supports the objective by requiring the TOE
				to implement key generation using certain methods or to support invoking this function from its OS
				platform.</consistency-rationale>
          <addressed-by>FCS_CKM.2 (refined from App PP)</addressed-by>
			<consistency-rationale>This SFR supports the objective by requiring the TOE
				to implement key establishment using certain methods or to support invoking this function from its
				OS platform.</consistency-rationale>
          <addressed-by>FCS_CKM_EXT.1 (refined from App PP)</addressed-by>
		  <consistency-rationale>This SFR supports the objective by requiring the TOE
			to specify whether it implements its own cryptographic primitives or invokes platform
			cryptographic services for these functions.</consistency-rationale>
          <addressed-by>FCS_COP.1(1) (refined from App PP)</addressed-by>
			<consistency-rationale>This SFR supports the objective by requiring that the
				TOE implement symmetric encryption and decryption using certain methods.
				</consistency-rationale>
          <addressed-by>FCS_CKM.1 (refined from MDM PP)</addressed-by>
			<consistency-rationale>This SFR supports the objective by requiring the TOE
				to implement key generation using certain methods or to support invoking this function from its OS
				platform.</consistency-rationale>
          <addressed-by>FCS_CKM.2 (refined from MDM PP)</addressed-by>
			<consistency-rationale>This SFR supports the objective by requiring the TOE
				to implement key establishment using certain methods or to support invoking this function from its
				OS platform.</consistency-rationale>
          <addressed-by>FCS_COP.1(1) (refined from MDM PP)</addressed-by>
			<consistency-rationale>This SFR supports the objective by requiring that the
				TOE implement symmetric encryption and decryption using certain methods or invoke platform
				functionality that provides this capability.</consistency-rationale>
          <addressed-by>FPT_ITT.1(1) (if applicable, refined from MDM PP)</addressed-by>
			<consistency-rationale>If the MDM TOE includes a claim of this PP-Module
				to support protection of communications between distributed TOE components, this SFR supports the
				objective by requiring the TOE to support the use of IPsec for that interface.</consistency-rationale>
          <addressed-by>FTP_ITC.1(1) (if applicable, refined from MDM PP)</addressed-by>
			<consistency-rationale>If the MDM TOE includes a claim of this PP-Module
				to support protection of communications between the TOE and one or more trusted external IT entities,
				this SFR supports the objective by requiring the TOE to support the use of IPsec for that interface.</consistency-rationale>
          <addressed-by>FTP_TRP.1(1) (if applicable, refined from MDM PP)</addressed-by>
			<consistency-rationale>If the MDM TOE includes a claim of this PP-Module
				to support protection of communications between remote administrators and the TOE, this SFR
				supports the objective by requiring the TOE to support the use of IPsec for that interface.</consistency-rationale>
          <addressed-by>FCS_CKM.1/VPN</addressed-by>
			<consistency-rationale>This SFR supports the objective by requiring the TOE
				to generate keys used for IKE using certain methods.</consistency-rationale>
          <addressed-by>FCS_IPSEC_EXT.1</addressed-by>
			<consistency-rationale>This SFR supports the objective by requiring the TOE
				to implement the IPsec protocol in the specified manner.</consistency-rationale>
        </SO>
        <SO id="O.KNOWN_STATE">
          <description>The TOE will provide sufficient measures to ensure it is operating in a known state. At minimum this
            includes management functionality to allow the security functionality to be configured and self-test
            functionality that allows it to assert its own integrity. It may also include auditing functionality that
            can be used to determine the operational behavior of the TOE.
          </description>
          <addressed-by>FMT_SMF.1/VPN</addressed-by>
			<consistency-rationale>This SFR supports the objective by requiring the TOE
				to implement certain administratively-configurable functions.</consistency-rationale>
          <addressed-by>FPT_TST_EXT.1/VPN</addressed-by>
			<consistency-rationale>This SFR supports the objective by requiring the TOE
				to execute self-tests that demonstrate that its integrity is maintained.</consistency-rationale>
          <addressed-by>FAU_GEN.1/VPN (optional)</addressed-by>
			<consistency-rationale>This SFR supports the objective by optionally
				requiring the TOE to generate audit records of its behavior.</consistency-rationale>
          <addressed-by>FAU_SEL.1/VPN (optional)</addressed-by>
			<consistency-rationale>This SFR supports the objective by optionally
				requiring the TOE to allow for the configuration of what behavior is audited.</consistency-rationale>
        </SO>
        <SO id="O.NONDISCLOSURE">
          <description>To address the issues associated with unauthorized disclosure of information at rest, a compliant
            TOE will ensure that non-persistent data is purged when no longer needed. The TSF may also
            implement measures to protect against the disclosure of stored cryptographic keys and data
            through implementation of protected storage and secure erasure methods. The TOE may optionally
            also enforce split-tunneling prevention to ensure that data in transit cannot be disclosed
            inadvertently outside of the IPsec tunnel.
          </description>
          <addressed-by>FCS_CKM_EXT.2 (when GPOS PP is Base-PP)</addressed-by>
			<consistency-rationale>This SFR supports the objective by requiring the TOE
				to store sensitive data in the operating system’s key storage.</consistency-rationale>
          <addressed-by>FCS_CKM_EXT.2 (when App PP is BasePP)</addressed-by>
			<consistency-rationale>This SFR supports the objective by requiring the TOE
				or its platform to store sensitive data in the operating system’s key storage.</consistency-rationale>
          <addressed-by>FCS_CKM_EXT.4 (when App PP is Base-PP)</addressed-by>
			<consistency-rationale>This SFR supports the objective by requiring the TOE
				or its platform to zeroize key data when no longer needed.</consistency-rationale>
          <addressed-by>FDP_RIP.1</addressed-by><consistency-rationale/>
			<consistency-rationale>This SFR supports the objective by requiring the TOE
				or its platform to ensure that residual data is purged from the system.</consistency-rationale>
          <addressed-by>FDP_IFC_EXT.1 (optional)</addressed-by>
			<consistency-rationale>This SFR supports the objective by optionally
				requiring the TOE to prohibit split-tunneling so that network traffic cannot be transmitted outside of an
				established IPsec tunnel.</consistency-rationale>
        </SO>
      </SOs>
    </section>
    
    <!-- 4.2 Security Objectives for the Operational Environment -->
    <section title="Security Objectives for the Operational Environment" id="SecurityObjectivesTOEorEnvironment">
      The Operational Environment of the TOE implements technical and procedural measures to assist the
      TOE in correctly providing its security functionality (which is defined by the security objectives for the
      TOE). This section defines the security objectives that are to be addressed by the IT domain or by nontechnical or procedural means. As indicated above, if requirements supporting an objective on the TOE
      (in the previous table) are implemented in whole or in part by the platform, the ST should indicate this
      by an entry in this table with that objective.

      <SOEs>
        <SOE id="OE.NO_TOE_BYPASS">
          <description>Information cannot flow onto the network to which the VPN client’s host is connected without
            passing through the TOE.
          </description>
          <consistency-rationale/>
        </SOE>
        <SOE id="OE.PHYSICAL">
          <description>Physical security, commensurate with the value of the TOE and the data it contains, is assumed to
            be provided by the environment.</description>
          <consistency-rationale/>
        </SOE>
        <SOE id="OE.TRUSTED_CONFIG">
          <description>Personnel configuring the TOE and its operational environment will follow the applicable security
            configuration guidance.
          </description>
          <consistency-rationale/>
        </SOE>
      </SOEs>
    </section>
    
    <!-- 4.3 Security Objectives Rationale -->
    <section title="Security Objectives Rationale" id="SOR">
      <!-- NOTE: This section should remain empty and is populated from the rationale tags in the previous sections.  -->
    </section>
    
  </chapter>
        
  <!-- 5. Security Requirements -->
  <chapter title="Security Requirements" id="sfrs">
    
    The Security Functional Requirements (SFRs) included in this section are derived from Part 2 of the
    Common Criteria for Information Technology Security Evaluation, Version 3.1, Revision 5, with
    additional extended functional components.<h:p/>
    The CC defines operations on Security Functional Requirements: assignments, selections, assignments
    within selections and refinements. This document uses the following font conventions to identify the
    operations defined by the CC:<h:p/>
    <h:ul>
      <h:li>Assignments are indicated with <h:i>italicized</h:i> text.</h:li>
      <h:li>Refinements made by the PP-Module author are indicated with <h:b>bold text</h:b> for added or substituted
        text and <h:s>strikethrough</h:s> text for removed text. Refinements are only applied to significant technical
        changes to existing SFRs; minor presentation changes with no technical impact (such as British vs
        American spelling differences) are not marked as refinements. Refinements are also indicated when
        an operation is added or substituted for an existing operation (e.g. the PP-Module completes an
        assignment in such a way that it introduces a selection into the assignment).<h:p/>
        Note that for SFRs that are defined either in CC Part 2 or in this PP-Module’s Extended Components
        Definition, the refinement operation is used to indicate deviations from the defined component. For
        Base-PP SFRs that are modified by this PP-Module, the refinement operation is used to indicate
        deviations from the Base-PP’s definition of the SFR (i.e. if the Base-PP refined an SFR and that
        change is not affected by this PP-Module, it is not shown here as a refinement).</h:li>
      <h:li>Selections are indicated with <h:i>italicized</h:i> text.</h:li>
      <h:li>Iteration is indicated by appending the SFR name with a slash and unique identifier suggesting the
        purpose of the iteration, e.g. ‘/VPN’ for an SFR relating to VPN functionality and/or a sequential
        number in parentheses, e.g. (1). </h:li>  
      <!-- We should get rid of the number and ( ) options for more than one reason. 
        1. This PP is already written and it was done one way or the other.
        2. We want it done our way: slashes for iterations, parens for instances.  -->
      <h:li>Extended SFRs are identified by having a label “EXT” after the SFR name.</h:li>
    </h:ul>
    Note that selections and assignments to be completed by the ST author are preceded with “selection:”
    and “assignment:”. If text is italicized and does not include either of these, it means that the selection or
    assignment has already been completed in this PP-Module and the ST author must use the text as
    written. 
    
    <!-- 5.1 GPOS PP Security Functional Requirements Direction -->
    <base-pp version="4.2.1" name="General Purpose Operating System" product="General Purpose Operating System" short="OS" url="https://www.niap-ccevs.org/Profile/Info.cfm?PPID=442" xmlurl="test">

      In a PP-Configuration that includes the GPOS PP, the VPN client is expected to rely on some of the
      security functions implemented by the operating system as a whole and evaluated against the Base-PP.
      In this case, the following sections describe any modifications that the ST author must make to the SFRs
      defined in the Base-PP in addition to what is mandated by section 5.5.
      
      <!-- 5.1.1 Modified SFRs -->      
      <modified-sfrs>
        
        The SFRs listed in this section are defined in the GPOS PP and relevant to the secure operation of the
        VPN client. It is necessary for the ST author to complete selections and/or assignments for these SFRs in
        a specific manner in order to ensure that the functionality provided by the OS is consistent with the
        functionality required by the VPN client in order for it to conform to this PP-Module. 
        
        <subsection title="Cryptographic Support (FCS)" id="os-m-fcs">
          
          <!-- 5.1.1.1 FCS_CKM.1 Cryptographic Key Generation -->
          <f-component cc-id="fcs_ckm.1" id="os-fcs-ckm-1" name="Cryptographic Key Generation">
            <consistency-rationale>The ST author is instructed to make specific selections at minimum to
              address VPN client requirements; the SFR behavior itself is
              unmodified.</consistency-rationale>
            <f-element if="os-fcs-ckm-1e1">
              <title><h:b>The OS shall generate asymmetric cryptographic keys in accordance with a specified
                cryptographic key generation algorithm: 
                <h:ul><h:i>
                  <h:li>ECC schemes using “NIST curves” P-256, P-384, and <selectables>
                    <selectable>P-521</selectable>
                    <selectable>no other curves</selectable>
                  </selectables>
                    that meet the following: FIPS PUB 186-4, “Digital Signature
                    Standard (DSS),” Appendix B.4, and,
                  </h:li></h:i>
                </h:ul></h:b>
                <selectables linebreak="yes">
                  <selectable>RSA schemes using cryptographic key sizes of 2048-bit or greater that meet
                    the following: FIPS PUB 186-4, “Digital Signature Standard (DSS),”
                    Appendix B.3,</selectable>
                  <selectable>FFC schemes using cryptographic key sizes of 2048-bit or greater that meet
                    the following: FIPS PUB 186-4, “Digital Signature Standard (DSS),”
                    Appendix B.1,</selectable> 
                  <selectable>FFC Schemes using Diffie-Hellman group 14 that meet the following: RFC
                    3526,</selectable>
                  <selectable>FFC Schemes using safe primes that meet the following: ‘NIST Special
                    Publication 800-56A Revision 3, “Recommendation for Pair-Wise Key
                    Establishment Schemes,</selectable>
                  <selectable><h:b>No other key generation methods</h:b></selectable>
                </selectables>
                <h:s>and specified cryptographic key sizes [assignment: cryptographic key sizes] that
                  meet the following: [assignment: list of standards]</h:s>.
                </title>
              <note role="application">
                This SFR is functionally identical to what is defined in the GPOS PP except that
                ECC key generation with support for P-256 and P-384 has been made mandatory
                in support of IPsec due to the mandated support for DH groups 19 and 20 in
                FCS_IPSEC_EXT.1.8. The ST author must select all key generation schemes used
                for key establishment and entity authentication. When key generation is used for
                key establishment, the schemes in FCS_CKM.2 and selected cryptographic
                protocols must match the selection. When key generation is used for entity
                authentication, the public key is expected to be associated with an X.509v3
                certificate.<h:p/>
                If the OS acts only as a receiver in the RSA key establishment scheme, the OS
                does not need to implement RSA key generation.
              </note>
              <aactivity>  <!-- QQQQ -->
                Refer to the evaluation activity for <no-link>FCS_CKM.1</no-link> in the OS PP for evaluating this SFR.
                <no-tests/>
              </aactivity>
            </f-element>
            <audit-event/>
          </f-component>

          <!-- 5.1.1.2 FCS_CKM.2 Cryptographic Key Establishment -->
          <f-component cc-id="fcs_ckm.2" id="os-fcs-ckm-2" name="Cryptographic Key Establishment">
            <consistency-rationale>The ST author is instructed to make specific selections at minimum to
              address VPN client requirements; the SFR behavior itself is
              unmodified.</consistency-rationale>
            <f-element id="os-fcs-ckm-2e1">
              <title><h:b>The OS shall implement functionality to perform cryptographic key
                establishment in accordance with a specified key establishment method:</h:b>
                <h:ul>
                  <h:li><h:b><h:i>Elliptic curve-based key establishment schemes that meets the following:
                    NIST Special Publication 800-56A Revision 3, “Recommendation for Pair-Wise Key
                    Establishment Schemes Using Discrete Logarithm Cryptography,” and</h:i></h:b>
                  </h:li>
                </h:ul>
                <selectables linebreak="yes">
                  <selectable>RSA-based key establishment schemes that meets the following: RSAESPKCS1-v1_5 as specified in Section 7.2 of RFC 8017, “Public-Key
                    Cryptography Standards (PKCS) #1: RSA Cryptography Specifications
                    Version 2.2,</selectable>
                  <selectable>Finite field-based key establishment schemes that meets the following: NIST
                    Special Publication 800-56A Revision 3, “Recommendation for Pair-Wise Key
                    Establishment Schemes Using Discrete Logarithm Cryptography”
                  </selectable>
                  <selectable>Key establishment scheme using Diffie-Hellman group 14 that meets the
                    following: RFC 3526,</selectable>
                  <selectable><h:b>No other key establishment schemes</h:b></selectable>
                </selectables>
                  <h:s>that meets the following [assignment: list of standards]</h:s>.
              </title>
              <note role="application">
                The ST author must select all key establishment schemes used for the selected
                cryptographic protocols.<h:p/>
                The elliptic curves used for the key establishment scheme must correlate with
                the curves specified in FCS_CKM.1.1. The domain parameters used for the finite
                field-based key establishment scheme are specified by the key generation
                according to FCS_CKM.1.1.
              </note>
              <aactivity>  <!-- QQQQ -->
                For all key establishment schemes that conform to NIST SP 800-56A or 800-56B, refer to the
                evaluation activity for <no-link>FCS_CKM.2</no-link> in the OS PP.<h:p/>
                If “Key establishment scheme using Diffie-Hellman group 14…” is selected, the evaluator shall ensure
                that the TSS describes how the implementation meets RFC 3526 Section 3. The evaluator shall also
                verify the correctness of the TSF’s implementation of Diffie-Hellman group 14 by using a known good
                implementation for each protocol selected in <no-link>FTP_ITC_EXT.1</no-link> and FTP_TRP.1 in the OS PP that
                uses Diffie-Hellman group 14. Note that because a TOE that conforms to this PP-Module must
                implement IPsec, the tested protocols shall include IPsec at minimum.
                <no-tests/>
              </aactivity>
            </f-element>
            <audit-event/>
          </f-component>

          <!-- 5.1.1.3 FCS_COP.1(1) Cryptographic Operation (Encryption/Decryption)  -->
          <f-component cc-id="fcs_cop.1" id="os-fcs-cop-1-1" name="Cryptographic Operation (Encryption and Decryption)" iteration="1">
            <consistency-rationale>The SFR is refined to list an additional AES mode that must be
              supported to address VPN client requirements; the use of this mode
              for VPN connectivity does not impact the ability of the OS to satisfy
              any of its other security requirements.</consistency-rationale>
            <f-element id="os-fcs-cop-1e1i1">
              <title>The OS shall perform encryption/decryption services for data in accordance with
                a specified cryptographic algorithm
                <h:ul><h:b>
                  <h:li>AES-CBC (as defined in NIST SP 800-38A),</h:li>
                  <h:li>AES-GCM (as defined in NIST SP 800-38D), and</h:li></h:b>
                </h:ul>
                <selectables linebreak="yes">
                  <selectable><h:b>AES-XTS (as defined in NIST SP 800-38E),</h:b></selectable>
                  <selectable>AES-CCMP (as defined in FIPS PUB 197, NIST SP 800-38C and IEEE
                    802.11-2012)</selectable>
                  <selectable>AES Key Wrap (KW) (as defined in NIST SP 800-38F)</selectable>
                  <selectable>AES Key Wrap with Padding (KWP) (as defined in NIST SP 800-38F)</selectable>
                  <selectable>AES-CCM (as defined in NIST SP 800-38C)</selectable>
                  <selectable>AES-CCMP-256 (as defined in NIST SP800-38C and IEEE 802.11ac-2013)</selectable>
                  <selectable>AES-GCMP-256 (as defined in NIST SP800-38D and IEEE 802.11ac-2013)</selectable>
                  <selectable>No other modes</selectable>
                </selectables>
                and cryptographic key sizes 
                <selectables>
                  <selectable>128-bit</selectable>
                  <selectable>256-bit</selectable>
                </selectables>.
              </title>
              <note role="application">
                This SFR is identical to what is defined in the GPOS PP except that support for
                CBC and GCM mode is mandatory in order to address the requirements for
                FCS_IPSEC_EXT.1. In addition, both 128-bit and 256-bit for key sizes must be
                selected in order to meet the requirements for FCS_IPSEC_EXT.1.
              </note>
              <aactivity>  <!-- QQQQ -->
                Refer to the evaluation activity for FCS_COP.1(1) in the OS PP for evaluating this SFR.
                <no-tests/>
              </aactivity>
            </f-element>
            <audit-event/>
          </f-component>
        </subsection>
      </modified-sfrs>
        
      <!-- 5.1.2 Additional SFRs -->
      <additional-sfrs>
        This section lists additional SFRs that must be added to the TOE boundary in order to implement the
        functionality in any PP-Configuration where the GPOS PP is claimed as the Base-PP.

        <subsection title="Cryptographic Support (FCS)" id="os-a-fcs">
          
          <!-- 5.1.2.1 FCS_CKM_EXT.2 Cryptographic Key Storage  -->
          <f-component cc-id="fcs_ckm_ext.2" id="os-fcs-ckm-ext-2" name="Cryptographic Key Storage">
            <consistency-rationale>Storage of key data related to VPN functionality can be accomplished
              using the same mechanism defined by FCS_STO_EXT.1 in the OS PP.</consistency-rationale>
            <f-element id="os-fcs-ckm-ext-2e1">
              <title>The <selectables>
                <selectable>VPN client</selectable>
                <selectable>OS</selectable>
              </selectables> shall store persistent secrets and private keys
                when not in use in OS-provided key storage.
              </title>
              <note role="application">
                This requirement ensures that persistent secrets (credentials, secret keys) and
                private keys are stored securely when not in use. If some secrets/keys are
                manipulated by the VPN client and others are manipulated by the OS, then both
                of the selections can be specified by the ST author.
              </note>
              <aactivity>  <!-- QQQQ -->
                <TSS>Regardless of whether this requirement is met by the VPN client or the OS, the evaluator will check
                  the TSS to ensure that it lists each persistent secret (credential, secret key) and private key needed
                  to meet the requirements in the ST. For each of these items, the evaluator will confirm that the TSS
                  lists for what purpose it is used, and how it is stored.<h:p/>
                  The evaluator shall review the TSS for to determine that it makes a case that, for each item listed as
                  being manipulated by the VPN client, it is not written unencrypted to persistent memory, and that
                  the item is stored by the OS.<h:p/>
                </TSS>
                <Guidance>There are no guidance evaluation activities for this component.<h:p/></Guidance>
                <Tests>There are no test evaluation activities for this component.</Tests>
              </aactivity>
            </f-element>
            <audit-event/>
          </f-component>
        </subsection>

        <subsection title="Identification and Authentication (FIA)" id="os-a-fia">
          <ext-comp-def title="X.509 Certificate Use and Management" fam-id="FIA_X509_EXT">
            <fam-behavior>Components in this family describe the requirements that pertain to IP traffic and information flow
              through the VPN client.</fam-behavior>
          </ext-comp-def>
          
          <!-- 5.1.2.2 FIA_X509_EXT.3 X.509 Certificate Authentication -->
          <f-component cc-id="fia_x509_ext.3" id="os-fia-x509-ext-3" name="X.509 Certificate Use and Management">
            <consistency-rationale>This SFR defines additional uses for X.509 certificate functionality that
              do not conflict with those defined in the OS PP.</consistency-rationale>
            <comp-lev>requires the TOE to perform X.509 certificate
              authentication and describes the behavior that is followed if is the status of the certificate is unknown or
              invalid.</comp-lev>
            <management>No specific management functions are identified.
            </management>
            <audit>There are no auditable events foreseen.
            </audit>
            <dependencies>FIA_X509_EXT.1 X.509 Certificate Validation<h:p/>
              <no-link>FPT_TST_EXT.1</no-link> TSF Self-Test<h:p/>
            FPT_TUD_EXT.1 Trusted Update</dependencies>
            <f-element id="os-fia-x509-ext-3e1">
              <title>The TSF shall use X.509v3 certificates as defined by RFC 5280 to support
              authentication for IPsec exchanges, and <selectables>
                <selectable>digital signatures for FPT_TUD_EXT.1</selectable>
                <selectable>integrity checks for FPT_TST_EXT.1</selectable>
                <selectable>no additional uses</selectable>
              </selectables>.
              </title>
            </f-element>
            <f-element id="os-fia-x509-ext-3e2">
                <title>
                  When a connection to determine the validity of a certificate cannot be
                  established, the <selectables>
                    <selectable>VPN client</selectable>
                    <selectable>OS</selectable>
                  </selectables> shall <selectables>
                    <selectable>allow the administrator to choose whether to accept the certificate in these cases</selectable>
                    <selectable>accept the certificate</selectable>
                    <selectable>not accept the certificate</selectable>
                  </selectables>.
                </title>
                <note role="application">
                    Oftentimes a connection must be established to perform a verification of the
                    revocation status of a certificate - either to download a CRL or to perform OCSP.
                    The selection is used to describe the behavior in the event that such a connection
                    cannot be established (for example, due to a network error). The behavior of the
                    TOE in these cases is described by the second selection. If the TOE has
                    determined the certificate is valid according to all other rules in FIA_X509_EXT.1,
                    the behavior indicated in the second selection will determine the validity. The
                    TOE must not accept the certificate if it fails any of the other validation rules in
                    FIA_X509_EXT.1. If the administrator-configured option is selected by the ST
                    Author, the ST author must also make the appropriate selection in
                    FMT_SMF.1/VPN.
                </note>
            </f-element>
            <f-element id="os-fia-x509-ext-3e3">
              <title>
                The <selectables>
                  <selectable>VPN client</selectable>
                  <selectable>OS</selectable>
                </selectables> shall not establish an SA if a certificate or
                certificate path is deemed invalid.
              </title>
              <aactivity>   <!-- QQQQ -->
                The evaluation activities below apply to FIA_X509_EXT.3.2. FIA_X509_EXT.3.1 is evaluated as part of
                FCS_IPSEC_EXT.1 (and conditionally as part of FPT_TUD_EXT.1 and/or <no-link>FPT_TST_EXT.1</no-link>).
                FIA_X509_EXT.3.3 is evaluated as part of FCS_IPSEC_EXT.1.11.<h:p/>
                <TSS>The evaluator shall check the TSS to ensure that it describes whether the VPN client or the OS
                  implements the certificate validation functionality, how the VPN client/OS chooses which certificates
                  to use, and any necessary instructions in the administrative guidance for configuring the OS so that
                  desired certificates can be used.<h:p/>

                  The evaluator shall examine the TSS to confirm that it describes the behavior of the client/OS when a
                  connection cannot be established during the validity check of a certificate used in establishing a
                  trusted channel.<h:p/>
                </TSS>
                <Guidance>If the requirement that the administrator is able to specify the default action, then the evaluator
                  shall ensure that the operational guidance contains instructions on how this configuration action is
                  performed.<h:p/></Guidance>
                <Tests>
                  The evaluator shall perform the following test regardless of whether the certificate validation
                  functionality is implemented by the VPN client or by the OS:
                  <testlist>
                  <test>The evaluator shall demonstrate that using a valid certificate that requires certificate
                  validation checking to be performed in at least some part by communicating with a non-TOE IT
                  entity. The evaluator shall then manipulate the environment so that the TOE is unable to verify the
                  validity of the certificate, and observe that the action selected in FIA_X509_EXT.3.2 is performed. If
                  the selected action is administrator-configurable, then the evaluator shall follow the operational
                  guidance to determine that all supported administrator-configurable options behave in their
                  documented manner.</test>
                  </testlist>
                </Tests>
              </aactivity>
            </f-element>
            <audit-event/>
          </f-component>
        </subsection>

        <subsection title="Trusted Path/Channels (FTP)" id="os-a-ftp">
          
          <!-- 5.1.2.3 FTP_ITC Inter-TSF Trusted Channel -->
          <f-component cc-id="ftp_itc.1" id="os-ftp-itc-1" name="Inter-TSF Trusted Channel">
            <consistency-rationale>This SFR defines a trusted channel for IPsec, which is added
              functionality that does not prevent the existing OS functions from
              being performed.
            </consistency-rationale>
            <f-element id="os-ftp-itc-1e1">
              <title>
                The <h:b><selectables>
                  <selectable>VPN client</selectable>
                  <selectable>OS</selectable>
                </selectables>
                shall use IPsec to provide</h:b> a <h:b>trusted</h:b>
                communication channel between itself and <h:b>
                <selectables>
                  <selectable>a remote VPN gateway</selectable>
                  <selectable>a remote VPN client</selectable>
                  <selectable>a remote IPsec-capable network device</selectable>
                </selectables></h:b> that is logically
                distinct from other communication channels and provides assured identification
                of its end points and protection of the channel data <h:b>from disclosure and
                detection of modification of the channel data</h:b>.
              </title>
            </f-element>
            <f-element id="os-ftp-itc-1e2">
              <title>
                The <h:b>
                <selectables>
                  <selectable>VPN client</selectable>
                  <selectable>OS</selectable>
                </selectables></h:b> shall permit [<h:i>the TSF</h:i>] to initiate communication with the trusted channel.
              </title>
            </f-element>
            <f-element id="os-ftp-itc-1e3">
              <title>
                The <h:b>
                <selectables>
                  <selectable>VPN client</selectable>
                  <selectable>OS</selectable>
                </selectables></h:b> shall initiate communication via the trusted
                channel [<h:i>for all traffic traversing that connection</h:i>].
              </title>
              <note role="application">
                The intent of the above requirement is to demonstrate that IPsec can be used to
                establish remote communications in transport and/or tunnel mode.<h:p/>
                The requirement implies that not only are communications protected when they
                are initially established, but also on resumption after an outage. It may be the
                case that some part of the TOE setup involves manually setting up tunnels to
                protect other communication, and if after an outage the TOE attempts to reestablish 
                the communication automatically with (the necessary) manual
                intervention, there may be a window created where an attacker might be able to
                gain critical information or compromise a connection.
              </note>
              <aactivity>  <!-- QQQQ -->
                <TSS>The evaluator shall examine the TSS to determine that it describes the details of the TOE connecting
                  to a VPN gateway and/or VPN client and/or IPsec-capable network device in terms of the
                  cryptographic protocols specified in the requirement, along with TOE-specific options or procedures
                  that might not be reflected in the specification. The evaluator shall also confirm that all protocols
                  listed in the TSS are specified and included in the requirements in the ST.<h:p/>
                </TSS>
                <Guidance>The evaluator shall confirm that the operational guidance contains instructions for establishing the
                  connection to a VPN gateway and/or VPN client and/or IPsec-capable network device, and that it
                  contains recovery instructions should a connection be unintentionally broken.<h:p/>
                </Guidance>
                <Tests>
                  The evaluator shall perform the following tests:
                  <testlist>
                    <test>The evaluator shall ensure that the TOE is able to initiate communications with a VPN
                      gateway and/or VPN client and/or IPsec-capable network device using the protocols specified in the
                      requirement, setting up the connections as described in the operational guidance and ensuring that
                      communication is successful.</test>
                    <test>The evaluator shall ensure, for each communication channel with an IPsec peer, the channel
                      data is not sent in plaintext.
                    </test>
                    <test>The evaluator shall ensure, for each communication channel with an IPsec peer, modification
                      of the channel data is detected by the TOE.</test>
                    <test>The evaluator shall physically interrupt the connection from the TOE to the IPsec peer. The
                      evaluator shall ensure that subsequent communications are appropriately protected, at a minimum
                      in the case of any attempts to automatically resume the connection or connect to a new access
                      point.</test>
                  </testlist>
                </Tests>
              </aactivity>
            </f-element>
            <audit-event/>
          </f-component>
        </subsection>
      </additional-sfrs>
      
	  <!-- 6.1.1 Consistency of TOE Type -->
      <con-toe>If this PP-Module is used to extend the GPOS PP, the TOE type for the overall TOE is still a 
		general-purpose operating system. The TOE boundary is simply extended to include VPN client functionality that
		is built into the operating system so that additional security functionality is claimed within the scope of
		the TOE.  </con-toe>
		
	  <!-- 6.1.2 Consistency of Security Problem Description -->
      <con-sec-prob>The threats and assumptions defined by this PP-Module (see sections 3.1 and 3.2) supplement those
		defined in the GPOS PP as follows:</con-sec-prob>
      <con-obj>The security objectives defined by this PP-Module (see sections 4.1 and 4.2) supplement those defined
		in the GPOS PP as follows:</con-obj>
      <con-op-en></con-op-en>
      <con-mod ref="T.UNAUTHORIZED_ACCESS">The threat of an attacker gaining access to a network interface or data
        that is transmitted over it is consistent with the T.NETWORK_ATTACK and T.NETWORK_EAVESDROP threats in the GPOS PP.</con-mod>
      <con-mod ref="T.TSF_CONFIGURATION">The threat of a misconfigured VPN client is consistent with the
		T.NETWORK_ATTACK and T.NETWORK_EAVESDROP threats on the GPOS PP because misconfiguration could allow VPN traffic to be subjected
		unexpectedly to unauthorized modification or disclosure..</con-mod>
      <con-mod ref="T.USER_DATA_REUSE">Inadvertent disclosure of user data to an unauthorized recipient is
		consistent with the T.NETWORK_EAVESDROP threat in the GPOS PP.</con-mod>
      <con-mod ref="T.TSF_FAILURE">A failure of TSF functionality could compromise the local system, which is
		consistent with the T.LOCAL_ATTACK threat in the GPOS PP.</con-mod>
      <con-mod ref="A.NO_TOE_BYPASS">The A.NO_TOE_BYPASS assumption assumes that the operational
		environment is configured in such a manner that the only network route to the protected network is through the TOE. This does not conflict with
		the GPOS PP because the GPOS PP makes no assumptions about the network architecture in which the TOE is deployed.</con-mod>
      <con-mod ref="A.PHYSICAL">The assumption that physical security is provided by the environment is
		not explicitly stated in the GPOS PP but is consistent with the A.PLATFORM assumption defined in the GPOS PP, which expects the computing
		platform to be trusted.</con-mod>
      <con-mod ref="A.TRUSTED_CONFIG">The assumption that personnel responsible for the TOE’s configuration are
		trusted to follow the guidance is consistent with the A.PROPER_ADMIN
		defined in the GPOS PP.</con-mod>
			
	  <!-- 6.1.3 Consistency of Objectives -->
      <con-mod ref="O.AUTHENTICATION">This objective is consistent with the O.PROTECTED_COMMS objective of the
		Base-PP, which also expects that trusted remote channels will enforce
		authentication of remote endpoints.</con-mod>
      <con-mod ref="O.CRYPTOGRAPHIC_FUNCTIONS">This objective is consistent with the O.PROTECTED_COMMS objective of the
		Base-PP, which also expects that secure cryptographic functions are used to
		implement trusted communications.</con-mod>
      <con-mod ref="O.KNOWN_STATE">This objective is consistent with the O.INTEGRITY objective of the Base-PP,
		which expects a conformant TOE to implement measures to maintain its
		own integrity.</con-mod>
      <con-mod ref="O.NONDISCLOSURE ">This objective is consistent with the O.PROTECTED_STORAGE objective of
		the Base-PP, which ensures that sensitive data is not disclosed without
		authorization.</con-mod>
      <con-mod ref="OE.NO_TOE_BYPASS">This objective addresses behavior that is out of scope of the Base-PP and
		does not define an environment that a GPOS TOE is incapable of existing in.</con-mod>
      <con-mod ref="OE.PHYSICAL ">This is part of satisfying OE.PLATFORM as defined in the GPOS PP because
		physical security is required for hardware to be considered ‘trusted’</con-mod>
      <con-mod ref="OE.TRUSTED_CONFIG">The expectation of trusted configuration is consistent with OE.PROPER_USER
		and OE.PROPER_ADMIN in the GPOS PP.</con-mod>
	  
	  <!-- 6.1.4 Consistency of Requirements -->
	  <!-- This PP-Module identifies several SFRs from the GPOS PP that are needed to support VPN client
		functionality. This is considered to be consistent because the functionality provided by the operating
		system is being used for its intended purpose. The PP-Module also identifies a number of modified SFRs
		from the GPOS PP as well as new SFRs that are used entirely to provide VPN client functionality. The
		rationale for why this does not conflict with SFRs defined by the GPOS PP are as follows: -->
	  
      <con-mod ref="os-fcs-ckm-1">The ST author is instructed to make specific selections at minimum to
		address VPN client requirements; the SFR behavior itself is unmodified.</con-mod>
      <con-mod ref="os-fcs-ckm-2">The ST author is instructed to make specific selections at minimum to
		address VPN client requirements; the SFR behavior itself is unmodified</con-mod>
      <con-mod ref="os-fcs-cop-1i1">The SFR is refined to list an additional AES mode that must be supported to
		address VPN client requirements; the use of this mode for VPN connectivity
		does not impact the ability of the GPOS to satisfy any of its other security
		requirements.</con-mod>

      <con-mod ref="os-fcs-ckm-ext-2">Storage of key data related to VPN functionality can be accomplished using
		the same mechanism defined by FCS_STO_EXT.1 in the GPOS PP.</con-mod>
      <con-mod ref="os-fia-x509-ext-3">This SFR defines additional uses for X.509 certificate functionality that do
		not conflict with those defined in the GPOS PP.</con-mod>
      <con-mod ref="os-ftp-itc-1">This SFR defines a trusted channel for IPsec, which is added functionality
		that does not prevent the existing GPOS functions from being performed.</con-mod>
		
      <con-mod ref="fcs-ckm-1-vpn">Generation of IKE peer authentication keys is added functionality that does
		not prevent the existing GPOS functions from being performed.</con-mod>
      <con-mod ref="fcs-ipsec-ext-1">This SFR defines the VPN client’s IPsec implementation, which is added
		functionality that does not interfere with the GPOS functions.</con-mod>
      <con-mod ref="fdp-rip-2">The requirement to protect against re-use of residual data is a property of
		the VPN client behavior and does not impact the GPOS functionality.</con-mod>
      <con-mod ref="fmt-smf-1-vpn">The ability to configure the VPN client behavior does not affect whether the
		GPOS as a whole can perform its security functions.</con-mod>
      <con-mod ref="fpt-tst-ext-1-vpn">Self-testing of the VPN client functionality does not impact the ability of the
		GPOS to perform its security functions.</con-mod>

      <con-mod ref="fau-gen-1-vpn">Audit records generated by the VPN client do not interfere with GPOS
		functionality. The possibility of the underlying OS platform generating audit
		records is consistent with the GPOS PP, which already contains FAU_GEN.1.</con-mod>
      <con-mod ref="fau-sel-1-vpn">The ability to suppress the generation of certain audit records related to
		VPN activity does not interfere with the ability of the GPOS to satisfy its
		security functionality.</con-mod>
      <con-mod ref="fdp-ifc-ext-1">The ability of the VPN client to prevent split tunneling of IPsec traffic
		requires it to have hooks into lower-level OS behavior, but there are no
		requirements in the GPOS PP that would prevent this functionality from
		being supported.</con-mod>

      <con-mod ref="fia-psk-ext-1">This SFR defines the use of pre-shared keys, which is behavior that only
		relates to the establishment of IPsec connections.</con-mod>

    </base-pp>

    <!-- 5.2 MDF PP Security Functional Requirements Direction -->
    <base-pp version="3.1" name="Mobile Device Fundamentals" product="Mobile Device" short="MD" url="https://www.niap-ccevs.org/Profile/Info.cfm?PPID=417" xmlurl="test">

      In a PP-Configuration that includes the MDF PP, the VPN client is expected to rely on some of the
      security functions implemented by the operating system as a whole and evaluated against the Base-PP.
      In this case, the following sections describe any modifications that the ST author must make to the SFRs
      defined in the Base-PP in addition to what is mandated by section 5.5.<h:p/>
      Full EAs are not repeated in the Supporting Document for the requirements in this section that are
      references to the MDF PP; only the additional testing needed to supplement what has already been
      captured in the MDF PP is included.
      
      <modified-sfrs>
        <subsection title="Cryptographic Support (FCS)" id="md-m-fcs">
          
          <!-- 5.2.1.1 FCS_CKM.1 Cryptographic Key Generation -->
          <f-component cc-id="fcs_ckm.1" id="md-fcs-ckm-1" name="Cryptographic Key Generation">
            <consistency-rationale>The ST author is instructed to make specific selections at minimum to
              address VPN client requirements; the SFR behavior itself is
              unmodified.</consistency-rationale>
            <f-element id="md-fcs-ckm-1e1">
              <title><h:b>The TSF shall generate asymmetric cryptographic keys in accordance with a specified cryptographic key
                generation algorithm: 
                <h:ul>
                  <h:li>ECC schemes using 
                    <h:ul>
                      <h:li>“NIST curves” P-256, P-384, and 
                        <selectables>
                          <selectable>P-521</selectable>
                          <selectable>no other curves</selectable>
                        </selectables> 
                        that meet the following: FIPS PUB 186-4, “Digital Signature Standard (DSS),” Appendix B.4, and
                      </h:li>
                      <h:li>
                        <selectables>
                          <selectable>Curve25519 schemes that meet the following: RFC 7748</selectable>
                          <selectable>No other curve</selectable>
                        </selectables>
                      </h:li>, and
                    </h:ul>
                  </h:li>
                </h:ul>
                <selectables linebreak="yes">
                  <selectable>FFC schemes using
                    <selectables>
                      <selectable>cryptographic key sizes of 2048-bit or greater that meet
                        the following: FIPS PUB 186-4, “Digital Signature Standard (DSS),”
                        Appendix B.1</selectable>
                      <selectable>Diffie-Hellman group 14 that meet the following: RFC 3526, Section 3</selectable>
                      <selectable>“safe-prime” groups that meet the following: ‘NIST Special Publication 800-56A Revision 3,
                        “Recommendation for Pair-Wise Key Establishment Schemes Using Discrete Logarithm Cryptography</selectable>
                    </selectables>, and
                  </selectable>
                  <selectable>
                    RSA schemes using cryptographic key sizes of 2048-bit or greater
                    that meet FIPS PUB 186-4, “Digital Signature Standard (DSS),”
                    Appendix B.3,</selectable>
                  <selectable>No other key generation methods</selectable>
                </selectables>.
                </h:b>
              </title>
              <note role="application">
                This SFR is functionally identical to what is defined in the MDF PP except that
                ECC key generation with support for P-256 and P-384 has been made mandatory
                in support of IPsec due to the mandated support for DH groups 19 and 20 in
                FCS_IPSEC_EXT.1.8. Curve25519 schemes are included to satisfy
                FDP_DAR_EXT.2.2 in the MDF PP; these schemes are not used in support of
                IPsec. RSA remains present as a selection since it may be used by facets of the
                MDF TOE that are not specifically related to VPN client functionality.
              </note>
              <aactivity>  <!-- QQQQ -->
                Refer to the evaluation activity for <no-link>FCS_CKM.1</no-link> in the MD PP for evaluating this SFR. <h:p/>
                Testing for FFC schemes using Diffie-Hellman group 14 is done as part of testing for <no-link>FCS_CKM.2</no-link>.
                <no-tests/>
              </aactivity>
            </f-element>
            <audit-event/>
          </f-component>

          <!-- 5.2.1.2 FCS_CKM.2(1) Cryptographic Key Establishment -->
          <f-component cc-id="fcs_ckm.2" id="md-fcs-ckm-2-1" name="Cryptographic Key Establishment" iteration="1">
            <consistency-rationale>The ST author is instructed to make specific selections at minimum to
              address VPN client requirements; the SFR behavior itself is
              unmodified.</consistency-rationale>
            <f-element id="md-fcs-ckm-2e1i1">
              <title><h:b>The TSF shall perform cryptographic key
                establishment in accordance with a specified key establishment method:
                <h:ul>
                  <h:li>Elliptic curve-based key establishment schemes that meets the following:
                    NIST Special Publication 800-56A Revision 3, “Recommendation for Pair-Wise Key
                    Establishment Schemes Using Discrete Logarithm Cryptography,”
                  </h:li>
                </h:ul>and
                <selectables linebreak="yes">
                  <selectable>Finite field-based key establishment schemes that meets the following: NIST
                    Special Publication 800-56A Revision 3, “Recommendation for Pair-Wise Key
                    Establishment Schemes Using Discrete Logarithm Cryptography”</selectable>
                  <selectable><h:b>Key establishment scheme using Diffie-Hellman group 14 that meets the
                    following: RFC 3526, Section 3</h:b></selectable>
                  <selectable>RSA-based key establishment schemes that meet the following: 
                    <selectables>
                      <selectable>NIST Special Publication 800-56B, “Recommendation for Pair-Wise Key
                        Establishment Schemes using Integer Factorization Cryptography,”</selectable>
                      <selectable>RSAES-PKCS1-v1_5 as specified in Section 7.2 of RFC 8017,
                        “Public-Key Cryptography Standards (PKCS) #1: RSA Cryptography Specifications Version 2.2</selectable>
                    </selectables>
                  </selectable>
                  <selectable>no other key establishment schemes</selectable>
                </selectables>.</h:b>
              </title>
              <note role="application">
                This SFR differs from its definition in the MDF PP by moving elliptic curve-based
                key establishment schemes from selectable to mandatory (due to the mandated
                support for DH groups 19 and 20 in FCS_IPSEC_EXT.1.8). It also provides the
                ability to claim either NIST SP 800-56A or RFC 3526 for key establishment using
                finite field cryptography if DH group 14 is claimed. The use of RSA is not
                explicitly mandated by the VPN client but may be selected in the MDF PP, which
                is why it remains here.
              </note>
              <aactivity> <!-- QQQQ -->
                For all key establishment schemes that conform to NIST SP 800-56A or 800-56B, refer to the
                evaluation activity for <no-link>FCS_CKM.2</no-link>(1) in the MD PP.<h:p/>
                If “Key establishment scheme using Diffie-Hellman group 14…” is selected, the evaluator shall ensure
                that the TSS describes how the implementation meets RFC 3526 Section 3. The evaluator shall also
                verify the correctness of the TSF’s implementation of Diffie-Hellman group 14 by using a known good
                implementation for each protocol selected in <no-link>FTP_ITC_EXT.1</no-link> in the MD PP that
                uses Diffie-Hellman group 14. Note that because a TOE that conforms to this PP-Module must
                implement IPsec, the tested protocols shall include IPsec at minimum.
                <no-tests/>
              </aactivity>
            </f-element>
            <audit-event/>
          </f-component>

          <!-- 5.2.1.3 FCS_COP.1(1) Cryptographic Operation -->
          <f-component cc-id="fcs_cop.1" id="md-fcs-cop-1-1" name="Cryptographic Operation" iteration="1">
            <consistency-rationale>The ST author is instructed to make specific selections at minimum to
              address VPN client requirements; the SFR behavior itself is
              unmodified.</consistency-rationale>
            <f-element id="md-fcs-cop-1e1i1">
              <title>The TSF shall perform [<h:i>encryption/decryption</h:i>] in accordance with
                a specified cryptographic algorithm
                <h:ul>
                  <h:li>AES-CBC (as defined in FIPS PUB 197, NIST SP 800-38A),</h:li>
                  <h:li>AES-CCMP (as defined in FIPS PUB 197, NIST SP 800-38C and IEEE 802.11-2012),</h:li>
                  <h:li><h:b>AES-GCM (as defined in NIST SP 800-38D),</h:b></h:li>
                </h:ul> and
                <selectables linebreak="yes">
                  <selectable>AES Key Wrap (KW) (as defined in NIST SP 800-38F)</selectable>
                  <selectable>AES Key Wrap with Padding (KWP) (as defined in NIST SP 800-38F)</selectable>
                  <selectable>AES-CCM (as defined in NIST SP 800-38C)</selectable>
                  <selectable>AES-XTS (as defined in NIST SP 800-38E)</selectable>
                  <selectable>AES-CCMP-256 (as defined in NIST SP800-38C and IEEE 802.11ac-2013)</selectable>
                  <selectable>AES-GCMP-256 (as defined in NIST SP800-38D and IEEE 802.11ac-2013)</selectable>
                  <selectable>no other modes</selectable>
                </selectables>
                and cryptographic key sizes 128-bit key sizes and [<h:i>256-bit key sizes</h:i>].
              </title>
              <note role="application">
                This SFR is identical to what is defined in the MDF PP except that support for
                GCM mode and support for 256-bit key sizes are both mandatory in order to
                address the requirements for FCS_IPSEC_EXT.1.
              </note>
              <aactivity>  <!-- QQQQ -->
                Refer to the evaluation activity for <no-link>FCS_COP.1</no-link>(1) in the MD PP.
                <no-tests/>
              </aactivity>
            </f-element>
            <audit-event/>
          </f-component>
        </subsection>
        
        <subsection title="Identification and Authentication (FIA)" id="md-m-fia">
          
          <!-- 5.2.1.4 FIA_X509_EXT.2 X.509 Certificate Authentication -->
          <f-component cc-id="fia_x509_ext.2" id="md-fia-x509-ext-2" name="X.509 Certificate Authentication">
            <consistency-rationale>This PP-Module adds IPsec as a new trusted protocol where x.509
              certificate authentication is used.</consistency-rationale>
            <f-element id="md-fia-x509-ext-2e1">
              <title>The TSF shall use X.509v3 certificates as defined by RFC 5280 to support
                authentication for <h:b>IPsec</h:b> and 
                <selectables>
                  <selectable>TLS</selectable>
                  <selectable>HTTPS</selectable>
                  <selectable>DTLS</selectable>
                  <selectable><h:b>no other protocols</h:b></selectable>
                </selectables>, and 
                <selectables>
                  <selectable>code signing for system software updates</selectable>
                  <selectable>code signing for mobile applications</selectable>
                  <selectable>code signing for integrity verification</selectable>
                  <selectable><assignable>other uses</assignable></selectable>
                  <selectable>no additional uses</selectable>
                </selectables>.
              </title>
            </f-element>
            <f-element id="md-fia-x509-ext-2e2">
              <title>When the TSF cannot establish a connection to determine the validity of a
                certificate, the TSF shall 
                <selectables>
                  <selectable>allow the administrator to choose whether to accept the certificate in these cases</selectable>
                  <selectable>allow the user to choose whether to accept the certificate in these cases</selectable>
                  <selectable>accept the certificate</selectable>
                  <selectable>not accept the certificate</selectable>
                </selectables>.
              </title>
              <note role="application">
                This SFR is identical to what is defined in the MDF PP except that support for
                IPsec is mandated. Since the original SFR did not explicitly require at least one of
                TLS, HTTPS, or DTLS to be selected, “no other protocols” has also been added as
                a selection in the event that IPsec is the only protocol for which the TOE uses
                X.509v3 certificates for authentication.
              </note>
              <aactivity>  <!-- QQQQ -->
                Refer to the evaluation activity for <no-link>FIA_X509_EXT.2</no-link> in the MD PP.
                <no-tests/>
              </aactivity>
            </f-element>
            <audit-event/>
          </f-component>
        </subsection>
        
        <subsection title="Trusted Path/Channels (FTP)" id="md-m-ftp">
          
          <!-- 5.2.1.5 FTP_ITC_EXT.1 Trusted Channel Communications -->
          <f-component cc-id="ftp_itc_ext.1" id="md-ftp-itc-ext-1" name="Trusted Channel Communication">
            <consistency-rationale>This PP-Module adds IPsec as a new protocol that is used to
              implement trusted channels.</consistency-rationale>
            <f-element id="md-ftp-itc-ext-1e1">
              <title>The TSF shall use 802.11-2012, 802.1X, EAP-TLS, <h:b>IPsec,</h:b> and
                <selectables>
                  <selectable>TLS</selectable>
                  <selectable>DTLS</selectable>
                  <selectable>HTTPS</selectable>
                  <selectable><h:b>no other protocols</h:b></selectable>
                </selectables>
                to provide a communication channel between itself
                and another trusted IT product that is logically distinct from other
                communication channels, provides assured identification of its end points,
                protects channel data from disclosure, and detects modification of the channel
                data.
                </title>
            </f-element>
            <f-element id="md-ftp-itc-ext-1e2">
              <title>The TSF shall permit the TSF to initiate communication via the trusted channel.
              </title>
            </f-element>
            <f-element id="md-ftp-itc-ext-1e3">
              <title>
                The TSF shall initiate communication via the trusted channel for wireless access
                point connections, administrative communication, configured enterprise
                connections, and 
                <selectables>
                  <selectable>OTA updates</selectable>
                  <selectable>no other connections</selectable>
                </selectables>.
              </title>
              <note role="application">
                This SFR is identical to what is defined in the Base-PP except that support for
                IPsec is mandated. Additionally, since the Base-PP requires ‘at least one of’ the
                selected protocols which previously included IPsec, ‘no other protocols’ is now
                available as an option in the selection.
              </note>
              <aactivity>  <!-- QQQQ -->
                Refer to the evaluation activity for <no-link>FTP_ITC_EXT.1</no-link> in the MD PP.
                <no-tests/>
              </aactivity>
            </f-element>
            <audit-event/>
          </f-component>
        </subsection>
      </modified-sfrs>
      
      <!-- 5.2.2 Additional SFRs -->
      <additional-sfrs>
        There are no additional SFRs that must be claimed only in cases where the MDF PP is the claimed BasePP.
      </additional-sfrs>
	  
	  <!-- 6.2 MDF BB Base -->
	  <!-- 6.2.1 Consistency of TOE Type -->
      <con-toe>If this PP-Module is used to extend the MDF PP, the TOE type for the overall TOE is still a mobile device.
		The TOE boundary is simply extended to include VPN client functionality that is built in to the device’s
		software so that additional security functionality is claimed within the scope of the TOE.  </con-toe>

	  <!-- 6.2.2 Consistency of Security Problem Description -->
      <con-sec-prob>The threats and assumptions defined by this PP-Module (see sections 3.1 and 3.2) supplement those
		defined in the MDF PP as follows: </con-sec-prob>
      <con-obj>The security objectives defined by this PP-Module (see sections 4.1 and 4.2) supplement those defined
		in the MDF PP as follows:</con-obj>		
      <con-op-en></con-op-en>

      <con-mod ref="T.UNAUTHORIZED_ACCESS">The threat of an attacker gaining access to a network interface or data
		that is transmitted over it is consistent with the T.NETWORK and T.EAVESDROP threats in the MDF PP.</con-mod>
      <con-mod ref="T.TSF_CONFIGURATION">The threat of a mis-configured VPN client is consistent with the
		T.NETWORK and T.EAVESDROP threats in the MDF PP because failure to mitigate against mis-configuration makes these threats more significant.</con-mod>
      <con-mod ref="T.USER_DATA_REUSE">Inadvertent disclosure of user data to an unauthorized recipient is
		consistent with the T.EAVESDROP threat in the MDF PP.</con-mod>
      <con-mod ref="T.TSF_FAILURE">A failure of TSF functionality could compromise the local system, which is
		consistent with the T.FLAWAPP threat in the MDF PP.</con-mod>
      <con-mod ref="OE.NO_TOE_BYPASS">The A.NO_TOE_BYPASS assumption assumes that the operational
		environment is configured in such a manner that the only network route
		to the protected network is through the TOE. This does not conflict with
		the MDF PP because the MDF PP makes no assumptions about the
		network architecture in which the TOE is deployed.</con-mod>
      <con-mod ref="A.PHYSICAL">The MDF PP includes the A.NOTIFY and A.PRECAUTION assumptions to
		mitigate the risk of physical theft of the TOE. This is consistent with the
		A.PHYSICAL assumption in this PP-Module because the MDF PP includes
		reasonable assumptions about the physical security of the TOE.</con-mod>
      <con-mod ref="A.TRUSTED_CONFIG">This assumption is consistent with the MDF PP because the MDF PP
		includes the A.CONFIG assumption which assumes that all security functions are appropriately configured.</con-mod>
		
	  <!-- 6.2.3 Consistency of Objectives -->
      <con-mod ref="O.AUTHENTICATION ">This objective is consistent with the O.AUTH objective of the BasePP, which also expects that trusted remote channels will enforce
		authentication of remote endpoints.</con-mod>
      <con-mod ref="O.CRYPTOGRAPHIC_FUNCTIONS">This objective is consistent with the O.COMMS objective of the
		Base-PP, which also expects that secure cryptographic functions are used to implement trusted communications.</con-mod>
      <con-mod ref="O.KNOWN_STATE">This objective is consistent with the O.INTEGRITY objective of the
		Base-PP, which expects a conformant TOE to implement measures to maintain its own integrity.</con-mod>
      <con-mod ref="O.NONDISCLOSURE">This objective is consistent with the O.STORAGE objective of the
		Base-PP, which ensures that sensitive data is not disclosed without authorization.</con-mod>
      <con-mod ref="OE.NO_TOE_BYPASS ">This objective addresses behavior that is out of scope of the Base-PP
		and does not define an environment that an MDF TOE is incapable of existing in.</con-mod>
      <con-mod ref="OE.PHYSICAL">The operational environment of a mobile device cannot guarantee
		physical security, but the OE.PRECAUTION objective in the MDF PP
		ensures that an appropriate level of physical security is provided.</con-mod>
      <con-mod ref="OE.TRUSTED_CONFIG ">The expectation of trusted configuration is consistent with
		OE.CONFIG in the MDF PP.</con-mod>
	  
	  <!-- 6.2.4 Consistency of Requirements -->
	  <!-- This PP-Module identifies several SFRs from the MDF PP that are needed to support VPN client
		functionality. This is considered to be consistent because the functionality provided by the mobile
		device is being used for its intended purpose. The PP-Module also identifies a number of modified SFRs
		from the MDF PP as well as new SFRs that are used entirely to provide VPN client functionality. The
		rationale for why this does not conflict with SFRs defined by the MDF PP are as follows: -->

      <con-mod ref="md-fcs-ckm-1">The ST author is instructed to make specific selections at minimum to
		address VPN client requirements; the SFR behavior itself is unmodified.</con-mod>
      <con-mod ref="md-fcs-ckm-2-1">The ST author is instructed to make specific selections at minimum to
		address VPN client requirements; the SFR behavior itself is unmodified.</con-mod>
      <con-mod ref="md-fcs-cop-1-1">The ST author is instructed to make specific selections at minimum to
		address VPN client requirements; the SFR behavior itself is unmodified.</con-mod>
      <con-mod ref="md-fia-x509-ext-2">This PP-Module adds IPsec as a new trusted protocol where x.509
		certificate authentication is used.</con-mod>
      <con-mod ref="md-ftp-itc-ext-1">This PP-Module adds IPsec as a new protocol that is used to implement
		trusted channels.</con-mod>
		
	  <con-mod ref="fcs-ckm-1-vpn">This SFR defines the method of key generation for IKE peer authentication,
		which is a function that does not interfere with the functionality defined in
		the MDF PP.</con-mod>
      <con-mod ref="fcs-ipsec-ext-1">This SFR defines the VPN client’s IPsec implementation, which is added
		functionality that does not interfere with the MDF functions.</con-mod>
      <con-mod ref="fdp-rip-2">The requirement to protect against re-use of residual data is a property of
		the VPN client behavior and does not impact the MDF functionality.</con-mod>
      <con-mod ref="fmt-smf-1-vpn">The ability to configure the VPN client behavior does not affect whether the
		MDF as a whole can perform its security functions.</con-mod>
      <con-mod ref="fpt-tst-ext-1-vpn">Self-testing of the VPN client functionality does not impact the ability of the
		MDF to perform its security functions</con-mod>
		
      <con-mod ref="fau-gen-1-vpn">Audit records generated by the VPN client do not interfere with MDF
		functionality. The possibility of the underlying MDF platform generating
		audit records is consistent with the MDF PP, which already contains
		FAU_GEN.1.</con-mod>
      <con-mod ref="fau-sel-1-vpn">The ability to suppress the generation of certain VPN client audit records
		does not interfere with MDM functionality. The MDF PP already contains
		FAU_SEL.1 as an objective SFR which means that this functionality does not
		conflict with the expected behavior of a mobile device.</con-mod>
      <con-mod ref="fdp-ifc-ext-1-vpn">The ability of the VPN client to prevent split tunneling of IPsec traffic
		requires it to have hooks into lower-level mobile device behavior, but there
		are no requirements in the MDF PP that would prevent this functionality
		from being supported.</con-mod>
		
      <con-mod ref="fia-psk-ext-1">This SFR defines the use of pre-shared keys, which is behavior that only
		relates to the establishment of IPsec connections.</con-mod>
    </base-pp>

    <!-- 5.3 App PP Security Functional requirements Direction -->
    <base-pp version="3.1" name="Application Software" product="Application Software" short="App" url="https://www.niap-ccevs.org/Profile/Info.cfm?PPID=429" xmlurl="test">

      In a PP-Configuration that includes the App PP, the VPN client is expected to rely on some of the security
      functions implemented by the operating system as a whole and evaluated against the Base-PP. In this
      case, the following sections describe any modifications that the ST author must make to the SFRs
      defined in the Base-PP in addition to what is mandated by section 5.5.
      
      <!-- 5.3.1 Modified SFRs -->
      <modified-sfrs>
        The SFRs listed in this section are defined in the App PP and relevant to the secure operation of the VPN
        client. It is necessary for the ST author to complete selections and/or assignments for these SFRs in a
        specific manner in order to ensure that the functionality provided by the application is consistent with
        the functionality required by the VPN client in order for it to conform to this PP-Module.
        
        <subsection title="Cryptographic Support (FCS)" id="ap-m-fcs">
            
          <!-- 5.3.1.1 FCS_CKM.1(1) Cryptographic Asymmetric Key Generation -->
          <f-component cc-id="fcs_ckm.1" id="ap-fcs-ckm-1-1" name="Cryptographic Asymmetric Key Generation" iteration="1">
            <consistency-rationale>The ST author is instructed to make specific selections at minimum to
              address VPN client requirements; the SFR behavior itself is
              unmodified. Additionally, this behavior is selection-based in the App
              PP but is made mandatory since it is required for VPN client
              functionality.</consistency-rationale>
            <f-element id="ap-fcs-ckm-1e1i1">
              <title>The application shall 
                <selectables linebreak="yes">
                  <selectable>invoke platform-provided functionality</selectable>
                  <selectable>implement functionality</selectable>
                </selectables> to generate asymmetric cryptographic keys in accordance with a specified
                cryptographic key generation algorithm
                  <h:ul>
                    <h:li><h:b>[ECC schemes] using [“NIST curves” P-256, P-384, and 
                      <selectables>
                          <selectable>P-521</selectable>
                          <selectable>no other curves</selectable>
                      </selectables>] that meet the following: [FIPS PUB 186-4, “Digital Signature
                    Standard (DSS),” Appendix B.4], and,</h:b>
                    </h:li>
                  </h:ul> 
                  <selectables linebreak="yes">
                    <selectable><h:b>[FFC schemes] using cryptographic key sizes of [2048-bit or greater] that meet
                      the following: FIPS PUB 186-4, “Digital Signature Standard (DSS),” Appendix B.1</h:b></selectable>
                    <selectable><h:b>[FFC schemes] using Diffie-Hellman group 14 that meet the following: RFC 3526, Section 3,</h:b></selectable>
                    <selectable><h:b>[FFC Schemes using “safe-prime” groups] that meet the following: ‘NIST Special Publication 800-56A 
                      Revision 3, “Recommendation for Pair-Wise Key Establishment Schemes Using Discrete Logarithm
                      Cryptography” and 
                      <selectables>
                        <selectable>RFC 3526</selectable>
                        <selectable>RFC 7919</selectable>
                      </selectables>;</h:b>
                    </selectable>
                    <selectable>[RSA schemes] using cryptographic key sizes of [2048-bit or greater] that
                      meet the following: [FIPS PUB 186-4, “Digital Signature Standard (DSS),”
                      Appendix B.3];
                    </selectable>
                    <selectable>no other key generation methods
                    </selectable>
                  </selectables>
                </title>
                <note role="application">
                  This SFR is selection-based in the App PP depending on the selection made in
                  FCS_CKM_EXT.1. Because key generation services (whether implemented by the
                  TOE or invoked from the platform) are required for IPsec, this SFR is mandatory
                  for any TOE that claims conformance to this PP-Module.<h:p/>
                  This SFR is functionally identical to what is defined in the App PP except that ECC
                  key generation has been made mandatory in support of IPsec due to the
                  mandated support for DH groups 19, and 20 in FCS_IPSEC_EXT.1.8. RSA remains
                  present as a selection since it may be used by parts of the TOE that are not
                  specifically related to VPN client functionality.
                </note>
                <aactivity>   <!-- QQQQ -->
                  Refer to the evaluation activity for <no-link>FCS_CKM.1</no-link>(1) in the App PP for evaluating this SFR.
                  <no-tests/>
                </aactivity>
              </f-element>
              <audit-event/>
            </f-component>

            <!-- 5.3.1.2 FCS_CKM.2 Cryptographic Key Establishment -->
            <f-component cc-id="fcs_ckm.2" id="ap-fcs-ckm-2" name="Cryptographic Key Establishment">
              <consistency-rationale>The ST author is instructed to make specific selections at minimum to
                address VPN client requirements and is modified to include Diffie-Hellman Group 14 as an additional supported method for key
                establishment.</consistency-rationale>
              <f-element id="ap-fcs-ckm-2e1">
                <title>The application shall 
                  <selectables>
                    <selectable>invoke platform-provided functionality</selectable>
                    <selectable>implement functionality</selectable>
                  </selectables> to perform cryptographic key
                  establishment in accordance with a specified key establishment method:
                  <h:ul>
                    <h:li><h:b>[<h:i>Elliptic curve-based key establishment schemes</h:i>] that meets the following: [<h:i>NIST
                      Special Publication 800-56A, “Recommendation for Pair-Wise Key Establishment
                      Schemes Using Discrete Logarithm Cryptography”</h:i>]; and</h:b>
                    </h:li>
                  </h:ul>
                  <selectables linebreak="yes">
                    <selectable>[Finite field-based key establishment schemes] that meets the following: [NIST
                      Special Publication 800-56A, “Recommendation for Pair-Wise Key Establishment
                      Schemes Using Discrete Logarithm Cryptography”]</selectable>
                    <selectable>Key establishment scheme using Diffie-Hellman group 14] that meets the
                      following: [RFC 3526, Section 3,</selectable>
                    <selectable>[FFC Schemes using “safe-prime” groups]that meet the following: ‘NIST Special
                      Publication 800-56A Revision 3, “Recommendation for Pair-Wise Key
                      Establishment Schemes Using Discrete Logarithm Cryptography” and 
                      <selectables>
                        <selectable>RFC 3526</selectable>
                        <selectable>RFC 7919</selectable>
                      </selectables>
                    </selectable>
                    <selectable> [RSA-based key establishment schemes] that meets the following: RSAES-PKCS1-v1_5 as specified
                      in Section 7.2 of RFC 8017, “Public-Key Cryptography Standards (PKCS) #1: RSA Cryptography Specifications
                      Version 2.2</selectable>
                    <selectable>[RSA-based key establishment schemes] that meet the following: [NIST Special
                      Publication 800-56B, “Recommendation for Pair-Wise Key Establishment
                      Schemes Using Integer Factorization Cryptography”]</selectable>
                    <selectable>No other schemes</selectable>
                  </selectables>.
                </title>
                <note role="application">
                  This SFR differs from its definition in the App PP by moving elliptic curve-based
                  key establishment schemes from selectable to mandatory (due to the mandated
                  support for DH groups 19 and 20 in FCS_IPSEC_EXT.1.8). It also provides the
                  ability to claim at least one of NIST SP 800-56A, RFC 3526, or NIST SP 800-56A
                  rev. 3 “safe-prime” groups for key establishment using finite field cryptography.</note>
                <aactivity>   <!-- QQQQ -->
                  For all key establishment schemes refer to the evaluation activity for <no-link>FCS_CKM.2</no-link> in the App PP.
                  <no-tests/>
                </aactivity>
              </f-element>
              <audit-event/>
            </f-component>

            <!-- 5.3.1.3 FCS_CKM_EXT.1 Cryptographic Key Generation Services -->          
            <f-component name="Cryptographic Key Generation Services" cc-id="fcs_ckm_ext.1" id="ap-fcs-ckm-ext-1">
              <consistency-rationale>The ST author is instructed to make specific selections at minimum to
                address VPN client requirements; specifically, since key generation
                services are required in some capacity in order to support VPN
                functionality, the ST author loses the choice of stating that the
                application does not have any key generation functionality.
                Additionally, this behavior is selection-based in the App PP but is made
                mandatory since it is required for VPN client functionality.</consistency-rationale>
              <f-element id="ap-fcs-ckm-ext.1e1">
                <title>The application shall 
                  <selectables>
                    <selectable>invoke platform-provided functionality for asymmetric key generation</selectable>
                    <selectable>implement asymmetric key generation</selectable>
                  </selectables>.
                </title>
                <note role="application">
                  This selection differs from its definition in the App PP by
                  removing the selection for “generate no asymmetric cryptographic keys” for this PP-Module because a VPN Client
                  TOE will either perform its own key generation or interface with the underlying platform to provide this 
                  service, either of which causes <no-link>FCS_CKM.1</no-link>(1) to be claimed.
                </note>
                <aactivity>   <!-- QQQQ -->
                  This SFR is evaluated in conjunction with <no-link>FCS_CKM.1</no-link>(1) in the App PP.
                  <no-tests/>
                </aactivity>
              </f-element>
              <audit-event/>
            </f-component>

            <!-- 5.3.1.4 FCS_COP.1(1) Cryptographic Operation - Encryption/Decryption -->
            <f-component cc-id="fcs_cop.1" id="ap-fcs-cop-1-1" name="Cryptographic Operation" iteration="1">
              <consistency-rationale>The ST author is instructed to make specific selections at minimum to
                address VPN client requirements; the SFR behavior itself is
                unmodified.</consistency-rationale>
              <f-element id="ap-fcs-cop-1e1i1">
                <title>The application shall perform encryption/decryption in accordance with
                  a specified cryptographic algorithm <h:b>
                  <h:ul>
                    <h:li>AES-CBC (as defined in NIST SP 800-38A) mode,</h:li>
                    <h:li>AES-GCM (as defined in NIST SP 800-38D) mode,</h:li>
                  </h:ul>; and </h:b>
                  <selectables linebreak="yes">
                    <selectable>AES-XTS (as defined in NIST SP 800-38E) mode</selectable>
                    <selectable><h:b>no other modes</h:b></selectable>
                  </selectables>
                  and cryptographic key sizes [<h:i>128-bit, 256-bit</h:i>].
                </title>
                <note role="application">
                  This SFR is selection-based in the Base-PP and remains selection-based here because
                  this PP-Module allows for the possibility that the TSF relies on platform-provided
                  cryptographic algorithm services for its own implementation of IPsec. However, if
                  the TSF does claim this SFR to support IPsec, the ST author must select at minimum
                  both AES-CBC and AES-GCM with both 128-bit and 256-bit key sizes for consistency
                  with the relevant IPsec claims (FCS_IPSEC_EXT.1.4 requires both 128-bit and 256-bit
                  AES-GCM and FCS_IPSEC_EXT.1.6 requires both 128-bit and 256-bit AES-CBC).
                </note>
                <aactivity>   <!-- QQQQ -->
                  Refer to the evaluation activity for <no-link>FCS_COP.1</no-link>(1) in the App PP.
                  <no-tests/>
                </aactivity>
              </f-element>
              <audit-event/>
            </f-component>
          </subsection>
        
          <subsection title="Identification and Authentication (FIA)" id="ap-m-fia">
            
            <!-- 5.3.1.5 FIA_X509_EXT.2 X.509 Certificate Authentication -->
            <f-component cc-id="fia_x509_ext.2" id="ap-fia-x509-ext-2" name="X.509 Certificate Authentication">
              <consistency-rationale>This PP-Module adds IPsec as a new trusted protocol where x.509
                certificate authentication is used.</consistency-rationale>
              <f-element id="ap-fia-x509-ext-2e1">
                <title>The application shall use X.509v3 certificates as defined by RFC 5280 to support
                  authentication for <h:b>IPsec</h:b> and [<h:b>no other protocols</h:b>].
                </title>
              </f-element>
              <f-element id="ap-fia-x509-ext-2e2">
                <title>When the application cannot establish a connection to determine the validity of a
                  certificate, the TSF shall 
                  <selectables>
                    <selectable>allow the administrator to choose whether to accept the certificate in these cases</selectable>
                    <selectable>accept the certificate</selectable>
                    <selectable>not accept the certificate</selectable>
                  </selectables>.
                </title>
                <note role="application">
                  This SFR is identical to what is defined in the App PP except that mandatory
                  support for IPsec is added. Additionally, because this SFR is selection-based in
                  the App PP but is mandatory for VPN client usage, the ‘no other protocols’
                  selection item has been added since it is expected that IPsec is the TOE’s only use
                  of certificates.
                </note>
                <aactivity>  <!-- QQQQ -->
                  Refer to the evaluation activity for <no-link>FIA_X509_EXT.2</no-link> in the App PP.
                  <no-tests/>
                </aactivity>
              </f-element>
              <audit-event/>
            </f-component>
          </subsection>
        
          <subsection title="Trusted Path/Channels (FTP)" id="ap-m-ftp">
            
            <!-- 5.3.1.6 FTP_DIT_EXT.1 Protection of Data in Transit -->
            <f-component cc-id="ftp_dit_ext.1" id="ap-ftp-dit-ext-1" name="Protection of Data in Transit">
              <consistency-rationale>This PP-Module adds IPsec as a new protocol that is used to
                implement trusted channels.</consistency-rationale>
              <f-element id="ap-ftp-dit-ext-1e1">
                <title>The application shall [<h:i>not encrypt any [sensitive data]]</h:i> between itself
                  and another trusted IT product.
                </title>
                <note role="application">
                  The VPN client itself is the application, and does not maintain any sensitive data
                  of its own. Therefore, there is no need to protect (through FTP_DIT_EXT.1.1)
                  VPN-client-specific data.                
                </note>
                <aactivity>  <!-- QQQQ -->
                  For IPsec, refer to the evaluation activity for FCS_IPSEC_EXT.1.<h:p/>
                  If this SFR is iterated to select additional protocols for other uses, refer to the evaluation activity 
                  for <no-link>FTP_DIT_EXT.1</no-link> in the App PP.
                  <no-tests/>
                </aactivity>
              </f-element>
              <audit-event/>
            </f-component>
          </subsection>
      </modified-sfrs>
      
      <!-- 5.3.2 Additional SFRs -->
      <additional-sfrs>
        This section lists additional SFRs that must be added to the TOE boundary in order to implement the
        functionality in any PP-Configuration where the App PP is claimed as the Base-PP.

        <subsection title="Cryptographic Support (FCS)" id="md-a-fcs">
          
          <!-- 5.3.2.1 FCS_CKM_EXT.2 Cryptographic Key Storage -->
          <f-component cc-id="fcs_ckm_ext.2" id="ap-fcs-ckm-ext-2" name="Cryptographic Key Storage"  notnew='true'>
            <consistency-rationale>This PP-Module adds a requirement for key storage, which is new
              functionality when compared to the Base-PP but does not interfere
              with its existing security functions.</consistency-rationale>
            <comp-lev>requires the TSF to securely store key data when not in
              use.</comp-lev>
            <management>No specific management functions are identified.
            </management>
            <audit>There are no auditable events foreseen.
            </audit>
            <dependencies>No dependencies</dependencies>
            <f-element id="ap-fcs-ckm-ext-2e1">
              <title>The 
                <selectables>
                  <selectable>TOE</selectable>
                  <selectable>TOE platform</selectable>
                </selectables> shall store persistent secrets and private keys
                when not in use in platform-provided key storage.
              </title>
              <note role="application">
                This requirement ensures that persistent secrets and private keys are stored
                securely when not in use. This differs from FCS_STO_EXT.1 in the Base-PP, which
                only applies to secure storage of administrative credentials. If some secrets/keys
                are manipulated by the TOE and others are manipulated by the platform, then
                both of the selections can be specified by the ST author.
              </note>
              <aactivity>    <!-- QQQQ -->
                <TSS>Regardless of whether this requirement is met by the TOE or the TOE platform, the evaluator will
                  check the TSS to ensure that it lists each persistent secret (credential, secret key) and private key
                  needed to meet the requirements in the ST. For each of these items, the evaluator will confirm that
                  the TSS lists for what purpose it is used, and how it is stored. The evaluator then performs the
                  following actions: <h:p/>

                  <h:b>Persistent secrets and private keys manipulated by the platform:</h:b><h:p/>

                For each platform listed in the ST, the evaluator shall examine the ST of the platform to ensure that
                the persistent secrets and private keys listed as being stored by the platform in the VPN client ST are
                identified as being protected in that platform's ST.<h:p/>

                  <h:b>Persistent secrets and private keys manipulated by the TOE:</h:b><h:p/>

                  The evaluator reviews the TSS for to determine that it makes a case that, for each item listed as
                  being manipulated by the TOE, it is not written unencrypted to persistent memory, and that the item
                  is stored by the platform.<h:p/>
                </TSS>
                <Guidance>There are no guidance evaluation activities for this component.<h:p/></Guidance>
                <Tests>There are no test evaluation activities for this component.</Tests>
              </aactivity>
            </f-element>
            <audit-event/>
          </f-component>

          <!-- 5.3.2.2 FCS_CKM_EXT.4 Cryptographic Key Destruction -->
          <f-component cc-id="fcs_ckm_ext.4" id="ap-fcs-ckm-ext-4" name="Cryptographic Key Destruction">
            <consistency-rationale>This PP-Module adds a requirement for key destruction, which is new
              functionality when compared to the Base-PP but does not interfere
              with its existing security functions.</consistency-rationale>
            <comp-lev>requires the TSF to destroy key data when no longer
              required.</comp-lev>
            <management>No specific management functions are identified.
            </management>
            <audit>There are no auditable events foreseen.
            </audit>
            <dependencies>No dependencies</dependencies>
            <f-element id="ap-fcs-ckm-ext-4e1">
              <title>The 
                <selectables>
                  <selectable>TOE</selectable>
                  <selectable>TOE platform</selectable>
                </selectables> 
                shall zeroize all plaintext secret and private cryptographic keys and CSPs when no longer required.
              </title>
              <note role="application">
                Any security related information (such as keys, authentication data, and
                passwords) must be zeroized when no longer in use to prevent the disclosure or
                modification of security critical data.<h:p/>

                The zeroization indicated above applies to each intermediate storage area for
                plaintext key/CSP (i.e., any storage, such as memory buffers, that is included in
                the path of such data) upon the transfer of the key/CSP to another location.<h:p/>

                In practice, the TOE will not implement all of the functionality associated with
                the requirement, since if it performs zeroization at all it will be by invoking
                platform interfaces to perform the storage location clear/overwrite function. The
                ST author should select "TOE" when, for at least one of the keys needed to meet
                the requirements of this PP, the TOE manipulates (reads, writes) the data
                identified in the requirement and thus needs to ensure that those data are
                cleared. In these cases, it is sufficient for the TOE to invoke the correct
                underlying functions of the host to perform the zeroization--it does not imply
                that the TOE has to include a kernel-mode memory driver to ensure the data are
                zeroized.<h:p/>

                In the likely event that some of the data are manipulated by the TOE and other
                data are manipulated entirely by the platform, the ST author must select both
                options.
              </note>
              <aactivity>   <!-- QQQQ -->
                <TSS>The evaluator shall ensure that all plaintext secret and private cryptographic keys and CSPs (whether
                  manipulated by the TOE or exclusively by the platform) are identified in the VPN Client ST's TSS, and
                  that they are accounted for by the evaluation activity in this section. <h:p/>

                  <h:b>Requirement met by the platform:</h:b><h:p/>

                  The evaluator shall check to ensure the TSS describes each of the secret keys (keys used for
                  symmetric encryption), private keys, and CSPs used to generate key that are not otherwise covered
                  by the FCS_CKM_EXT.4 requirement levied on the TOE.<h:p/>
                  For each platform listed in the ST, the evaluator shall examine the TSS of the ST of the platform to
                  ensure that each of the secret keys, private keys, and CSPs used to generate key listed above are
                  covered. <h:p/>

                  <h:b>Requirement met by the TOE:</h:b><h:p/>

                  The evaluator shall check to ensure the TSS describes when each of the plaintext keys are cleared
                  (e.g., system power off, disconnection of an IPsec connection, when no longer needed by the VPN
                  channel per the protocol); and the type of clearing procedure that is performed (cryptographic
                  erase, overwrite with zeros, overwrite three or more times by a different alternating pattern,
                  overwrite with random pattern, or block erase). If different types of memory are used to store the
                  materials to be protected, the evaluator shall check to ensure that the TSS describes the clearing
                  procedure in terms of the memory in which the data are stored (for example, "secret keys stored on
                  flash are cleared by overwriting once with zeros, while secret keys stored on the internal persistent
                  storage device are cleared by overwriting three times with a random pattern that is changed before
                  each write").<h:p/></TSS>
                <Guidance>There are no guidance evaluation activities for this component.<h:p/></Guidance>
                <Tests>For each key clearing situation described in the TSS, the evaluator shall repeat the following test.
                <testlist>
                  <test>The evaluator shall utilize appropriate combinations of specialized operational environment
                    and development tools (debuggers, simulators, etc.) for the TOE and instrumented TOE builds to test
                    that keys are cleared correctly, including all intermediate copies of the key that may have been
                    created internally by the TOE during normal cryptographic processing with that key.<h:p/>
                    Cryptographic TOE implementations in software shall be loaded and exercised under a debugger to
                    perform such tests. The evaluator shall perform the following test for each key subject to clearing,
                    including intermediate copies of keys that are persisted encrypted by the TOE:<h:p/>
                    1. Load the instrumented TOE build in a debugger.<h:br/>
                    2. Record the value of the key in the TOE subject to clearing.<h:br/>
                    3. Cause the TOE to perform a normal cryptographic processing with the key from #1.<h:br/>
                    4. Cause the TOE to clear the key.<h:br/>
                    5. Cause the TOE to stop the execution but not exit.<h:br/>
                    6. Cause the TOE to dump the entire memory footprint of the TOE into a binary file.<h:br/>
                    7. Search the content of the binary file created in #4 for instances of the known key value from
                    #1.<h:p/>
                    The test succeeds if no copies of the key from #1 are found in step #7 above and fails otherwise.<h:p/>
                    The evaluator shall perform this test on all keys, including those persisted in encrypted form, to ensure intermediate copies are erased.</test>
                </testlist>
                </Tests>
              </aactivity>
            </f-element>
            <audit-event/>
          </f-component>
        </subsection>
      </additional-sfrs>

	  <!-- 6.3 App PP Base -->
	  <!-- 6.3.1 Consistency of TOE Type -->
      <con-toe>If this PP-Module is used to extend the App PP, the TOE type for the overall TOE is still a software
		application. The TOE boundary is made more specific by defining the TOE as a specific type of
		application. </con-toe>
      <con-sec-prob>The threats and assumptions defined by this PP-Module (see sections 3.1 and 3.2) supplement those
		defined in the App PP as follows:</con-sec-prob>
      <con-obj>The security objectives defined by this PP-Module (see sections 4.1 and 4.2) supplement those defined
		in the App PP as follows:</con-obj>
      <con-op-en></con-op-en>
	  
	  <!-- 6.3.2 Consistency of the Security Problem Definition -->
      <con-mod ref="T.UNAUTHORIZED_ACCESS">The threat of an attacker gaining access to a network interface or data
		that is transmitted over it is consistent with the T.NETWORK_ATTACK and
		T.NETWORK_EAVESDROP threats in the App PP.</con-mod>
      <con-mod ref="T.TSF_CONFIGURATION">The threat of a mis-configured VPN client is consistent with the
		T.LOCAL_ATTACK threat in the App PP.</con-mod>
      <con-mod ref="T.USER_DATA_REUSE">Inadvertent disclosure of user data to an unauthorized recipient is
		consistent with the T.NETWORK_EAVESDROP threat in the App PP.</con-mod>
      <con-mod ref="T.TSF_FAILURE">A failure of TSF functionality could compromise the local system, which is
		consistent with the T.LOCAL_ATTACK threat in the App PP.</con-mod>
      <con-mod ref="A.NO_TOE_BYPASS">The A.NO_TOE_BYPASS assumption assumes that the operational
		environment is configured in such a manner that the only network route
		to the protected network is through the TOE. This does not conflict with
		the App PP because the App PP makes no assumptions about the network
		architecture in which the TOE is deployed.</con-mod>
      <con-mod ref="A.PHYSICAL">The assumption that physical security is provided by the environment is
		not explicitly stated in the App PP but is consistent with the A.PLATFORM
		assumption defined in the App PP, which expects the computing platform
		to be trusted.</con-mod>
      <con-mod ref="A.TRUSTED_CONFIG">The assumption that personnel responsible for the TOE’s configuration are
		trusted to follow the guidance is consistent with the A.PROPER_ADMIN
		defined in the App PP.</con-mod>
		
	  <!-- 6.3.3 Consistency of Objectives -->
      <con-mod ref="O.AUTHENTICATION">This objective is consistent with the O.PROTECTED_COMMS
		objective of the Base-PP, which also expects that trusted remote
		channels will enforce authentication of remote endpoints.</con-mod>
      <con-mod ref="O.CRYPTOGRAPHIC_FUNCTIONS">This objective is consistent with the O.PROTECTED_COMMS
		objective of the Base-PP, which also expects that secure
		cryptographic functions are used to implement trusted
		communications.</con-mod>
      <con-mod ref="O.KNOWN_STATE">This objective is consistent with the O.INTEGRITY objective of the
		Base-PP, which expects a conformant TOE to implement measures
		to maintain its own integrity.</con-mod>
      <con-mod ref="O.NONDISCLOSURE">This objective is consistent with the O.PROTECTED_STORAGE
		objective of the Base-PP, which ensures that sensitive data is not
		disclosed without authorization.</con-mod>
      <con-mod ref="OE.NO_TOE_BYPASS ">This objective addresses behavior that is out of scope of the Base-PP
		and does not define an environment that is globally applicable to all
		software applications.</con-mod>
      <con-mod ref="OE.PHYSICAL">This is part of satisfying OE.PLATFORM as defined in the App PP
		because physical security is required for the underlying platform to
		be considered ‘trustworthy’.</con-mod>
      <con-mod ref="OE.TRUSTED_CONFIG ">The expectation of trusted configuration is consistent with
		OE.PROPER_USER and OE.PROPER_ADMIN in the App PP.</con-mod>	  
	  
	  <!-- 6.3.4 Consistency of Requirements -->
	  <!-- This PP-Module identifies several SFRs from the App PP that are needed to support VPN client
		functionality. This is considered to be consistent because the functionality provided by the application is
		being used for its intended purpose. The PP-Module also identifies a number of modified SFRs from the
		App PP as well as new SFRs that are used entirely to provide VPN client functionality. The rationale for
		why this does not conflict with SFRs defined by the App PP are as follows: -->
	  
      <con-mod ref="ap-fcs-ckm-1-1">The ST author is instructed to make specific selections at minimum to
		address VPN client requirements; the SFR behavior itself is unmodified.
		Additionally, this behavior is selection-based in the App PP but is made
		mandatory since it is required for VPN client functionality.</con-mod>
      <con-mod ref="ap-fcs-ckm-2-1">The ST author is instructed to make specific selections at minimum to
		address VPN client requirements and is modified to include Diffie-Hellman
		Group 14 as an additional supported method for key establishment.</con-mod>
      <con-mod ref="ap-fcs-ckm-ext-1">The ST author is instructed to make specific selections at minimum to
		address VPN client requirements; specifically, since key generation services
		are required in some capacity in order to support VPN functionality, the ST
		author loses the choice of stating that the application does not have any key
		generation functionality. Additionally, this behavior is selection-based in the
		App PP but is made mandatory since it is required for VPN client
		functionality</con-mod>
      <con-mod ref="ap-fcs-cop-1-1">The ST author is given guidance to make specific selections if this selectionbased SFR is claimed in support of IPsec functionality. The SFR behavior itself
		is unmodified.</con-mod>
      <con-mod ref="ap-fia-x509-ext-2">This PP-Module adds IPsec as a new trusted protocol where x.509 certificate
		authentication is used.</con-mod>
      <con-mod ref="ap-ftp-dit-ext-1">This PP-Module is for the VPN Client application and does not maintain any
		sensitive data of its own. Therefore, there is no need to protect (through
		FTP_DIT_EXT.1.1) VPN-client-specific data.</con-mod>

      <con-mod ref="ap-fcs-ckm-ext-2">This PP-Module adds a requirement for key storage, which is new
		functionality when compared to the Base-PP but does not interfere with its existing security functions.</con-mod>
      <con-mod ref="ap-fcs-ckm-ext-4">This PP-Module adds a requirement for key destruction, which is new
		functionality when compared to the Base-PP but does not interfere with its
		existing security functions.</con-mod>

      <con-mod ref="fcs-ckm-1-vpn">This SFR defines the method of key generation for IKE peer authentication,
		which is a function that does not interfere with the functionality defined in the App PP.</con-mod>
      <con-mod ref="fcs-ipsec-ext-1">This SFR defines the VPN client’s IPsec implementation, which is added
		functionality that does not interfere with the application functions.</con-mod>
      <con-mod ref="fdp-rip-2">The requirement to protect against re-use of residual data is a property of
		the VPN client behavior and does not impact the general application functionality. </con-mod>
      <con-mod ref="fmt-smf-1-vpn">The ability to configure the VPN client behavior does not affect whether the
		application as a whole can perform its security functions.</con-mod>
      <con-mod ref="fpt-tst-ext-1-vpn">Self-testing of the VPN client functionality does not impact the ability of the
		application to perform its security functions</con-mod>
		
      <con-mod ref="fau-gen-1-vpn">Audit records generated by the VPN client do not interfere with application
		functionality. For cases where auditing is performed by the TOE platform, a
		software application is installed on a general purpose operating system or
		mobile device, both of which can reasonably be expected to provide audit
		functionality.</con-mod>
      <con-mod ref="fau-sel-1-vpn">The ability to suppress the generation of certain audit records related to VPN
		activity does not interfere with the ability of the application to satisfy its security functionality.</con-mod>
      <con-mod ref="fdp-ifc-ext-1">The ability of the VPN client to prevent split tunneling of IPsec traffic
		requires it to have hooks into lower-level OS behavior, but there are no
		requirements in the App PP that would prevent this functionality from being supported.</con-mod>

      <con-mod ref="fia-psk-ext-1">This SFR defines the use of pre-shared keys, which is behavior that only
		relates to the establishment of IPsec connections.</con-mod>

    </base-pp>

    <!-- 5.4 MDM PP Security Functional Requirements Direction -->
    <base-pp version="3.1" name="Mobile Device Fundamentals" product="Mobile Device" short="MD" url="https://www.niap-ccevs.org/Profile/Info.cfm?PPID=417" xmlurl="test">

      In a PP-Configuration that includes the MDM PP, the VPN client is expected to rely on some of the
      security functions implemented by the operating system as a whole and evaluated against the Base-PP.
      In this case, the following sections describe any modifications that the ST author must make to the SFRs
      defined in the Base-PP in addition to what is mandated by section 5.5.
      
      <!-- 5.4.1 Modified SFRs -->  
      <modified-sfrs>
        The SFRs listed in this section are defined in the MDM PP and relevant to the secure operation of the
        VPN client. It is necessary for the ST author to complete selections and/or assignments for these SFRs in
        a specific manner in order to ensure that the functionality provided by the application is consistent with
        the functionality required by the VPN client in order for it to conform to this PP-Module.
        
        <subsection title="Cryptographic Support (FCS)" id="dm-m-fcs">
          
          <!-- 5.4.1.1 FCS_CKM.1 Cryptographic Key Generation -->
          <f-component cc-id="fcs_ckm.1" id="dm-fcs-ckm-1" name="Cryptographic Key Generation">
            <consistency-rationale>The ST author is instructed to make specific selections at minimum to
              address VPN client requirements; the SFR behavior itself is
              unmodified.</consistency-rationale>
            <f-element id="dm-fcs-ckm-1e1">
              <title>The TSF shall 
                <selectables>
                  <selectable>invoke platform-provided functionality</selectable>
                  <selectable>implement functionality</selectable>
                </selectables>
                to generate asymmetric cryptographic keys in accordance with a specified cryptographic key
                generation algorithm: 
                <h:ul>
                  <h:li><h:b>ECC schemes using “NIST curves” P-256, P-384, and 
                      <selectables>
                        <selectable>P-521</selectable>
                        <selectable>no other curves</selectable>
                      </selectables> 
                      that meet the following: FIPS PUB 186-4, “Digital Signature Standard (DSS),” Appendix B.4, and</h:b>
                  </h:li>
                </h:ul>
                <selectables linebreak="yes">
                  <selectable>RSA schemes using cryptographic key sizes of 2048-bit or greater that meet
                    FIPS PUB 186-4, "Digital Signature Standard (DSS),” Appendix B.3,</selectable>
                  <selectable>FFC schemes using cryptographic key sizes of 2048-bit or greater that meet
                    the following: FIPS PU 186-4, “Digital Signature Standards (DSS),” Appendix B.4,</selectable>
                  <selectable>FFC schemes using “safe-prime” groups that meet the following: ‘NIST
                    Special Publication 800-56A Revision 3, “ Recommendation for Pair-Wise Key
                    Establishment Schemes Using Discrete Logarithm Cryptography,” and
                    <selectables>
                      <selectable>RFC 3526</selectable>
                      <selectable>RFC 7919</selectable>
                    </selectables>,</selectable>
                  <selectable><h:b>FFC schemes using Diffie-Hellman group 14 that meets the following: RFC
                    3526, Section 3, </h:b></selectable>
                  <selectable><h:b>No other key generation schemes</h:b></selectable>
                </selectables>.
              </title>
              <note role="application">
                This SFR is modified from its definition in the MDM PP by mandating the key
                generation algorithms that are required by this PP-Module in support of IPsec due to
                the mandated support for DH groups 19 and 20 in FCS_IPSEC_EXT.1.8. Other
                selections may be chosen by the ST author as needed for parts of the TOE that are
                not specifically related to VPN client functionality
              </note>
              <aactivity>  <!-- QQQQ -->
                Refer to the evaluation activity for <no-link>FCS_CKM.1</no-link> in the MDM PP for evaluating this SFR. <h:p/>
                Testing for FFC schemes using Diffie-Hellman group 14 is done as part of testing for <no-link>FCS_CKM.2</no-link>.
                <no-tests/>
              </aactivity>
            </f-element>
            <audit-event/>
          </f-component>

          <!-- 5.4.1.2 FCS_CKM.2 Cryptographic Key Establishment -->
          <f-component cc-id="fcs_ckm.2" id="dm-fcs-ckm-2" name="Cryptographic Key Establishment">
            <consistency-rationale>The ST author is instructed to make specific selections at minimum to
              address VPN client requirements; the SFR behavior itself is
              unmodified.</consistency-rationale>
            <f-element id="dm-fcs-ckm-2e1">
              <title>The TSF shall 
                <selectables>
                  <selectable>invoke platform-provided functionality</selectable>
                  <selectable>implement functionality</selectable>
                </selectables>
                to perform cryptographic key establishment in accordance with a specified key establishment method:
                <h:ul>
                  <h:li><h:b>Elliptic curve-based key establishment schemes that meets the following:
                    NIST Special Publication 800-56A Revision 3, “Recommendation for Pair-Wise Key
                    Establishment Schemes Using Discrete Logarithm Cryptography,”</h:b>
                  </h:li>
                </h:ul>and
                <selectables linebreak="yes">                  
                  <selectable>RSA-based key establishment schemes that meet the following: 
                    RSAES-PKCS1-v1_5 as specified in Section 7.2 of RFC 8017, “Public-Key Cryptography Standards
                    (PKCS) #1: RSA Cryptography Specifications Version 2.1,"</selectable>
                  <selectable>Finite field-based key establishment schemes that meets the following: NIST
                    Special Publication 800-56A Revision 3, “Recommendation for Pair-Wise Key
                    Establishment Schemes Using Discrete Logarithm Cryptography”</selectable>
                  <selectable>FFC schemes using "safe-prime" groups that meet the following: 'NIST
                    Special Publication 800-56A Revision 3, "Recommendation for Pair-Wise Key
                    Establishment Schemes Using Discrete Logarithm Cryptography,"' and
                    <selectables>
                      <selectable>RFC 3526</selectable>
                      <selectable>RFC 7919</selectable>
                    </selectables>
                  </selectable>
                  <selectable>Key establishment scheme using Diffie-Hellman group 14 that meets the
                    following: RFC 3526, Section 3</selectable>
                  <selectable><h:b>No other schemes</h:b></selectable>
                </selectables>.
              </title>
              <note role="application">
                This SFR is modified from its definition in the MDM PP by mandating the key
                establishment algorithms that are required by this PP-Module in support of IPsec due
                to the mandated support for DH groups 19 and 20 in FCS_IPSEC_EXT.1.8. Other
                selections may be chosen by the ST author as needed for parts of the TOE that are
                not specifically related to VPN client functionality.
              </note>
              <aactivity> <!-- QQQQ -->
                For all key establishment schemes that conform to NIST SP 800-56A or 800-56B, refer to the
                evaluation activity for <no-link>FCS_CKM.2</no-link>(1) in the MD PP.<h:p/>
                If “Key establishment scheme using Diffie-Hellman group 14…” is selected, the evaluator shall ensure
                that the TSS describes how the implementation meets RFC 3526 Section 3. The evaluator shall also
                verify the correctness of the TSF’s implementation of Diffie-Hellman group 14 by using a known good
                implementation for each protocol selected in <no-link>FTP_ITC_EXT.1</no-link> in the MD PP that
                uses Diffie-Hellman group 14. Note that because a TOE that conforms to this PP-Module must
                implement IPsec, the tested protocols shall include IPsec at minimum.
                <no-tests/>
              </aactivity>
            </f-element>
            <audit-event/>
          </f-component>

          <!-- 5.4.1.3 FCS_COP.1(1) Cryptographic Operation (Confidentiality Algorithms) -->
          <f-component cc-id="fcs_cop.1" id="dm-fcs-cop-1-1" name="Cryptographic Operation" iteration="1">
            <consistency-rationale>The ST author is instructed to make specific selections at minimum to
              address VPN client requirements; the SFR behavior itself is
              unmodified.</consistency-rationale>
            <f-element id="dm-fcs-cop-1e1i1">
              <title>The TSF shall
                <selectables>
                  <selectable>invoke platform-provided functionality</selectable>
                  <selectable>implement functionality</selectable>
                </selectables>
                perform encryption/decryption in accordance with a specified cryptographic algorithm
                <h:ul><h:b>
                  <h:li>AES-CBC (as defined in FIPS PUB 197, NIST SP 800-38A),</h:li>
                  <h:li>AES-GCM (as defined in NIST SP 800-38D), and</h:li></h:b>
                </h:ul>
                <selectables linebreak="yes">
                  <selectable>AES Key Wrap (KW) (as defined in NIST SP 800-38F)</selectable>
                  <selectable>AES Key Wrap with Padding (KWP) (as defined in NIST SP 800-38F)</selectable>
                  <selectable>AES-CCM (as defined in NIST SP 800-38C)</selectable>
                  <selectable>no other modes</selectable>
                </selectables>
                and cryptographic key sizes [<h:i>128-bit, 256-bit</h:i>].
              </title>
              <note role="application">
                This SFR is modified from its definition in the Base-PP by mandating support for both
                128-bit and 256-bit implementations of AES-CBC (which this PP-Module requires for
                the use of IKE and allows for the use of ESP) and AES-GCM (which this PP-Module
                requires for the use of ESP and allows for the use of IKE). Other AES modes may be
                selected by the ST author as needed to address functions not required by this PPModule.
              </note>
              <aactivity>  <!-- QQQQ -->
                Refer to the evaluation activity for <no-link>FCS_COP.1</no-link>(1) in the MD PP.
                <no-tests/>
              </aactivity>
            </f-element>
            <audit-event/>
          </f-component>
        </subsection>
        
        <subsection title="Identification and Authentication (FIA)" id="dm-m-fia">
          
          <!-- 5.4.1.4 FIA_X509_EXT.2 X.509 Certificate Authentication -->
          <f-component cc-id="fia_x509_ext.2" id="dm-fia-x509-ext-2" name="X.509 Certificate Authentication">
            <consistency-rationale>This PP-Module adds IPsec as a new trusted protocol where x.509
              certificate authentication is used.</consistency-rationale>
            <f-element id="dm-fia-x509-ext-2e1">
              <title>The TSF shall
                <selectables>
                  <selectable>
                    Invoke platform-provided functionality to use X.509v3 certificates as defined by
                    RFC 5280 to support authentication for 
                    <selectables>
                      <selectable><h:s>IPsec</h:s></selectable>
                      <selectable>HTTPS</selectable>
                      <selectable>TLS</selectable>
                      <selectable>DTLS</selectable>
                      <selectable>SSH</selectable>
                      <selectable>no protocols</selectable>
                    </selectables> and 
                    <selectables linebreak="yes">
                      <selectable>code signing for system software updates</selectable>
                      <selectable>code signing for integrity verification</selectable>
                      <selectable>policy signing</selectable>
                      <selectable><assignable>other uses</assignable></selectable>
                      <selectable>no additional uses</selectable>
                    </selectables>
                  </selectable>
                  <selectable>use X.509v3 certificates as defined by RFC 5280 to support
                    authentication for 
                    <h:ul>
                      <h:li><h:b>IPsec as specified in the PP-Module for VPN client and</h:b></h:li>
                    </h:ul>
                    <selectables linebreak="yes">
                      <selectable>HTTPS in accordance with FCS_HTTPS_EXT.1</selectable>
                      <selectable>TLS as defined in the Package for Transport Layer Security</selectable>
                      <selectable>DTLS as defined in the Package for Transport Layer Security</selectable>
                      <selectable>SSH as defined in the Extended Package for Secure Shell</selectable>
                      <selectable>no other protocols</selectable>
                    </selectables>, and
                    <selectables linebreak="yes">
                      <selectable>code signing for system software updates</selectable>
                      <selectable>code signing for integrity verification</selectable>
                      <selectable>policy signing</selectable>
                      <selectable><assignable>other uses</assignable></selectable>
                      <selectable>no additional uses</selectable>
                    </selectables>
                  </selectable>
                </selectables>.
              </title>
              <note role="application">
                The PP-Module requires the TOE to implement its own X.509 authentication
                mechanism in support of IPsec communications. Other selections may be chosen by
                the ST author as needed for parts of the TOE that are not specifically related to VPN
                client functionality. The TSF may also rely on a platform-provided mechanism for
                uses of X.509 that do not relate to the establishment of trusted communications, as
                specified in the original SFR. FIA_X509_EXT.2.2 has not been included here as the PPModule 
                does not modify this element.
              </note>
              <aactivity>  <!-- QQQQ -->
                Refer to the evaluation activity for <no-link>FIA_X509_EXT.2</no-link> in the MD PP.
                <no-tests/>
              </aactivity>
            </f-element>
            <audit-event/>
          </f-component>
        </subsection>
        
        <subsection title="Trusted Path/Channels (FTP)" id="dm-m-ftp">

          <!-- 5.4.1.5 FPT_ITT.1(1) Basic Internal TSF Data Transfer Protection -->
         <f-component cc-id="ftp_itt.1" iteration="1" id="dm-ftp-itt-1-1" name="Basic Internal TSF Data Transfer Protection">
			When the MDM TOE claims this PP-Module, at least one of its interfaces will implement IPsec
			communications. However, this PP-Module does not specify that any one particular interface must be
			implemented using IPsec. If the TOE is distributed and uses IPsec to secure communications between its
			distributed components, FPT_ITT.1(1) is refined in the following manner:
            <consistency-rationale>This PP-Module adds IPsec as a new protocol that is used to
              implement trusted channels.</consistency-rationale>
            <f-element id="dm-ftp-itt-1e1i1">
				<title>The TSF shall [<h:i>implement functionality using [IPsec as defined in the PP-Module for
					VPN Client]</h:i>].
                </title>
				<note role="application">
					This SFR is selection-based in the Base-PP depending on the selections made in the
					Base-PP requirement FTP_ITC_EXT.1. This is not changed by the PP-Module.<h:p/>
					This SFR is modified from its definition in the Base-PP by mandating that the TSF
					implement IPsec communications and by prohibiting the TOE from relying on
					platform-provided functionality to implement this.
              </note>
              <aactivity>  <!-- QQQQ -->
                Refer to the evaluation activity for <no-link>FTP_ITC_EXT.1</no-link> in the MD PP.
                <no-tests/>
              </aactivity>
            </f-element>
            <audit-event/>
         </f-component>		  
		  
          <!-- 5.4.1.6 FTP_ITC.1(1) Inter-TSF Trusted Channel (Authorized IT Entities) -->
          <f-component cc-id="ftp_itc.1" iteration="1" id="dm-ftp-itc-1-1" name=" Inter-TSF Trusted Channel (Authorized IT Entities)">
			When the MDM TOE claims this PP-Module, at least one of its interfaces will implement IPsec
			communications. However, this PP-Module does not specify that any one particular interface must be
			implemented using IPsec. If the TOE uses IPsec to secure communications between itself and external
			trusted IT entities, FTP_ITC.1(1) is refined in the following manner:
            <consistency-rationale>This PP-Module adds IPsec as a new protocol that is used to
              implement trusted channels.</consistency-rationale>
            <f-element id="dm-ftp-itc-1e1i1">
              <title> The TSF shall <h:b>implement functionality using IPsec as defined in the PP-Module
			  for VPN Client, and </h:b><h:b>
                <selectables linebreak="yes">
                  <selectable>SSH as defined in the Extended Package for Secure Shell</selectable>
                  <selectable>mutually authenticated TLS as defined in the Package for Transport Layer Security</selectable>
                  <selectable>mutually authenticated DTLS as defined in the Package for Transport Layer Security</selectable>
                  <selectable>HTTPS in accordance with FCS_HTTPS_EXT.1</selectable>
                  <selectable><h:b>no other protocols</h:b></selectable>
                </selectables> and </h:b>
				<selectables linebreak="yes">
					<selectable>invoke platform-provided functionality to use
						<selectables linebreak="yes">
							<selectable>SSH</selectable>
							<selectable>mutually authenticated TLS</selectable>
							<selectable>mutually authenticated DTLS</selectable>
							<selectable>HTTPS</selectable>
						</selectables></selectable>
					<selectable><h:b>not invoke any platform-provided functionality</h:b></selectable>
				</selectables>
				to provide a trusted communication channel between itself and authorized IT
				entities supporting the following capabilities: audit server, 
				<selectables>
					<selectable>authentication server</selectable>
					<selectable><assignable>other capabilities</assignable></selectable>
				</selectables>
				that is logically distinct from other communication channels and provides assured identification
				of its end points and protection of channel data from modification and disclosure.
              </title>
            </f-element>
            <f-element id="dm-ftp-itc-1e2i1">
              <title>The TSF shall <h:b>implement functionality and</h:b> 
				<selectables>
					<selectable>invoke platform-provided functionality</selectable>
					<selectable><h:b>not invoke platform-provided functionality</h:b></selectable>
				</selectables>
				to permit the MDM Server or other authorized IT entities to initiate communication via the trusted
				channel.
              </title>
            </f-element>
            <f-element id="dm-ftp-itc-1e3i1">
              <title>The TSF shall <h:b>implement functionality and</h:b> 
				<selectables>
					<selectable>invoke platform-provided functionality</selectable>
					<selectable><h:b>not invoke platform-provided functionality</h:b></selectable>
				</selectables>
				to initiate communication via via the trusted channel for
				<assignable>list of services for which the TSF is able to initiate communications</assignable>.
              </title>
              <note role="application">
                This SFR is refined from its definition in the Base-PP by mandating that the
				“implement functionality” selection be chosen at minimum for IPsec and by
				prohibiting the TOE from relying on platform-provided IPsec functionality. Since the
				TOE may support multiple trusted channel interfaces, the ST author is given the
				option to select other protocols (SSH, TLS, DTLS, HTTPS) either as being implemented
				by the TSF or invoked from the platform.
              </note>
              <aactivity>  <!-- QQQQ -->
                Refer to the evaluation activity for <no-link>FTP_ITC_EXT.1</no-link> in the MD PP.
                <no-tests/>
              </aactivity>
            </f-element>
            <audit-event/>
          </f-component>
		  
          <!-- 5.4.1.7 FTP_TRP.1(1) Trusted Path (for Remote Administration) -->
          <f-component cc-id="ftp_trp.1" iteration="1" id="dm-ftp-trp-1-1" name="Trusted Path (for Remote Administration)">
			When the MDM TOE claims this PP-Module, at least one of its interfaces will implement IPsec
			communications. However, this PP-Module does not specify that any one particular interface must be
			implemented using IPsec. If the TOE uses IPsec to secure communications between itself and trusted
			remote administrators, FPT_TRP.1(1) is refined in the following manner:  
            <consistency-rationale>This PP-Module adds IPsec as a new protocol that is used to
              implement trusted channels.</consistency-rationale>
            <f-element id="dm-ftp-trp-1e1i1">
              <title> The TSF shall <h:b>implement functionality using IPsec as defined in the PP-Module
				for VPN Client, and </h:b><h:b>
                <selectables linebreak="yes">
                  <selectable>TLS as defined in the Package for Transport Layer Security</selectable>
                  <selectable>HTTPS in accordance with FCS_HTTPS_EXT.1</selectable>
                  <selectable>SSH as defined in the Extended Package for Secure Shell</selectable>
                  <selectable><h:b>no other protocols</h:b></selectable>
                </selectables> </h:b> and
				<selectables linebreak="yes">
					<selectable>invoke platform-provided functionality to use
						<selectables linebreak="yes">
							<selectable>TLS</selectable>
							<selectable>HTTPS</selectable>
							<selectable>SSH</selectable>
						</selectables></selectable>
					<selectable><h:b>not invoke any platform-provided functionality</h:b></selectable>
				</selectables>
				to provide a trusted communication channel between itself as a 
				<selectables>
					<selectable>server</selectable>
					<selectable>peer</selectable>
				</selectables> 
				and remote administrators that is logically distinct from other communication
				paths and provides assured identification of its endpoints and protection of the
				communicated data from [<h:i>modification, disclosure</h:i>].
              </title>
            </f-element>
            <f-element id="dm-ftp-trp-1e2i1">
              <title>The TSF shall <h:b>implement functionality and</h:b> 
				<selectables>
					<selectable>invoke platform-provided functionality</selectable>
					<selectable><h:b>not invoke platform-provided functionality</h:b></selectable>
				</selectables>
				to permit remote administrators to initiate communication via the trusted channel.
              </title>
            </f-element>
            <f-element id="dm-ftp-trp-1e3i1">
              <title>The TSF shall <h:b>implement functionality and</h:b> 
				<selectables>
					<selectable>invoke platform-provided functionality</selectable>
					<selectable><h:b>not invoke platform-provided functionality</h:b></selectable>
				</selectables>
				to require the use of the trusted path for [all remote administration actions].
              </title>
              <note role="application">
                This SFR is refined from its definition in the Base-PP by mandating that the
				“implement functionality” selection be chosen at minimum for IPsec and by
				prohibiting the TOE from relying on platform-provided IPsec functionality. Since the
				TOE may support multiple remote administrative interfaces, the ST author is given
				the option to select other protocols (SSH, TLS, HTTPS) either as being implemented
				by the TSF or invoked from the platform.
              </note>
              <aactivity>  <!-- QQQQ -->
                Refer to the evaluation activity for <no-link>FTP_ITC_EXT.1</no-link> in the MD PP.
                <no-tests/>
              </aactivity>
            </f-element>
            <audit-event/>
          </f-component>
        </subsection>
      </modified-sfrs>
      		 
      <!-- 5.4.2 Additional SFRs -->
      <additional-sfrs>
        There are no additional SFRs that must be claimed only in cases where the MDM PP is the claimed BasePP.
      </additional-sfrs>
	  
	  <!-- 6.4 MDM Base -->
	  <!-- 6.4.1 Consistency of TOE Type -->  
      <con-toe>If this PP-Module is used to extend the MDM PP, the TOE type for the overall TOE is still a mobile device
		management solution. The TOE boundary is simply extended to include VPN client functionality that is
		included with the MDM software so that additional security functionality is claimed within the scope of
		the TOE.</con-toe>
      <con-sec-prob>The threats and assumptions defined by this PP-Module (see sections 3.1 and 3.2) supplement those
		defined in the MDM PP as follows:</con-sec-prob>
      <con-obj>The security objectives defined by this PP-Module (see sections 4.1 and 4.2) supplement those defined
		in the MDM PP as follows:</con-obj>
      <con-op-en></con-op-en>
	  
	  <!-- 6.4.2 Consistency of Security Problem Definition -->
      <con-mod ref="T.UNAUTHORIZED_ACCESS">The threat of an attacker gaining access to a network interface or data
		that is transmitted over it is consistent with the T.NETWORK_ATTACK and
		T.NETWORK_EAVESDROP threats in the MDM PP.</con-mod>
      <con-mod ref="T.TSF_CONFIGURATION">The threat of a mis-configured VPN client is consistent with the
		T.NETWORK_ATTACK and T.NETWORK_EAVESDROP threats in the MDM
		PP because failure to mitigate against mis-configuration makes these
		threats more significant. </con-mod>
      <con-mod ref="T.USER_DATA_REUSE">Inadvertent disclosure of user data to an unauthorized recipient is
		consistent with the T.NETWORK_EAVESDROP threat in the MDM PP</con-mod>
      <con-mod ref="T.TSF_FAILURE">A failure of TSF functionality could compromise the implementation of the
		IPsec channel, which would lead to an exploitation of the T.NETWORK_ATTACK threat.</con-mod>
      <con-mod ref="OE.NO_TOE_BYPASS">The A.NO_TOE_BYPASS assumption assumes that the operational
		environment is configured in such a manner that the only network route
		to the protected network is through the TOE. This does not conflict with
		the MDM PP because the MDM PP makes no assumptions about the
		network architecture in which the TOE is deployed.</con-mod>
      <con-mod ref="A.PHYSICAL">The assumption that physical security is provided by the environment is
		not explicitly stated in the MDM PP but is consistent with the A.MDM_SERVER_PLATFORM assumption defined in the MDM PP, which
		expects the computing platform to be trusted.</con-mod>
      <con-mod ref="A.TRUSTED_CONFIG">The assumption that personnel responsible for the TOE’s configuration are
		trusted to follow the guidance is consistent with the A.PROPER_ADMIN
		defined in the MDM PP.</con-mod>
		
	  <!-- 6.4.3 Consistency of Objectives -->
      <con-mod ref="O.AUTHENTICATION">This objective is consistent with the O.DATA_PROTECTION_TRANSIT
		objective of the Base-PP, which also expects that trusted remote
		channels will enforce authentication of remote endpoints</con-mod>
      <con-mod ref="O.CRYPTOGRAPHIC_FUNCTIONS">This objective is consistent with the O.DATA_PROTECTION_TRANSIT
		objective of the Base-PP, which also expects that secure
		cryptographic functions are used to implement trusted communications.</con-mod>
      <con-mod ref="O.KNOWN_STATE">This objective is consistent with the O.INTEGRITY objective of the
		Base-PP, which expects a conformant TOE to implement measures
		to maintain its own integrity.</con-mod>
      <con-mod ref="O.NONDISCLOSURE">There are no objectives in the Base-PP that directly relate to this
		objective, but it could be considered to support both the
		O.ACCOUNTABILITY and O.MANAGEMENT objectives in the Base-PP
		by ensuring that stored data cannot be modified through
		unauthorized mechanisms that may allow for access control and
		logging functions to be bypassed. </con-mod>
      <con-mod ref="OE.NO_TOE_BYPASS">This objective addresses behavior that is out of scope of the Base-PP
		and does not define an environment that an MDM TOE is incapable
		of existing in.</con-mod>
      <con-mod ref="OE.PHYSICAL ">This is part of satisfying OE.IT_ENTERPRISE as defined in the MDM
		PP because provisioning of physical security is a reasonable
		expectation for an IT enterprise.</con-mod>
      <con-mod ref="OE.TRUSTED_CONFIG">The expectation of trusted configuration is consistent with
		OE.PROPER_USER and OE.PROPER_ADMIN in the MDM PP.</con-mod>
	  
	  <!-- 6.4.4 Consistency of Requirements -->
	  <!-- This PP-Module identifies several SFRs from the MDM PP that are needed to support VPN client
		functionality. This is considered to be consistent because the functionality provided by the MDM is
		being used for its intended purpose. The PP-Module also identifies a number of modified SFRs from the
		MDM PP as well as new SFRs that are used entirely to provide VPN client functionality. The rationale for
		why this does not conflict with SFRs defined by the MDM PP are as follows:  -->

      <con-mod ref="dm-fcs-ckm-1">The ST author is instructed to make specific selections at minimum to
		address VPN client requirements; the SFR behavior itself is unmodified</con-mod>
      <con-mod ref="dm-fcs-ckm-2">The ST author is instructed to make specific selections at minimum to
		address VPN client requirements; the SFR behavior itself is unmodified.</con-mod>
      <con-mod ref="dm-fcs-cop-1-1">The ST author is instructed to make specific selections at minimum to
		address VPN client requirements; the SFR behavior itself is unmodified</con-mod>
      <con-mod ref="dm-fia-x509-ext-2">The ST author is instructed to make specific selections at minimum to
		address VPN client requirements; the SFR behavior itself is unmodified.</con-mod>
      <con-mod ref="dm-fpt-itt-1-1">When this SFR relates to the PP-Module’s functionality, the ST author is
		instructed to make specific selections to implement this behavior using the
		VPN client. This is done by forcing the ST author to make specific selections
		that are already present in the Base-PP definition of the SFR; no new
		behavior is introduced by this.</con-mod>
      <con-mod ref="dm-ftp-itc-1-1">When this SFR relates to the PP-Module’s functionality, the ST author is
		instructed to make specific selections to implement this behavior using the
		VPN client at minimum. This is done by forcing the ST author to make a
		specific selection that is already present in the Base-PP definition of the SFR
		and by removing a selection option; no new behavior is introduced by this.</con-mod>
      <con-mod ref="dm-ftp-trp-1-1">When this SFR relates to the PP-Module’s functionality, the ST author is
		instructed to make specific selections to implement this behavior using the
		VPN client at minimum. This is done by forcing the ST author to make a
		specific selection that is already present in the Base-PP definition of the SFR
		and by removing a selection option; no new behavior is introduced by this.</con-mod>

      <con-mod ref="fcs-ckm-1-vpn">This SFR defines the method of key generation for IKE peer authentication,
		which is a function that does not interfere with the functionality defined in
		the MDM PP</con-mod>
      <con-mod ref="fcs-ipsec-ext-1">This SFR defines the VPN client’s IPsec implementation, which is added
		functionality that does not interfere with the MDM functions.</con-mod>
      <con-mod ref="fdp-rip-2">The requirement to protect against re-use of residual data is a property of
		the VPN client behavior and does not impact the MDM functionality. </con-mod>
      <con-mod ref="fmt-smf-1-vpn">The ability to configure the VPN client behavior does not affect whether the
		MDM as a whole can perform its security functions. </con-mod>
      <con-mod ref="fpt-tst-ext-1-vpn">Self-testing of the VPN client functionality does not impact the ability of the
		MDM to perform its security functions.</con-mod>
		
      <con-mod ref="fau-gen-1-vpn">Audit records generated by the VPN client do not interfere with MDM
		functionality. The possibility of the MDM as a whole generating audit
		records is consistent with the MDM PP, which already contains FAU_GEN.1</con-mod>
      <con-mod ref="fau-sel-1-vpn">The ability to suppress the generation of certain VPN client audit records
		does not interfere with MDM functionality. The MDM PP already contains FAU_SEL.1 as an optional SFR which
		means that this functionality does not conflict with the expected behavior of an MDM.</con-mod>
      <con-mod ref="fdp-ifc-ext-1">The ability of the VPN client to prevent split tunneling of IPsec traffic
		requires it to have hooks into lower-level OS behavior, but there are no
		requirements in the MDM PP that would prevent this functionality from
		being supported.</con-mod>

      <con-mod ref="fia-psk-ext-1">This SFR defines the use of pre-shared keys, which is behavior that only
		relates to the establishment of IPsec connections.</con-mod>

    </base-pp>


	<!-- 5.5 TOE Security Functional Requirements -->
    <man-sfrs>
		The following section describes the SFRs that must be satisfied by any TOE that claims conformance to
		this PP-Module. These SFRs must be claimed regardless of which PP-Configuration is used to define the TOE.

		<!-- I don't like that the mandatory, optional, selection-based, etc. are separated into different sections. -->

	  <!-- 5.5.1 Cryptographic Support --> 
      <subsection title="Cryptographic Support (FCS)" id="m-fcs">

        <!--
        <ext-comp-def title="Cryptographic Key Management" fam-id="FCS_CKM_EXT">
          <fam-behavior>Components in this family describe requirements for key management functionality such as key storage
            and destruction.</fam-behavior>
        </ext-comp-def>
        -->
        <ext-comp-def title="Cryptographic Key Management" fam-id="FCS_CKM_EXT">
            <fam-behavior>Components in this family describe requirements for key management functionality such as key storage
              and destruction.</fam-behavior>
        </ext-comp-def>
        <ext-comp-def title="IPsec" fam-id="FCS_IPSEC_EXT">
          <fam-behavior>Components in this family describe requirements for IPsec implementation.</fam-behavior>
        </ext-comp-def>

		<!-- 5.5.1.1. FCS_CKM.1/VPN Cryptographic Key Generation (IKE)  -->
        <f-component name="VPN Cryptographic Key Generation (IKE)" cc-id="fcs_ckm.1" id="fcs-ckm-1-vpn" iteration="1">
          <consistency-rationale></consistency-rationale>
          <comp-lev></comp-lev>
          <management></management>
          <audit></audit>
          <dependencies></dependencies>
		  <f-element id="fcs-ckm-1e1i1">
			<title>
				The TSF shall <h:b>
				<selectables>
					<selectable>invoke platform-provided functionality</selectable>
					<selectable>implement functionality</selectable>
				</selectables>
				to </h:b>generate <h:b>asymmetric</h:b> cryptographic keys <h:b>used for IKE peer authentication</h:b>
				in accordance with:
				<selectables linebreak="yes">
					<selectable>FIPS PUB 186-4, “Digital Signature Standard (DSS),” Appendix B.3 for RSA schemes</selectable>
					<selectable>FIPS PUB 186-4, “Digital Signature Standard (DSS),” Appendix B.4 for
						ECDSA schemes and implementing “NIST curves,” P-256, P-384 and
						<selectables>
							<selectable>P-521</selectable>
							<selectable>no other curves</selectable>
						</selectables>
					</selectable>
				</selectables>
				and specified cryptographic key sizes [<h:i>equivalent to, or greater than, a
				symmetric key strength of 112 bits</h:i>] that meet the following: 
				<assignable>list of standards</assignable>.
			</title>
			<note role="application">
				The keys that are required to be generated by the TOE through this requirement
				are intended to be used for the authentication of the VPN entities during the IKE
				(either v1 or v2) key exchange. While it is required that the public key be
				associated with an identity in an X509v3 certificate, this association is not
				required to be performed by the TOE, and instead is expected to be performed by
				a Certificate Authority in the Operational Environment.<h:p/>
				As indicated in FCS_IPSEC_EXT.1, the TOE is required to implement support for
				RSA or ECDSA (or both) for authentication.<h:p/>
				See NIST Special Publication 800-57, “Recommendation for Key Management”
				for information about equivalent key strengths.
			</note>
			<aactivity>
				<no-tests/>
			</aactivity>
		  </f-element>
		  <audit-events/>
		</f-component>
    

		<!-- 5.5.1.2 FCS_IPSEC_EXT.1 IPsec  -->		
        <f-component name="IPsec" cc-id="fcs_ipsec_ext.1" id="fcs-ipsec-ext-1">
			In the following elements of the FCS_IPSEC_EXT.1 component, it is allowable for some or all of the
			individual elements to be implemented by the platform on which the VPN client operates. However, this
			is only the case when the platform is within the TOE boundary, as is the case where this PP-Module is
			being claimed on top of a general-purpose operating system or a mobile device.<h:p/>
			When the TOE is a standalone software application, the IPsec functionality must be implemented by the
			TSF, though it is permissible for the TSF to invoke cryptographic algorithm services from the TOE
			platform to support the TOE’s implementation of IPsec. The TOE may also rely on the TOE platform for
			X.509 certificate validation services, though it is the responsibility of the TSF to take the proper action
			based on the validation response that is returned.<h:p/>
			It is also permissible for the TSF to rely on low-level capabilities of the platform to perform enforcement
			and routing functions as a result of the policies the TSF maintains. For example, while the TSF must
			provide the capability to implement the Security Policy Database abstraction, it is allowed for the TSF to
			depend on the platform-provided network stack/driver to perform the low-level packet filtering and
			routing actions once the TSF has set up those rules as defined by the SPD.<h:p/>
			While enforcement of the IPsec requirements must be implemented by the TSF, it is permissible for the
			TSF to receive configuration of the IPsec behavior from an environmental source, most notably a VPN
			gateway. 
          <consistency-rationale></consistency-rationale>
          <comp-lev>requires the TSF to securely implement the IPsec protocol.</comp-lev>
          <management>The following actions could be considered for the management functions in FMT: <h:ul>
            <h:li>Specify VPN gateways to use for connections</h:li>
            <h:li>Specify IPsec VPN Clients to use for connections</h:li>
            <h:li>Specify IPsec-capable network devices to use for connections</h:li>
            <h:li>Specify client credentials to be used for connections</h:li>
          </h:ul>
          </management>
          <audit>The following actions should be auditable if FAU_GEN Security Audit Data Generation is included in the
            PP/ST: <h:ul>
              <h:li>Decisions to DISCARD or BYPASS network packets processed by the TOE</h:li>
              <h:li>Failure to establish an IPsec SA</h:li>
              <h:li>Establishment/Termination of an IPsec SA</h:li>
            </h:ul>
          </audit>
          <dependencies><no-link>FCS_CKM.1</no-link> Cryptographic Key Generation<h:p/>
          <no-link>FCS_CKM.2</no-link> Cryptographic Key Distribution<h:p/>
          FCS_COP.1 Cryptographic Operation<h:p/></dependencies>
          <f-element id="fcs-ipsec-ext-1e1">
            <title>The TSF shall implement the IPsec architecture as specified in RFC 4301.
            </title>
            <note role="application">
				RFC 4301 calls for an IPsec implementation to protect IP traffic through the use
				of a Security Policy Database (SPD). The SPD is used to define how IP packets are
				to be handled: PROTECT the packet (e.g., encrypt the packet), BYPASS the IPsec
				services (e.g., no encryption), or DISCARD the packet (e.g., drop the packet). The
				SPD can be implemented in various ways, including router access control lists,
				firewall rulesets, a "traditional" SPD, etc. Regardless of the implementation
				details, there is a notion of a "rule" that a packet is "matched" against and a
				resulting action that takes place.<h:p/>
				While there must be a means to order the rules, a general approach to ordering
				is not mandated, as long as the TOE can distinguish the IP packets and apply the
				rules accordingly. There may be multiple SPDs (one for each network interface),
				but this is not required.<h:p/>
				A VPN gateway fully implements the IPsec capability and provides an
				administrative interface to establish and populate an SPD. A VPN client is not
				required to provide an administrative interface to create or maintain an SPD.<h:p/>
				As an alternative, a client may provide an interface that can be used by another
				application or network entity, such as a VPN gateway, as a means to establish
				and populate the SPD. In either of these cases (the client provides an
				administrative interface, or an API), while the client is expected to maintain the
				SPD abstraction, it is permitted for the low-level enforcement and routing
				activities to be implemented by platform capabilities (e.g., a network driver) as
				configured by the client.
            </note>
            <aactivity>   <!-- QQQQ -->
              <TSS>The evaluator shall examine the TSS and determine that it describes how the IPsec capabilities are
                implemented and how a packet is processed, e.g., what takes place at the platform and what takes
                place within the client. The TSS will detail the relationship between the client and the underlying
                platform, including which aspects are implemented by the client, and those that are provided by the
                underlying platform. The TSS describes how the client interacts with the platforms network stack
                (e.g., does the client insert itself within the stack via kernel mods, does the client simply invoke APIs
                to gain access to network services).<h:p/>

                If the SPD is implemented by the client, then the TSS describes how the SPD is implemented and the
                rules for processing both inbound and outbound packets in terms of the IPsec policy. The TSS
                describes the rules that are available and the resulting actions available after matching a rule. The
                TSS describes how the available rules and actions form the SPD using terms defined in RFC 4301 such
                as BYPASS (e.g., no encryption), DISCARD (e.g., drop the packet), and PROTECT (e.g., encrypt the
                packet) actions defined in RFC 4301.<h:p/>

                As noted in section 4.4.1 of RFC 4301, the processing of entries in the SPD is non-trivial and the
                evaluator shall determine that the description in the TSS is sufficient to determine which rules will
                be applied given the rule structure implemented by the TOE. For example, if the TOE allows
                specification of ranges, conditional rules, etc., the evaluator shall determine that the description of
                rule processing (for both inbound and outbound packets) is sufficient to determine the action that
                will be applied, especially in the case where two different rules may apply. This description shall
                cover both the initial packets (that is, no SA is established on the interface or for that particular
                packet) as well as packets that are part of an established SA. If the SPD is implemented by the
                underlying platform, then the TSS describes how the client interacts with the platform to establish
                and populate the SPD, including the identification of the platform's interfaces that are used by the
                client.<h:p/></TSS>
              <Guidance>
                The evaluator shall examine the operational guidance to verify it describes how the SPD is created
                and configured. If there is an administrative interface to the client, then the guidance describes how
                the administrator specifies rules for processing a packet. The description includes all three cases - a
                rule that ensures packets are encrypted/decrypted, dropped, and allowing a packet to flow in
                plaintext. The evaluator shall determine that the description in the operational guidance is
                consistent with the description in the TSS, and that the level of detail in the operational guidance is
                sufficient to allow the administrator to set up the SPD in an unambiguous fashion. This includes a
                discussion of how ordering of rules impacts the processing of an IP packet.<h:p/>

                If the client is configured by an external application, such as the VPN gateway, then the operational
                guidance should indicate this and provide a description of how the client is configured by the
                external application. The description should contain information as to how the SPD is established
                and set up in an unambiguous fashion. The description should also include what is configurable via
                the external application, how ordering of entries may be expressed, as well as the impacts that
                ordering of entries may have on the packet processing.<h:p/>

                In either case, the evaluator ensures the description provided In the TSS is consistent with the
                capabilities and description provided in the operational guidance.<h:p/>
              </Guidance>
              <Tests>
                Depending on the implementation, the evaluator may be required to use a VPN gateway or some
                form of application to configure the client and platform. For Test 2, the evaluator is required to
                choose an application that allows for the configuration of the full set of capabilities of the VPN client
                (in conjunction with the platform). For example, if the client provides a robust interface that allows
                for specification of wildcards, subnets, etc., it is unacceptable for the evaluator to choose a VPN
                Gateway that only allows for specifying a single fully qualified IP addresses in the rule.<h:p/>

                The evaluator shall perform the following tests:
                <testlist>
                  <test>The evaluator shall configure an SPD on the client that is capable of the following: dropping a
                    packet, encrypting a packet, and allowing a packet to flow in plaintext. The selectors used in the
                    construction of the rule shall be different such that the evaluator can generate a packet and send
                    packets to the client with the appropriate fields (fields that are used by the rule - e.g., the IP
                    addresses, TCP/UDP ports) in the packet header. The evaluator performs both positive and negative
                    test cases for each type of rule. The evaluator observes via the audit trail, and packet captures that
                    the TOE exhibited the expected behavior: appropriate packets were dropped, allowed through
                    without modification, was encrypted by the IPsec implementation.</test>
                  <test>The evaluator shall devise several tests that cover a variety of scenarios for packet
                    processing. These scenarios must exercise the range of possibilities for SPD entries and processing
                    modes as outlined in the TSS and operational guidance. Potential areas to cover include rules with
                    overlapping ranges and conflicting entries, inbound and outbound packets, and packets that
                    establish SAs as well as packets that belong to established SAs. The evaluator shall verify, via the
                    audit trail and packet captures, for each scenario that the expected behavior is exhibited, and is
                    consistent with both the TSS and the operational guidance.
                  </test>
                </testlist>
              </Tests>
            </aactivity>
          </f-element>
          <f-element id="fcs-ipsec-ext-1e2">
            <title>The TSF shall implement 
				<selectables>
					<selectable>tunnel mode</selectable>
					<selectable>transport mode</selectable>
				</selectables>.
            </title>
            <note role="application">
				If the TOE is used to connect to a VPN gateway for the purposes of establishing a
				secure connection to a private network, the ST author is expected to select
				tunnel mode. If the TOE uses IPsec to establish an end-to-end connection to
				another IPsec VPN Client, the ST author is expected to select transport mode. If
				the TOE uses IPsec to establish a connection to a specific endpoint device for the
				purpose of secure remote administration, the ST author is expected to select
				transport mode.
			</note>
            <aactivity>
              <TSS>The evaluator shall check the TSS to ensure it states that the VPN can be established to operate in
                tunnel mode and/or transport mode (as selected). The evaluator shall confirm that the operational
                guidance contains instructions on how to configure the connection in each mode selected.<h:p/></TSS>
              <Guidance>If both transport mode and tunnel mode are implemented, the evaluator shall review the
                operational guidance to determine how the use of a given mode is specified.<h:p/>
              </Guidance>
              <Tests>The evaluator shall perform the following test(s) based on the selections chosen:
              <testlist>
                <test>[conditional]: If tunnel mode is selected, the evaluator uses the operational guidance to
                  configure the TOE/platform to operate in tunnel mode and also configures a VPN gateway to
                  operate in tunnel mode. The evaluator configures the TOE/platform and the VPN gateway to use any
                  of the allowable cryptographic algorithms, authentication methods, etc. to ensure an allowable SA
                  can be negotiated. The evaluator shall then initiate a connection from the client to connect to the
                  VPN GW peer. The evaluator observes (for example, in the audit trail and the captured packets) that
                  a successful connection was established using the tunnel mode.</test>
                <test>[conditional]: If transport mode is selected, the evaluator uses the operational guidance to
                  configure the TOE/platform to operate in transport mode and also configures an IPsec peer to
                  accept IPsec connections using transport mode. The evaluator configures the TOE/platform and the
                  endpoint device to use any of the allowed cryptographic algorithms, authentication methods, etc. to
                  ensure an allowable SA can be negotiated. The evaluator then initiates a connection from the
                  TOE/platform to connect to the remote endpoint. The evaluator observes (for example, in the audit
                  trail and the captured packets) that a successful connection was established using the transport
                  mode.</test>
                <test>[conditional]: If both tunnel mode and transport mode are selected, the evaluator shall
                  perform both Test 1 and Test 2 above, demonstrating that the TOE can be configured to support
                  both modes.</test>
                <test>[conditional]: If both tunnel mode and transport mode are selected, the evaluator shall
                  modify the testing for FCS_IPSEC_EXT.1 to include the supported mode for SPD PROTECT entries to
                  show that they only apply to traffic that is transmitted or received using the indicated mode.
                </test>
              </testlist>
              </Tests>
            </aactivity>
          </f-element>
          <f-element id="fcs-ipsec-ext-1e3">
            <title>The TSF shall have a nominal, final entry in the SPD that matches anything that
				is otherwise unmatched, and discards it.
            </title>
            <aactivity>
              <TSS>The evaluator shall examine the TSS to verify that the TSS provides a description of how a packet is
                processed against the SPD and that if no “rules” are found to match, that a final rule exists, either
                implicitly or explicitly, that causes the network packet to be discarded.<h:p/>
              </TSS>
              <Guidance>The evaluator shall check that the operational guidance provides instructions on how to construct or
                acquire the SPD and uses the guidance to configure the TOE/platform for the following test.<h:p/></Guidance>
              <Tests>The evaluator shall configure the SPD such that it has entries that contain operations that
                DISCARD, PROTECT, and (if applicable) BYPASS network packets. The evaluator may use the SPD that
                was created for verification of FCS_IPSEC_EXT.1.1. The evaluator shall construct a network packet
                that matches a BYPASS entry and send that packet. The evaluator should observe that the network
                packet is passed to the proper destination interface with no modification. The evaluator shall then
                modify a field in the packet header; such that it no longer matches the evaluator-created entries
                (there may be a “TOE/platform created” final entry that discards packets that do not match any
                previous entries). The evaluator sends the packet, and observes that the packet was not permitted
                to flow to any of the TOE’s interfaces.</Tests>
            </aactivity>
          </f-element>
          <f-element id="fcs-ipsec-ext-1e4">
            <title>The TSF shall implement the IPsec protocol ESP as defined by RFC 4303 using the cryptographic algorithms
				[<h:i>AES-GCM-128, AES-GCM-256 as specified in RFC 4106,</h:i>
				<selectables>
					<selectable>AES-CBC-128</selectable>
					<selectable>AES-CBC-256 (both specified by RFC 3602)
						together with a Secure Hash Algorithm (SHA)-based HMAC</selectable>
                <selectable>no other algorithms</selectable>
              </selectables>].
            </title>
            <note role="application">
				If this functionality is configurable, the TSF may be configured by a VPN Gateway
				or by an Administrator of the TOE itself.
			</note>
            <aactivity>
              <TSS>The evaluator shall examine the TSS to verify that the algorithms AES-GCM-128 and AES-GCM-256
                are implemented. If the ST author has selected either AES-CBC-128 or AES-CBC-256 in the
                requirement, then the evaluator verifies the TSS describes these as well. In addition, the evaluator
                ensures that the SHA-based HMAC algorithm conforms to the algorithms specified in FCS_COP.1(4)
                Cryptographic Operations (for keyed-hash message authentication).<h:p/></TSS>
              <Guidance>The evaluator shall check the operational guidance to ensure it provides instructions on how the TOE is
                configured to use the algorithms selected in this component and whether this is performed through
                direct configuration, defined during initial installation, or defined by acquiring configuration settings
                from an environmental component.<h:p/>
              </Guidance>
              <Tests>The evaluator shall configure the TOE/platform as indicated in the operational guidance
                configuring the TOE/platform to using each of the AES-GCM-128 and AES-GCM-256 algorithms, and
                attempt to establish a connection using ESP. If the ST author has selected either AES-CBC-128 or
                AES-CBC-256, the TOE/platform is configured to use those algorithms and the evaluator attempts to
                establish a connection using ESP for those algorithms selected.
              </Tests>
            </aactivity>
          </f-element>
          <f-element id="fcs-ipsec-ext-1e5">
            <title>The The TSF shall implement the protocol:
              <selectables linebreak="yes">
                <selectable>IKEv1, using Main Mode for Phase I exchanges, as defined in RFCs 2407,
					2408, 2409, RFC 4109, 
					<selectables>
						<selectable>no other RFCs for extended sequence numbers</selectable>
						<selectable>RFC 4304 for extended sequence numbers</selectable>
					</selectables>, 
					<selectables>
						<selectable>no other RFCs for hash functions</selectable>
						<selectable>RFC 4868 for hash functions</selectable>
					</selectables>, and 
					<selectables>
						<selectable>support for XAUTH</selectable>
						<selectable>no support for XAUTH</selectable>
					</selectables></selectable>
                <selectable>IKEv2 as defined in RFC 7296 (with mandatory support for NAT traversal as
					specified in section 2.23), RFC 8784, RFC 8247, and 
					<selectables>
						<selectable>no other RFCs for hash functions</selectable>
						<selectable>RFC 4868 for hash functions</selectable>
					</selectables></selectable>
              </selectables>.
            </title>
            <aactivity>
              <TSS>The evaluator shall examine the TSS to verify that IKEv1 and/or IKEv2 are implemented. If IKEv1 is
                implemented, the evaluator shall verify that the TSS indicates whether or not XAUTH is supported,
                and that aggressive mode is not used for IKEv1 Phase 1 exchanges (i.e. only main mode is used). It
                may be that these are configurable options.<h:p/>
              </TSS>
              <Guidance>The evaluator shall check the operational guidance to ensure it instructs the administrator how to
                configure the TOE/platform to use IKEv1 and/or IKEv2 (as selected), and uses the guidance to
                configure the TOE/platform to perform NAT traversal for the test below. If XAUTH is implemented,
                the evaluator shall verify that the operational guidance provides instructions on how it is enabled or
                disabled.<h:p/>

                If the TOE supports IKEv1, the evaluator shall verify that the operational guidance either asserts that
                only main mode is used for Phase 1 exchanges, or provides instructions for disabling aggressive
                mode.<h:p/></Guidance>
              <Tests>
                The evaluator shall perform the following tests:
                <testlist>
                  <test>The evaluator shall configure the TOE/platform so that it will perform NAT traversal processing as described in the TSS and RFC 7296, section 2.23.
                    The evaluator shall initiate an IPsec connection and determine that the NAT is successfully traversed.
                    If the TOE/platform supports IKEv1 with or without XAUTH, the evaluator shall verify that this test can be successfully repeated with XAUTH enabled and disabled in the manner specified by the operational guidance.
                    If the TOE/platform only supports IKEv1 with XAUTH, the evaluator shall verify that connections not using XAUTH are unsuccessful.
                    If the TOE/platform only supports IKEv1 without XAUTH, the evaluator shall verify that connections using XAUTH are unsuccessful.</test>
                  <test>[conditional]: If the TOE supports IKEv1, the evaluator shall perform any applicable
                    operational guidance steps to disable the use of aggressive mode and then attempt to establish a
                    connection using an IKEv1 Phase 1 connection in aggressive mode. This attempt should fail. The
                    evaluator shall show that the TOE/platform will reject a VPN gateway from initiating an IKEv1 Phase
                    1 connection in aggressive mode. The evaluator should then show that main mode exchanges are
                    supported.</test>
                </testlist>
              </Tests>
            </aactivity>
          </f-element>
          <f-element id="fcs-ipsec-ext-1e6">
            <title>The TSF shall ensure the encrypted payload in the 
				<selectables>
					<selectable>IKEv1</selectable>
					<selectable>IKEv2</selectable>
				</selectables> 
				protocol uses the cryptographic algorithms [<h:i>AES-CBC-128, AES-CBC-256 as specified in RFC 6379 and </h:i>
				<selectables>
					<selectable>AES-GCM-128 as specified in RFC 5282</selectable>
					<selectable>AES-GCM-256 as specified in RFC 5282</selectable>
					<selectable>no other algorithm</selectable>
				</selectables>.
            </title>
            <note role="application">
				If this functionality is configurable, the TSF may be configured by a VPN Gateway
				or by an Administrator of the TOE itself.
			</note>
            <aactivity>
              <TSS>The evaluator shall ensure the TSS identifies the algorithms used for encrypting the IKEv1 and/or
                IKEv2 payload, and that the algorithms AES-CBC-128, AES-CBC-256 are specified, and if others are
                chosen in the selection of the requirement, those are included in the TSS discussion.<h:p/></TSS>
              <Guidance>The evaluator shall check the operational guidance to ensure it provides instructions on how the TOE is
                configured to use the algorithms selected in this component and whether this is performed through
                direct configuration, defined during initial installation, or defined by acquiring configuration settings
                from an environmental component. <h:p/>
              </Guidance>
              <Tests>The evaluator shall use the operational guidance to configure the TOE/platform (or to configure the
                Operational Environment to have the TOE receive configuration) to perform the following test for
                each ciphersuite selected:<h:p/>

                The evaluator shall configure the TOE/platform to use the ciphersuite under test to encrypt
                the IKEv1 and/or IKEv2 payload and establish a connection with a peer device, which is configured to
                only accept the payload encrypted using the indicated ciphersuite. The evaluator will confirm the
                algorithm was that used in the negotiation. The evaluator will confirm that the connection is
                successful by confirming that data can be passed through the connection once it is established. For
                example, the evaluator may connect to a webpage on the remote network and verify that it can be
                reached.
              </Tests>
            </aactivity>
          </f-element>
          <f-element id="fcs-ipsec-ext-1e7">
            <title>The TSF shall ensure that 
				<selectables>
					<selectable>IKEv2 SA lifetimes can be configured by 
						<selectables>
							<selectable>an Administrator</selectable>
							<selectable>a VPN Gateway</selectable>
						</selectables> 
						based on 
						<selectables>
							<selectable>number of packets/number of bytes</selectable>
							<selectable>length of time</selectable>
						</selectables>
					</selectable>
					<selectable>IKEv1 SA lifetimes can be configured by 
						<selectables>
							<selectable>an Administrator</selectable>
							<selectable>a VPN Gateway</selectable>
						</selectables> 
						based on 
						<selectables>
							<selectable>number of packets/number of bytes</selectable>
							<selectable>length of time</selectable>
						</selectables>
					</selectable>
					<selectable>IKEv1 SA lifetimes are fixed based on 
						<selectables>
							<selectable>number of packets/number of bytes</selectable>
							<selectable>length of time</selectable>
						</selectables>
					</selectable>
				</selectables>. 
				If length of time is used, it must include at least one option that
				is 24 hours or less for Phase 1 SAs and 8 hours or less for Phase 2 SAs.
            </title>
            <note role="application">
				The ST author is afforded a selection based on the version of IKE in their
				implementation. There is a further selection within this selection that allows the
				ST author to specify which entity is responsible for “configuring” the life of the
				SA. An implementation that allows an administrator to configure the client or a
				VPN gateway that pushes the SA lifetime down to the client are both acceptable.<h:p/>

				As far as SA lifetimes are concerned, the TOE can limit the lifetime based on the
				number of bytes transmitted, or the number of packets transmitted. Either
				packet-based or volume-based SA lifetimes are acceptable; the ST author makes
				the appropriate selection to indicate which type of lifetime limits are supported.<h:p/>

				The ST author chooses either the IKEv1 requirements or IKEv2 requirements (or
				both, depending on the selection in FCS_IPSEC_EXT.1.5. The IKEv1 requirement
				can be accomplished either by providing Authorized Administrator-configurable
				lifetimes (with appropriate instructions in documents mandated by AGD_OPE),
				or by “hard coding” the limits in the implementation. For IKEv2, there are no
				hardcoded limits, but in this case it is required that an administrator be able to
				configure the values. In general, instructions for setting the parameters of the
				implementation, including lifetime of the SAs, should be included in the 
				operational guidance generated for AGD_OPE. It is appropriate to refine the
				requirement in terms of number of MB/KB instead of number of packets, as long
				as the TOE is capable of setting a limit on the amount of traffic that is protected
				by the same key (the total volume of all IPsec traffic protected by that key).
			</note>
            <aactivity>
              <TSS>There are no TSS evaluation activities for this element.<h:p/></TSS>
              <Guidance>The evaluator shall check the operational guidance to ensure it provides instructions on how the TOE
                configures the values for SA lifetimes. In addition, the evaluator shall check that the guidance has
                the option for either the Administrator or VPN Gateway to configure Phase 1 SAs if time-based limits
                are supported. Currently there are no values mandated for the number of packets or number of
                bytes, the evaluator shall simply check the operational guidance to ensure that this can be
                configured if selected in the requirement.<h:p/></Guidance>
              <Tests>When testing this functionality, the evaluator needs to ensure that both sides are configured
                appropriately. From the RFC “A difference between IKEv1 and IKEv2 is that in IKEv1 SA lifetimes were
                negotiated. In IKEv2, each end of the SA is responsible for enforcing its own lifetime policy on the SA
                and rekeying the SA when necessary. If the two ends have different lifetime policies, the end with
                the shorter lifetime will end up always being the one to request the rekeying. If the two ends have
                the same lifetime policies, it is possible that both will initiate a rekeying at the same time (which will
                result in redundant SAs). To reduce the probability of this happening, the timing of rekeying requests
                SHOULD be jittered.”<h:p/>
                Each of the following tests shall be performed for each version of IKE selected in the
                FCS_IPSEC_EXT.1.5 protocol selection:
              <testlist>
                <test>[conditional]: The evaluator shall configure a maximum lifetime in terms of the # of packets
                  (or bytes) allowed following the operational guidance. The evaluator shall establish an SA and
                  determine that once the allowed # of packets (or bytes) through this SA is exceeded, the connection
                  is closed.</test>
                <test>[conditional]: The evaluator shall construct a test where a Phase 1 SA is established and
                  attempted to be maintained for more than 24 hours before it is renegotiated. The evaluator shall
                  observe that this SA is closed or renegotiated in 24 hours or less. If such an action requires that the
                  TOE be configured in a specific way, the evaluator shall implement tests demonstrating that the
                  configuration capability of the TOE works as documented in the operational guidance.</test>
                <test>[conditional]: The evaluator shall perform a test similar to Test 2 for Phase 2 SAs, except that
                  the lifetime will be 8 hours or less instead of 24 hours or less.</test>
                <test>[conditional]: If a fixed limit for IKEv1 SAs is supported, the evaluator shall establish an SA and
                  observe that the connection is closed after the fixed traffic and/or time value is reached.</test>
              </testlist>
              </Tests>
            </aactivity>
          </f-element>
          <f-element id="fcs-ipsec-ext-1e8">
            <title>The TSF shall ensure that all IKE protocols implement DH Groups [
				<h:i>19 (256-bit Random ECP), 20 (384-bit Random ECP), and </h:i>
				<selectables>
					<selectable>24 (2048-bit MODP with 256-bit POS)</selectable>
					<selectable>15 (3072-bit MODP)</selectable>
					<selectable>14 (2048-bit MODP)</selectable>
					<selectable>no other DH groups</selectable>
				</selectables>].
            </title>
            <note role="application">
				The selection is used to specify additional DH groups supported. This applies to
				IKEv1 and IKEv2 exchanges. It should be noted that if any additional DH groups
				are specified, they must comply with the requirements (in terms of the
				ephemeral keys that are established) listed in <no-link>FCS_CKM.1</no-link>.<h:p/>

				Since the implementation may allow different Diffie-Hellman groups to be
				negotiated for use in forming the SAs, the assignments in FCS_IPSEC_EXT.1.9
				and FCS_IPSEC_EXT.1.10 may contain multiple values. For each DH group
				supported, the ST author consults Table 2 in 800-57 to determine the “bits of
				security” associated with the DH group. Each unique value is then used to fill in
				the assignment (for 1.9 they are doubled; for 1.10 they are inserted directly into
				the assignment). For example, suppose the implementation supports DH group
				14 (2048-bit MODP) and group 20 (ECDH using NIST curve P-384). From Table 2,
				the bits of security value for group 14 is 112, and for group 20 it is 192. For
				FCS_IPSEC_EXT.1.9, then, the assignment would read “[224, 384]” and for
				FCS_IPSEC_EXT.1.10 it would read “[112, 192]” (although in this case the
				requirement should probably be refined so that it makes sense mathematically).
			</note>
            <aactivity>
              <TSS>The evaluator shall check to ensure that the DH groups specified in the requirement are listed as
                being supported in the TSS. If there is more than one DH group supported, the evaluator checks to
                ensure the TSS describes how a particular DH group is specified/negotiated with a peer.<h:p/></TSS>
              <Guidance>There are no guidance evaluation activities for this element.<h:p/></Guidance>
              <Tests>For each supported DH group, the evaluator shall test to ensure that all supported IKE
                protocols can be successfully completed using that particular DH group.</Tests>
            </aactivity>
          </f-element>
          <f-element id="fcs-ipsec-ext-1e9">
            <title>The TSF shall generate the secret value x used in the
              IKE Diffie-Hellman key exchange (“x” in g^x mod p) using the random bit
              generator specified in FCS_RBG_EXT.1, and having a length of at least
              <assignable>(one or more) number(s) of bits that is at least twice the “bits of
              security” value associated with the negotiated Diffie-Hellman group as listed in
              Table 2 of NIST SP 800-57, Recommendation for Key Management – Part 1:
              General</assignable> bits.
            </title>
            <aactivity>
              <TSS>The evaluator shall check to ensure that, for each DH group supported, the TSS describes the process
                for generating "x" (as defined in FCS_IPSEC_EXT.1.9) and each nonce. The evaluator shall verify that
                the TSS indicates that the random number generated that meets the requirements in this PP-Module is used,
                and that the length of "x" and the nonces meet the stipulations in the requirement.<h:p/></TSS>
              <Guidance>There are no guidance evaluation activities for this element.<h:p/></Guidance>
              <Tests>There are no test evaluation activities for this element.</Tests>
            </aactivity>
          </f-element>
          <f-element id="fcs-ipsec-ext-1e10">
            <title>The TSF shall generate nonces used in IKE exchanges in a manner such that the
				probability that a specific nonce value will be repeated during the life a specific
				IPsec SA is less than 1 in 2^<assignable>(one or more) “bits of security” value(s)
				associated with the negotiated Diffie-Hellman group as listed in Table 2 of NIST
				SP 800-57, Recommendation for Key Management – Part 1: General</assignable>.
            </title>
            <aactivity>
              This element is tested through the evaluation activities for FCS_IPSEC_EXT.1.9.
              <no-tests/>
            </aactivity>
          </f-element>
          <f-element id="fcs-ipsec-ext-1e11">
            <title>The TSF shall ensure that all IKE protocols perform peer authentication using a 
				<selectables>
					<selectable>RSA</selectable>
					<selectable>ECDSA</selectable>
				</selectables> 
				that use X.509v3 certificates that conform to RFC 4945 and 
				<selectables>
					<selectable id="sel-ipsec-e11-psk">Pre-shared keys</selectable>
					<selectable>no other method</selectable>
				</selectables>.
            </title>
            <note role="application">
				At least one public-key-based Peer Authentication method is required in order to
				conform to this PP-Module; one or more of the public key schemes is chosen by
				the ST author to reflect what is implemented. The ST author also ensures that
				appropriate FCS requirements reflecting the algorithms used (and key
				generation capabilities, if provided) are listed to support those methods. Note
				that the TSS will elaborate on the way in which these algorithms are to be used 
				(for example, 2409 specifies three authentication methods using public keys;
				each one supported will be described in the TSS).<h:p/>
				If “pre-shared keys” is selected, the selection-based requirement FIA_PSK_EXT.1
				must be claimed.<h:p/>
            </note>
            <aactivity>
              <TSS>The evaluator shall ensure that the TSS identifies RSA and/or ECDSA as being used to perform peer
                authentication.<h:p/>
                If pre-shared keys are chosen in the selection, the evaluator shall check to ensure that the TSS
                describes how pre-shared keys are established and used in authentication of IPsec connections. The
                description in the TSS shall also indicate how pre-shared key establishment is accomplished for
                TOEs/platforms that can generate a pre-shared key as well as TOEs/platforms that simply use a pre-shared key.<h:p/>
                The evaluator shall ensure that the TSS describes how the TOE compares the peer’s presented
                identifier to the reference identifier. This description shall include whether the certificate presented
                identifier is compared to the ID payload presented identifier, which field(s) of the certificate are
                used as the presented identifier (DN, Common Name, or SAN), and, if multiple fields are supported,
                the logical order comparison. If the ST author assigned an additional identifier type, the TSS
                description shall also include a description of that type and the method by which that type is
                compared to the peer’s presented certificate.<h:p/></TSS>
              <Guidance>The evaluator shall check that the operational guidance describes how pre-shared keys are to be
                generated and established.<h:p/>
                The evaluator ensures the operational guidance describes how to set up the TOE/platform to use the
                cryptographic algorithms RSA and/or ECDSA.<h:p/>

                In order to construct the environment and configure the TOE/platform for the following tests, the
                evaluator will ensure that the operational guidance also describes how to configure the
                TOE/platform to connect to a trusted CA, and ensure a valid certificate for that CA is loaded into the
                TOE/platform as a trusted CA.<h:p/>

                The evaluator shall also ensure that the operational guidance includes the configuration of the
                reference identifier(s) for the peer.<h:p/></Guidance>
              <Tests>For efficiency’s sake, the testing that is performed here has been combined with the testing for
                <no-link>FIA_X509_EXT.2</no-link> (for IPsec connections), FCS_IPSEC_EXT.1.12, and FCS_IPSEC_EXT.1.13.
                The following tests shall be repeated for each peer authentication protocol
                selected in the FCS_IPSEC_EXT.1.11 selection above:
              <testlist>
                <test>The evaluator shall have the TOE/platform generate a public-private key pair, and submit a
                  CSR (Certificate Signing Request) to a CA (trusted by both the TOE/platform and the peer VPN used
                  to establish a connection) for its signature. The values for the DN (Common Name, Organization,
                  Organizational Unit, and Country) will also be passed in the request. Alternatively, the evaluator may
                  import to the TOE/platform a previously generated private key and corresponding certificate.
                </test>
                <test>The evaluator shall configure the TOE to use a private key and associated certificate signed by a trusted CA and shall establish an IPsec connection with the peer.
                </test>
                <test>The evaluator shall test that the TOE/platform can properly handle revoked certificates –
                  conditional on whether CRL or OCSP is selected; if both are selected, and then a test is performed for
                  each method. For this draft of the PP-Module, the evaluator has to only test one up in the trust
                  chain (future drafts may require to ensure the validation is done up the entire chain). The evaluator
                  shall ensure that a valid certificate is used, and that the SA is established. The evaluator then
                  attempts the test with a certificate that will be revoked (for each method chosen in the selection) to
                  ensure when the certificate is no longer valid that the TOE/platform will not establish an SA.
                </test>
                <test>[conditional]: The evaluator shall generate a pre-shared key and use it, as indicated in the
                  operational guidance, to establish an IPsec connection with the VPN GW peer. If the generation of
                  the pre-shared key is supported, the evaluator shall ensure that establishment of the key is carried
                  out for an instance of the TOE/platform generating the key as well as an instance of the
                  TOE/platform merely taking in and using the key.</test>
                For each supported identifier type (excluding DNs), the evaluator shall repeat the following tests:
                <test>For each field of the certificate supported for comparison, the evaluator shall configure the
                  peer’s reference identifier on the TOE (per the administrative guidance) to match the field in the
                  peer’s presented certificate and shall verify that the IKE authentication succeeds.</test>
                <test>For each field of the certificate support for comparison, the evaluator shall configure the
                  peer’s reference identifier on the TOE (per the administrative guidance) to not match the field in the
                  peer’s presented certificate and shall verify that the IKE authentication fails.</test>
                The following tests are conditional:
                <test>[conditional]: If, according to the TSS, the TOE supports both Common Name and SAN
                  certificate fields and uses the preferred logic outlined in the Application Note, the tests above with
                  the Common Name field shall be performed using peer certificates with no SAN extension.
                  Additionally, the evaluator shall configure the peer’s reference identifier on the TOE to not match
                  the SAN in the peer’s presented certificate but to match the Common Name in the peer’s presented
                  certificate, and verify that the IKE authentication fails.</test>
                <test>[conditional]: If the TOE supports DN identifier types, the evaluator shall configure the peer’s
                  reference identifier on the TOE (per the administrative guidance) to match the subject DN in the
                  peer’s presented certificate and shall verify that the IKE authentication succeeds. To demonstrate a
                  bit-wise comparison of the DN, the evaluator shall change a single bit in the DN (preferably, in an
                  Object Identifier (OID) in the DN) and verify that the IKE authentication fails. To demonstrate a comparison of DN values,
                  the evaluator shall change any one of the four DN values and verify that the IKE authentication fails.
                </test>
                <test>[conditional]: If the TOE supports both IPv4 and IPv6 and supports IP address identifier types,
                  the evaluator must repeat test 1 and 2 with both IPv4 address identifiers and IPv6 identifiers.
                  Additionally, the evaluator shall verify that the TOE verifies that the IP header matches the
                  identifiers by setting the presented identifiers and the reference identifier with the same IP address
                  that differs from the actual IP address of the peer in the IP headers and verifying that the IKE
                  authentication fails.</test>
                <test>[conditional]: If, according to the TSS, the TOE performs comparisons between the peer’s ID
                  payload and the peer’s certificate, the evaluator shall repeat the following test for each combination
                  of supported identifier types and supported certificate fields (as above). The evaluator shall
                  configure the peer to present a different ID payload than the field in the peer’s presented certificate
                  and verify that the TOE fails to authenticate the IKE peer.</test>
              </testlist></Tests>
            </aactivity>
          </f-element>
          <f-element id="fcs-ipsec-ext-1e12">
            <title>The TSF shall not establish an SA if the [
				<selectables>
					<selectable>IP address</selectable>
					<selectable>Fully Qualified Domain Name (FQDN)</selectable>
					<selectable>user FQDN</selectable>
					<selectable>Distinguished Name (DN)</selectable>
				</selectables> 
				and 
				<selectables>
					<selectable>no other reference identifier type</selectable>
					<selectable><assignable>other supported reference identifier types</assignable></selectable>
				</selectables>] contained in a certificate does not match the expected value(s) for the
				entity attempting to establish a connection.
            </title>
			<note role="application">
				The TOE must support at least one of the following identifier types: IP address,
				Fully Qualified Domain Name (FQDN), user FQDN, or Distinguished Name (DN).
				In the future, the TOE will be required to support all of these identifier types. The
				TOE is expected to support as many IP address formats (IPv4 and IPv6) as IP
				versions supported by the TOE in general. The ST author may assign additional
				supported identifier types in the second selection.
			</note>
            <aactivity>
              Evaluation activities for this component are tested through the evaluation activities for FCS_IPSEC_EXT.1.11.
              <no-tests/>
            </aactivity>
          </f-element>
          <f-element id="fcs-ipsec-ext-1e13">
            <title>The TSF shall not establish an SA if the presented identifier does not match the
				configured reference identifier of the peer.
            </title>
            <note role="application">
				At this time, only the comparison between the presented identifier in the peer’s
				certificate and the peer’s reference identifier is mandated by the testing below.
				However, in the future, this requirement will address two aspects of the peer
				certificate validation: 1) comparison of the peer’s ID payload to the peer’s
				certificate which are both presented identifiers, as required by RFC 4945 and 2)
				verification that the peer identified by the ID payload and the certificate is the
				peer expected by the TOE (per the reference identifier). At that time, the TOE will
				be required to demonstrate both aspects (i.e. that the TOE enforces that the
				peer’s ID payload matches the peer’s certificate which both match configured
				peer reference identifiers).<h:p/>
				Excluding the DN identifier type (which is necessarily the Subject DN in the peer
				certificate), the TOE may support the identifier in either the Common Name or
				Subject Alternative Name (SAN) or both. If both are supported, the preferred
				logic is to compare the reference identifier to a presented SAN, and only if the
				peer’s certificate does not contain a SAN, to fall back to a comparison against
				the Common Name. In the future, the TOE will be required to compare the
				reference identifier to the presented identifier in the SAN only, ignoring the
				Common Name.<h:p/>
				The configuration of the peer reference identifier is addressed by
				FMT_SMF.1.1/VPN.
			</note>
            <aactivity>
              Evaluation activities for this component are tested through the evaluation activities for FCS_IPSEC_EXT.1.11.
              <no-tests/>
            </aactivity>
          </f-element>
          <f-element id="fcs-ipsec-ext-1e14">
            <title>The 
				<selectables>
					<selectable>TSF</selectable>
					<selectable>VPN Gateway</selectable>
				</selectables> shall be able to ensure by default that the strength of the symmetric algorithm (in terms 
				of the number of bits in the key) negotiated to protect the 
				<selectables>
					<selectable>IKEv1 Phase 1</selectable>
					<selectable>IKEv2 IKE_SA</selectable>
				</selectables> 
				connection is greater than or equal to the strength of the symmetric algorithm
				(in terms of the number of bits in the key) negotiated to protect the 
				<selectables>
					<selectable>IKEv1 Phase 2</selectable>
					<selectable>IKEv2 CHILD_SA</selectable>
				</selectables> connection.
            </title>
            <note role="application">
				If this functionality is configurable, the TSF may be configured by a VPN Gateway
				or by an Administrator of the TOE itself<h:p/>
				The ST author chooses either or both of the IKE selections based on what is
				implemented by the TOE. Obviously, the IKE version(s) chosen should be
				consistent not only in this element, but with other choices for other elements in
				this component. While it is acceptable for this capability to be configurable, the
				default configuration in the evaluated configuration (either "out of the box" or
				by configuration guidance in the AGD documentation) must enable this
				functionality.<h:p/>
			</note>
            <aactivity>
              <TSS>The evaluator shall check that the TSS describes the potential strengths (in terms of the number of
                bits in the symmetric key) of the algorithms that are allowed for the IKE and ESP exchanges. The TSS
                shall also describe the checks that are done when negotiating IKEv1 Phase 2 and/or IKEv2 CHILD_SA
                suites to ensure that the strength (in terms of the number of bits of key in the symmetric algorithm)
                of the negotiated algorithm is less than or equal to that of the IKE SA this is protecting the
                negotiation.<h:p/></TSS>
              <Guidance>There are no guidance evaluation activities for this element.<h:p/></Guidance>
              <Tests>The evaluator shall follow the guidance to configure the TOE/platform to perform the following tests:
              <testlist>
                <test>This test shall be performed for each version of IKE supported. The evaluator shall
                  successfully negotiate an IPsec connection using each of the supported algorithms and hash
                  functions identified in the requirements.</test>
                <test>[conditional]: This test shall be performed for each version of IKE supported. The evaluator
                  shall attempt to establish an SA for ESP that selects an encryption algorithm with more strength than
                  that being used for the IKE SA (i.e., symmetric algorithm with a key size larger than that being used for the IKE SA). Such attempts should fail.</test>
                <test>This test shall be performed for each version of IKE supported. The evaluator shall attempt to
                  establish an IKE SA using an algorithm that is not one of the supported algorithms and hash functions
                  identified in the requirements. Such an attempt should fail.
                </test>
                <test>This test shall be performed for each version of IKE supported. The evaluator shall attempt to
                  establish an SA for ESP (assumes the proper parameters where used to establish the IKE SA) that
                  selects an encryption algorithm that is not identified in FCS_IPSEC_EXT.1.4. Such an attempt should
                  fail.
                </test>
              </testlist></Tests>
            </aactivity>
          </f-element>
	  <audit-event>
		  <audit-event-descr>Decisions to DISCARD or BYPASS network packets processed by the TOE.</audit-event-descr>
		  <audit-event-info>Presumed identity of source subject.</audit-event-info>
		  <audit-event-info>The entry in the SPD that applied to the decision.</audit-event-info>
	  </audit-event>
	  <audit-event>
		  <audit-event-descr>Failure to establish an IPsec SA.</audit-event-descr>
		  <audit-event-info>Identity of destination subject.</audit-event-info>
		  <audit-event-info>Reason for failure.</audit-event-info>
	  </audit-event>
	  <audit-event>
		  <audit-event-descr>Establishment/Termination of an IPsec SA.</audit-event-descr>
		  <audit-event-info>Identity of destination subject.</audit-event-info>
		  <audit-event-info>Transport layer protocol, if applicable.</audit-event-info>
		  <audit-event-info>Source subject service identifier, if applicable.</audit-event-info>
		  <audit-event-info>Non-TOE endpoint of connection (IP address) for both successes and failures.</audit-event-info>
	  </audit-event>
        </f-component>
      </subsection>

	  <!-- 5.5.2.1 User Data Protection -->
      <subsection title="User Data Protection (FDP)" id="m-fdp">

        <!-- TODO: stuck here as placeholder but this is not where it's supposed to live (schema issue) -->
        <!-- <ext-comp-def title="Cryptographic Key Management" fam-id="FCS_CKM_EXT">
          <fam-behavior>Components in this family describe requirements for key management functionality such as key storage
            and destruction.</fam-behavior>
        </ext-comp-def> -->

        <f-component cc-id="fdp_rip.2" id="fdp-rip-2" name="Full Residual Information Protection">
          <consistency-rationale/>
          <f-element id="fdp-rip-2e1">
            <title> The 
				<selectables><h:b>
					<selectable>TOE</selectable>
					<selectable>TOE platform</selectable></h:b>
				</selectables>  
				shall enforce that any previous information content of a resource is made unavailable upon the 
				<selectables>
					<selectable>allocation of the resource to</selectable>
					<selectable>deallocation of the resource from</selectable>
				</selectables> all objects.
            </title>
            <note role="application">
				This requirement ensures, for example, that protocol data units (PDUs) are not
				padded with residual information such as cryptographic key material. The ST
				author uses the selection to specify when previous information is made
				unavailable.
			</note>
            <aactivity>
              <TSS><h:b>Requirement met by the platform</h:b><h:p/>
                The evaluator shall examine the TSS to verify that it describes (for each supported platform) the
                extent to which the client processes network packets and addresses the FDP_RIP.2 requirement.<h:p/>
                <h:b>Requirement met by the TOE</h:b><h:p/>
                “Resources” in the context of this requirement are network packets being sent through (as opposed
                to “to,” as is the case when a security administrator connects to the TOE) the TOE. The concern is
                that once a network packet is sent, the buffer or memory area used by the packet still contains data
                from that packet, and that if that buffer is re-used, those data might remain and make their way into
                a new packet. The evaluator shall check to ensure that the TSS describes packet processing to the
                extent that they can determine that no data will be reused when processing network packets. The
                evaluator shall ensure that this description at a minimum describes how the previous data are
                zeroized/overwritten, and at what point in the buffer processing this occurs.
              </TSS>
              <Guidance>There are no guidance evaluation activities for this component.<h:p/></Guidance>
              <Tests>There are no test evaluation activities for this component.<h:p/></Tests>
            </aactivity>
          </f-element>
		  <audit-event/>
        </f-component>
      </subsection>

	<!-- 5.5.3 Security Management (FMT)  -->
    <subsection title="Security Management (FMT)" id="m-fmt">
        <description>
			The TOE is not required to maintain a separate management role. It is, however, required to provide
			functionality to configure certain aspects of TOE operation that should not be available to the general
			user population. It is possible for the TOE, TOE Platform, or VPN Gateway to provide this functionality.
			The client itself has to be configurable - whether it is from the EUD or from a VPN gateway.
		</description>

		<!-- 5.5.3.1 FMT_SMF.1/VPN Specification of Management Functions (VPN) -->
        <f-component cc-id="fmt_smf.1" id="fmt-smf-1-vpn" name="Specification of Management Functions (VPN)" iteration="VPN">
          <consistency-rationale/>
          <f-element id="fmt-smf-1e1-vpn">
            <title> The TSF shall be capable of performing the following management functions: 
				<selectables linebreak="yes">
					<selectable>Specify VPN gateways to use for connections</selectable>
					<selectable>Specify IPsec VPN Clients to use for connections</selectable>
					<selectable>Specify IPsec-capable network devices to use for connections</selectable>
					<selectable>Specify client credentials to be used for connections</selectable>
					<selectable>Configure the reference identifier of the peer</selectable>
					<selectable><assignable>any additional management functions</assignable></selectable>
				</selectables>
            </title>
            <note role="application">Several of the management functions defined above correspond to the use cases
              of the TOE as follows: 
			  <h:ul>
                <h:li>“Specify VPN gateways to use for connections” – Use Case 1</h:li>
                <h:li>“Specify IPsec VPN Clients to use for connections” – Use Case 2 (specifically
                  refers to different end points to use for client-to-client connections)</h:li>
                <h:li>“Specify IPsec-capable network devices to use for connections” – Use Case 3</h:li>
              </h:ul>
              Selections appropriate for the use case(s) supported by the TOE should be
              claimed. "Client credentials" will include the client certificate used for IPsec
              authentication, and may also include a username/password.<h:p/>
              For TOEs that support only IP address and FQDN identifier types, configuration
              of the reference identifier may be the same as configuration of the peer’s name
              for the purposes of connection.<h:p/>
              If there are additional management functions performed by the TOE (including
              those specified in FCS_IPSEC_EXT.1), they should be added in the assignment.
            </note>
            <aactivity>
              <TSS>The evaluator shall check to ensure the TSS describes the client credentials and how they are used
                by the TOE.<h:p/>
              </TSS>
              <Guidance>The evaluator shall check to make sure that every management function mandated in the ST for this
                requirement are described in the operational guidance and that the description contains the
                information required to perform the management duties associated with each management
                function.<h:p/>
              </Guidance>
              <Tests>
                The evaluator shall test the TOE’s ability to provide the management functions by configuring the
                TOE according to the operational guidance and testing each management activity listed in the ST.<h:p/>
                The evaluator shall ensure that all management functions claimed in the ST can be performed by
                completing activities described in the AGD. Note that this may be performed in the course of
                completing other testing.
              </Tests>
            </aactivity>
          </f-element>
	  <audit-event>
		  <audit-event-descr>Success or failure of management function.</audit-event-descr>
 	  </audit-event>
        </f-component>
      </subsection>

	  <!-- 5.5.4 Protection of the TSF (FPT) -->
      <subsection title="Protection of the TSF (FPT)" id="m-fpt">
        <ext-comp-def title="TSF Self-Test" fam-id="FPT_TST_EXT">
          <fam-behavior>Components in this family describe requirements for self-test to verify functionality and integrity of the
            TOE.</fam-behavior>
        </ext-comp-def>

		<!-- 5.5.4.1 FPT_TST_EXT.1/VPN TSF Self-Test (VPN Client)  -->
        <f-component cc-id="fpt_tst_ext.1" id="fpt-tst-ext-1-vpn" name="TSF Self-Test" iteration="VPN">
          <consistency-rationale/>
          <comp-lev>requires the TOE to perform power on self-tests to verify its functionality and
            the integrity of its stored executable code.</comp-lev>
          <management>No specific management functions are identified.
          </management>
          <audit>There are no auditable events foreseen.
          </audit>
          <dependencies>FCS_COP.1 Cryptographic Operation</dependencies>
          <f-element id="fpt-tst-ext-1e1-vpn">
            <title>
				The 
				<selectables>
					<selectable>TOE</selectable>
					<selectable>TOE platform</selectable>
				</selectables> 
				shall run a suite of self tests during initial start-up (on power on) to demonstrate the correct 
				operation of the TSF.
            </title>
          </f-element>
          <f-element id="fpt-tst-ext-1e2-vpn">
            <title>
				The 
				<selectables>
					<selectable>TOE</selectable>
					<selectable>TOE platform</selectable>
				</selectables> 
				shall provide the capability to verify the integrity of stored TSF executable code when it is loaded 
				for execution through the use of the 
				<assignable>cryptographic services provided either by the portion
                of the TOE described by the Base-PP or by the operational environment</assignable>.
            </title>
            <note role="application">
				While the TOE is typically a software package running in the IT Environment, it is
				still capable of performing the self-test activities required above. It should be
				understood, however, that there is a significant dependency on the host
				environment in assessing the assurance provided by the tests mentioned above
				(meaning that if the host environment is compromised, the self-tests will not be
				meaningful).<h:p/>
				Cryptographic verification of the integrity is required, but the method by which
				this can be accomplished is specified in the ST in the assignment. The ST author
				will fill in the assignment with references to the cryptographic functions used to
				perform the integrity checks; this will include hashing and may potentially
				include digital signatures signed using X.509 certificates. If the TSF provides the
				cryptographic services used to verify updates, all relevant FCS_COP requirements
				will be identified in the assignment by the ST author.
            </note>
            <aactivity>
              Except for where it is explicitly noted, the evaluator is expected to check the following information
              regardless of whether the functionality is implemented by the TOE or by the TOE platform.<h:p/>
              <TSS>The evaluator shall examine the TSS to ensure that it details the self-tests that are run by the TSF on
                start-up; this description should include an outline of what the tests are actually doing (e.g., rather
                than saying "memory is tested," a description similar to "memory is tested by writing a value to each
                memory location and reading it back to ensure it is identical to what was written" shall be used). The
                evaluator shall ensure that the TSS makes an argument that the tests are sufficient to demonstrate
                that the TSF is operating correctly. If some of the tests are performed by the TOE platform, the
                evaluator shall check the TSS to ensure that those tests are identified, and that the ST for each
                platform contains a description of those tests. Note that the tests that are required by this
                component are those that support security functionality in this PP-Module, which may not
                correspond to the set of all self-tests contained in the platform STs.<h:p/>

                The evaluator shall examine the TSS to ensure that it describes how the integrity of stored TSF
                executable code is cryptographically verified when it is loaded for execution. The evaluator shall
                ensure that the TSS makes an argument that the tests are sufficient to demonstrate that the
                integrity of stored TSF executable code has not been compromised. The evaluator shall check to
                ensure that the cryptographic requirements listed are consistent with the description of the integrity
                verification process.<h:p/>

                The evaluator also ensures that the TSS (or the operational guidance) describes the actions that take
                place for successful (e.g. hash verified) and unsuccessful (e.g., hash not verified) cases. For checks
                implemented entirely by the platform, the evaluator ensures that the operational guidance for the
                TOE references or includes the platform-specific guidance for each platform listed in the ST.<h:p/>
              </TSS>
              <Guidance>If not present in the TSS, the evaluator ensures that the operational guidance describes the actions
                that take place for successful (e.g. hash verified) and unsuccessful (e.g., hash not verified) cases. For
                checks implemented entirely by the platform, the evaluator ensures that the operational guidance
                for the TOE references or includes the platform-specific guidance for each platform listed in the ST.<h:p/>
              </Guidance>
              <Tests>
                The evaluator shall perform the following tests:
                <testlist>
                  <test>The evaluator performs the integrity check on a known good TSF executable and verifies that
                    the check is successful.
                  </test>
                  <test>The evaluator modifies the TSF executable, performs the integrity check on the modified TSF
                    executable and verifies that the check fails.</test>
                </testlist>
              </Tests>
            </aactivity>
          </f-element>
		  <audit-event/>
        </f-component>
      </subsection>
    </man-sfrs>

	<!-- Appendix A.1: Strictly Optional Requirements -->
    <opt-sfrs>
     <!-- No optional SFRs 
		There are currently no strictly optional requirements defined by this PP-Module.-->
    </opt-sfrs>

	<!-- Appendix B: Selection-Based Requirements -->
	<!-- I don't understand why these are in a separate section in Modules but not anywhere else. -->
    <sel-sfrs>
	
	  <!-- B.1 Identification and Authentication (FIA) -->
      <subsection title="Identification and Authentication (FIA)" id="s-fia">
		<description>
			The TOE may support pre-shared keys for use in the IPsec protocol, and may use pre-shared keys in
			other protocols as well. There are two types of pre-shared keys that must be supported by the TOE, as
			specified in the requirements below. The first type is referred to as “text-based pre-shared keys,” which
			refer to pre-shared keys that are entered by users as a string of characters from a standard character
			set, similar to a password. Such pre-shared keys must be conditioned so that the string of characters is
			transformed into a string of bits, which is then used as the key.<h:p/>
			The second type is referred to as “bit-based pre-shared keys” (for lack of a standard term); this refers to
			keys that are either generated by the TSF on a command from the administrator, or input in "direct
			form" by an administrator. "Direct form" means that the input is used directly as the key, with no
			"conditioning" as was the case for text-based pre-shared keys. An example would be a string of hex
			digits that represent the bits that comprise the key.<h:p/>
			The requirements below mandate that the TOE support text-based pre-shared keys. Bit-based preshared keys may or may not be supported, and if they are, generation of these keys may be done either
			by the TOE or in the operational environment.
		</description>
	  
        <ext-comp-def title="Pre-Shared Key Composition" fam-id="FIA_PSK_EXT">
          <fam-behavior>Components in this family describes the requirements for pre-shared keys when implementing IPsec</fam-behavior>
        </ext-comp-def>
		
		<!-- FIA_PSK_EXT.1 Pre-Shared Key Composition -->
        <f-component cc-id="fia_psk_ext.1" id="fia-psk-ext-1" name="Pre-Shared Key Composition" status="sel-based">
          <selection-depends req="fcs-ipsec-ext-1e11" ids="sel-ipsec-e11-psk"/>
          <consistency-rationale/>
          <comp-lev>defines the use and composition of pre-shared keys used for IPsec</comp-lev>
          <management>No specific management functions are identified.</management>
          <audit>The following actions should be auditable if FAU_GEN Security Audit Data Generation is included in the
            PP/ST:<h:ul>
              <h:li>Failure of the randomization process</h:li>
            </h:ul>
          </audit>
          <dependencies>FCS_RBG_EXT.1 Random Bit Generation</dependencies>
          <f-element id="fia-psk-ext-1e1">
            <title>
				The TSF shall be able to use pre-shared keys for IPsec.
            </title>
          </f-element>
          <f-element id="fia-psk-ext-1e2">
            <title>The TSF shall be able to accept text-based pre-shared keys that: 
				<h:ul>
					<h:li>Are 22 characters and 
						<selectables>
							<selectable><assignable>other supported lengths</assignable></selectable>
							<selectable>no other lengths</selectable>
							</selectables>,</h:li>
					<h:li>Composed of any combination of upper and lower case letters, numbers,
						and special characters (that include: “!”, “@”, “#”, “$”, “%”, “^”, “&amp;”, “*”,
						“(“, “)”, and 
						<selectables>
							<selectable>no other special characters</selectable>
							<selectable><assignable>list of additional supported special characters</assignable></selectable>
						</selectables>.</h:li>
				</h:ul>
            </title>
          </f-element>
          <f-element id="fia-psk-ext-1e3">
            <title>
              The TSF shall condition the text-based pre-shared keys by using 
			  <selectables>
                <selectable>SHA-1</selectable>
                <selectable>SHA-256</selectable>
                <selectable>SHA-512</selectable>
                <selectable><assignable>method of conditioning text string</assignable></selectable>
              </selectables>, 
			  <selectables>
                <selectable>be able to 
					<selectables>
						<selectable>accept</selectable>
						<selectable>generate using the random bit generator specified in FCS_RBG_EXT.1</selectable>
					</selectables></selectable>
                <selectable>perform no other conditioning</selectable>
              </selectables>.
            </title>
            <note role="application">
				This SFR is claimed if “pre-shared keys” is selected in FCS_IPSEC_EXT.1.11.<h:p/>
				For the length of the text-based pre-shared keys, a common length (22
				characters) is required to help promote interoperability. If other lengths are
				supported they should be listed in the assignment; this assignment can also
				specify a range of values (e.g., "lengths from 5 to 55 characters") as well.<h:p/>

				For FIA_PSK_EXT.1.3, the ST author fills in the method by which the text string
				entered by the administrator is “conditioned” into the bit string used as the key.
				This can be done by using one of the specified hash functions, or some other
				method through the assignment statement. If “bit-based pre-shared keys” is
				selected, the ST author specifies whether the TSF merely accepts bit-based preshared keys, 
				or is capable of generating them. If it generates them, the
				requirement specified that they must be generated using the RBG specified by
				the requirements. If the TOE does not use bit-based pre-shared keys, the second
				selection should be completed with “perform no other conditioning,” as textbased pre-shared 
				keys would then be the only type used.<h:p/>
			</note>
            <aactivity>
              <TSS>The evaluator shall also examine the TSS to ensure it describes the process by which the bit-based
                pre-shared keys are generated (if the TOE supports this functionality), and confirm that this process
                uses the RBG specified in FCS_RBG_EXT.1.<h:p/>
                <h:b>Requirement met by the platform</h:b><h:p/>
                For each platform listed in the ST, the evaluator shall examine the ST of the platform to ensure that
                the functions associated with pre-shared keys claimed in that platform's ST contains the same
                functions specified in the VPN Client's ST. If the TOE does not perform any management or input of
                the pre-shared keys then no further activity is required.<h:p/>
                <h:b>Requirement met by the TOE</h:b><h:p/>
                The evaluator shall examine the TSS to ensure that it states that text-based pre-shared keys of 22
                characters are supported. The evaluator shall also confirm that the TSS states the conditioning that
                takes place to transform the text-based pre-shared key from the key sequence entered by the user
                (e.g., ASCII representation) to the bit string used by IPsec, and that this conditioning is consistent
                with the claims made in FIA_PSK_EXT.1.3.<h:p/>
              </TSS>
              <Guidance>If the TOE supports bit-based pre-shared keys, the evaluator shall confirm the operational guidance
                contains instructions for either entering bit-based pre- shared keys for each protocol identified in
                the requirement, or generating a bit-based pre-shared key (or both). The evaluator shall also
                examine the TSS to ensure it describes the process by which the bit-based pre-shared keys are
                generated (if the TOE supports this functionality), and confirm that this process uses the RBG
                specified in FCS_RBG_EXT.1.<h:p/>
                The evaluator shall check that any management functions related to pre-shared keys that are
                performed by the TOE are specified in the operational guidance.<h:p/>
                <h:b>Requirement met by the TOE</h:b><h:p/>
                The evaluator shall examine the operational guidance to determine that it provides guidance on the
                composition of strong text-based pre-shared keys, and (if the selection indicates keys of various
                lengths can be entered) that it provides information on the merits of shorter or longer pre-shared
                keys. The guidance must specify the allowable characters for pre-shared keys, and that list must
                include, at minimum, the same items contained in FIA_PSK_EXT.1.2.<h:p/>
              </Guidance>
              <Tests>The evaluator shall perform the following tests:
              <testlist>
                <test>The evaluator shall compose a pre-shared key of 22 characters that contains a combination of
                  the allowed characters in accordance with the operational guidance, and demonstrates that a
                  successful protocol negotiation can be performed with the key.</test>
                <test>[conditional]: If the TOE supports pre-shared keys of multiple lengths, the evaluator shall
                  repeat Test 1 using the minimum length; the maximum length; and invalid lengths that are below
                  the minimum length, above the maximum length, null length, empty length, or zero length. The
                  minimum and maximum length tests should be successful, and the invalid lengths must be rejected
                  by the TOE.
                </test>
                <test>[conditional]: If the TOE supports but does not generate bit-based pre-shared keys, the
                  evaluator shall obtain a bit-based pre-shared key of the appropriate length and enter it per the
                  instructions in the operational guidance. The evaluator shall then demonstrate that a successful
                  protocol negotiation can be performed with the key.</test>
                <test>[conditional]: If the TOE does generate bit-based pre-shared keys, the evaluator shall generate
                  a bit-based pre-shared key of the appropriate length and use it according to the instructions in the
                  operational guidance. The evaluator shall then demonstrate that a successful protocol negotiation
                  can be performed with the key.</test>
              </testlist>
              </Tests>
            </aactivity>
          </f-element>
		  <audit-event/>
        </f-component>
      </subsection>
    </sel-sfrs>


	<!-- Appendix A.2: Objective Requirements -->
    <obj-sfrs>
	
	  <!-- Appendix A.2.1 Security Audit (FAU) -->
      <subsection title="Security Audit (FAU)" id="ob-fau">
	  
		<!-- A.2.1.1 FAU_GEN.1/VPN Audit Data Generation (VPN Client) -->
        <f-component name="Audit Data Generation" cc-id="fau_gen.1" iteration="VPN" id="fau-gen-1-vpn" status="objective">
          <consistency-rationale></consistency-rationale>
          <f-element id="fau-gen-1e1-vpn">
            <title>
				The TSF <h:b>and 
				<selectables>
					<selectable>TOE platform</selectable>
					<selectable>no other component</selectable>
				</selectables></h:b> 
				shall be able to generate an audit record of the following auditable events: 
				<h:ol type="a">
					<h:li>Start-up and shutdown of the audit functions;</h:li>
					<h:li>All auditable events for the [<h:i>not specified</h:i>] level of audit;</h:li>
					<h:li>All administrative actions;</h:li>
					<h:li>[<h:i>Specifically defined auditable events listed in <h:b>the Auditable Events tables</h:b></h:i>].</h:li> <!-- TODO: check this reference -->
				</h:ol>
<!-- QQQQ
              <h:table>
                <h:caption>Table C-1: Auditable Events</h:caption>
                <h:tr>
                  <h:th>Requirement</h:th>
                  <h:th>Auditable Events</h:th>
                  <h:th>Additional Audit Record Contents</h:th>
                </h:tr>
                <h:tr>
                  <h:td>FAU_SEL.1</h:td>
                  <h:td>All modifications to the audit configuration that occur while the audit collection functions are operating.</h:td>
                  <h:td>None.</h:td>
                </h:tr>
                <h:tr>
                  <h:td rowspan="3">FCS_IPSEC_EXT.1</h:td>
                  <h:td>Decisions to DISCARD or BYPASS network packets processed by the TOE.</h:td>
                  <h:td>Presumed identity of source subject.<h:p/>
                    Identity of destination subject.<h:p/>
                    Transport layer protocol, if applicable.<h:p/>
                    Source subject service identifier, if applicable.
                    <h:p/>The entry in the SPD that applied to the decision.</h:td>
                </h:tr>
                <h:tr>
                  <h:td>Failure to establish an IPsec SA.</h:td>
                  <h:td>Reason for failure.<h:p/>
                    Non-TOE endpoint of connection (IP address).</h:td>
                </h:tr>
                <h:tr>
                  <h:td>Establishment/Termination of an IPsec SA.</h:td>
                  <h:td>Non-TOE endpoint of connection (IP address).</h:td>
                </h:tr>
                <h:tr>
                  <h:td>FCS_RBG_EXT.1</h:td>
                  <h:td>Failure of the randomization process (Optional).</h:td>
                  <h:td>None.</h:td>
                </h:tr>
                <h:tr>
                  <h:td>FDP_RIP.2</h:td>
                  <h:td colspan="2">None.</h:td>
                </h:tr>
                <h:tr>
                  <h:td>FMT_SMF.1/VPN</h:td>
                  <h:td>Success or failure of management function.</h:td>
                  <h:td>None.</h:td>
                </h:tr>
                <h:tr>
                  <h:td rowspan="2">FPT_TUD_EXT.1</h:td>
                  <h:td>Initiation of the update.</h:td>
                  <h:td>None.</h:td>
                </h:tr>
                <h:tr>
                  <h:td>Any failure to verify the integrity of the update.</h:td>
                  <h:td>None.</h:td>
                </h:tr>
              </h:table>
-->
            </title>
            <note role="application">
				In the case of "a", the audit functions referred to are those provided by the TOE.
				For example, in the case that the TOE was a stand-alone executable, auditing
				the startup and the shutdown of the TOE itself would be sufficient to meet the
				requirements of this clause. <h:p/>
				Many auditable aspects of the SFRs included in this document deal with
				administrative actions. Item c above requires all administrative actions to be
				auditable, so no additional specification of the auditability of these actions is
				present in the Auditable Events table. While the TOE itself does not need to
				provide the ability to perform I&amp;A for an administrator, this requirement implies
				that the TOE possess the capability to audit the events described by the Base-PP
				as "administrative actions" (primarily dealing with configuration of the
				functionality provided by the TOE). <h:p/>
				The auditable events defined in the Auditable Events table are for the SFRs that
				are explicitly defined in this PP-Module. For any SFRs that are included as part of
				the TOE based on the claimed Base-PP, it is expected that any applicable
				auditable events defined for those SFRs in the Base-PP are also claimed as part
				of the TSF. These auditable events only apply if the client actually performs these
				functions. If the platform performs any of these actions, then the platform is
				responsible for performing the auditing, not the TSF<h:p/>
	      </note>
          </f-element>
          <f-element id="fau-gen-1e2-vpn">
            <title>The TSF <h:b>and 
				<selectables>
					<selectable>TOE platform</selectable>
					<selectable>no other component</selectable>
				</selectables></h:b> 
				shall record within each audit record at least the following information: 
				<h:ol type="a">
					<h:li>Date and time of the event, type of event, subject identity, and the outcome
						(success or failure) of the event; and</h:li>
					<h:li>For each audit event type, based on the auditable event definitions of the
						functional components included in the PP-Module/ST, [<h:i>information
						specified in column three of  Auditable Events table</h:i>].</h:li>
				</h:ol>
            </title>
            <aactivity>
              <TSS>The evaluator shall examine the TSS to determine that it describes the auditable events and the
                component that is responsible for each type of auditable event.<h:p/></TSS>
              <Guidance>The evaluator shall check the operational guidance and ensure that it lists all of the auditable events
                and provides a format for audit records. Each audit record format type must be covered, along with
                a brief description of each field. The evaluator shall check to make sure that every audit event type
                mandated by the PP-Module is described and that the description of the fields contains the
                information required in FAU_GEN.1.2, and the additional information specified in Table C-1 of the
                PP-Module.<h:p/>

                In particular, the evaluator shall ensure that the operational guidance is clear in relation to the
                contents for failed cryptographic events. In Table C-1 of the PP-Module, information detailing the
                cryptographic mode of operation and a name or identifier for the object being encrypted is required.
                The evaluator shall ensure that name or identifier is sufficient to allow an administrator reviewing
                the audit log to determine the context of the cryptographic operation (for example, performed
                during a key negotiation exchange, performed when encrypting data for transit) as well as the non-TOE endpoint of the connection for cryptographic failures relating to communications with other IT
                systems.<h:p/>

                The evaluator shall also make a determination of the administrative actions that are relevant in the
                context of this PP-Module. The TOE may contain functionality that is not evaluated in the context of
                this PP-Module because the functionality is not specified in an SFR. This functionality may have
                administrative aspects that are described in the operational guidance. Since such administrative
                actions will not be performed in an evaluated configuration of the TOE, the evaluator shall examine
                the operational guidance and make a determination of which administrative commands, including
                subcommands, scripts, and configuration files, are related to the configuration (including enabling or
                disabling) of the mechanisms implemented in the TOE that are necessary to enforce the
                requirements specified in the PP-Module, which thus form the set of “all administrative actions.”
                The evaluator may perform this activity as part of the activities associated with ensuring the
                operational guidance satisfies the requirements.<h:p/></Guidance>
              <Tests>The evaluator shall test the TOE’s ability to correctly generate audit records by having the TOE
                generate audit records in accordance with the evaluation activities associated with the functional
                requirements in this PP-Module. Additionally, the evaluator shall test that each administrative action
                applicable in the context of this PP-Module is auditable. When verifying the test results, the
                evaluator shall ensure the audit records generated during testing match the format specified in the
                administrative guide, and that the fields in each audit record have the proper entries.<h:p/>

              Note that the testing here can be accomplished in conjunction with the testing of the security
              mechanisms directly. For example, testing performed to ensure that the administrative guidance
              provided is correct verifies that AGD_OPE.1 is satisfied and should address the invocation of the
              administrative actions that are needed to verify the audit records are generated as expected.
              </Tests>
            </aactivity>
          </f-element>
		  <audit-event/>
        </f-component>
		
	<!-- A.2.1.2 FAU_SEL.1/VPN Selective Audit (VPN Client) -->
        <f-component name="Selective Audit" cc-id="fau_sel.1" iteration="VPN" id="fau-sel-1-vpn" status="objective">
          <consistency-rationale></consistency-rationale>
          <f-element>
            <title>
              The <h:b>
				<selectables>
					<selectable>TSF</selectable>
					<selectable>TOE platform</selectable>
				</selectables></h:b> 
				shall be able to select the set of events to be audited from the set of all auditable events based on
				the following attributes:
				[<h:i>event type, [success of auditable security events, failure of auditable security events], 
				<assignable>list of additional attributes that audit selectivity is based upon</assignable></h:i>].
            </title>
            <note role="application">
				The intent of this requirement is to identify all criteria that can be selected to
				trigger an audit event. This can be configured through an interface on the client
				for a user/administrator to invoke, or it could be an interface that the VPN
				gateway uses to instruct the client on which events are to be audited. For the ST
				author, the assignment is used to list any additional criteria or “none”. The
				auditable event types are listed in the Auditable Events table<h:p/>
				The intent of the first selection is to allow for the case where the underlying
				platform is responsible for some audit log generation functionality.
            </note>
            <aactivity>
              <TSS>There are no TSS evaluation activities for this component.<h:p/></TSS>
              <Guidance>The evaluator shall review the administrative guidance to ensure that the guidance itemizes all event
                types, as well as describes all attributes that are to be selectable in accordance with the
                requirement, to include those attributes listed in the assignment. The administrative guidance shall
                also contain instructions on how to set the pre-selection, or how the VPN gateway will configure the
                client, as well as explain the syntax (if present) for multi-value pre-selection. The administrative
                guidance shall also identify those audit records that are always recorded, regardless of the selection
                criteria currently being enforced.<h:p/></Guidance>
              <Tests>The evaluator shall perform the following tests:
              <testlist>
                <test>For each attribute listed in the requirement, the evaluator shall devise a test to show that
                  selecting the attribute causes only audit events with that attribute (or those that are always
                  recorded, as identified in the administrative guidance) to be recorded.
                </test>
                <test>[conditional]: If the TSF supports specification of more complex audit pre-selection criteria
                  (e.g., multiple attributes, logical expressions using attributes) then the evaluator shall devise tests
                  showing that this capability is correctly implemented. The evaluator shall also, in the test plan,
                  provide a short narrative justifying the set of tests as representative and sufficient to exercise the
                  capability.
                </test>
              </testlist>
              </Tests>
            </aactivity>
          </f-element>
	  <audit-event>
		  <audit-event-descr>All modifications to the audit configuration
			that occur while the audit collection functions are operating.</audit-event-descr> 
	  </audit-event>
        </f-component>
      </subsection>

	  <!-- A.2.2 User Data Protection (FDP) -->
      <subsection title="User Data Protection (FDP)" id="ob-fdp">
        <ext-comp-def title="Subset Information Flow Control" fam-id="FDP_IFC_EXT">
          <fam-behavior>Components in this family describe the requirements that pertain to IP traffic and information flow
            through the VPN client.</fam-behavior>
        </ext-comp-def>
		
		<!-- A.2.2.1 FDP_IFC_EXT.1 Subset Information Flow Control -->
        <f-component cc-id="fdp_ifc_ext.1" id="fdp-ifc-ext-1" name="Subset Information Flow Control">
          <consistency-rationale/>
          <comp-lev>requires the TSF to process all IP traffic through its VPN client
            functionality.</comp-lev>
          <management>No specific management functions are identified.
          </management>
          <audit>There are no auditable events foreseen.
          </audit>
          <dependencies>No dependencies</dependencies>
          <f-element id="fdp-ifc-ext-1e1">
            <title>
				The TSF shall ensure that all IP traffic (other than IP traffic required to establish
				the VPN connection) flow through the IPsec VPN client. 
			</title>
            <note role="application">
				This requirement is used when the VPN client is able to enforce the requirement
				through its own components. This generally will have to be done through using
				hooks provided by the platform such that the TOE is able to ensure that no IP
				traffic can flow through other network interfaces.
			</note>
            <aactivity>
              <TSS>The evaluator shall verify that the TSS section of the ST describes the routing of IP traffic through
                processes on the TSF when a VPN client is enabled. The evaluator shall ensure that the description
                indicates which traffic does not go through the VPN and which traffic does and that a configuration
                exists for each baseband protocol in which only the traffic identified by the ST author as necessary
                for establishing the VPN connection (IKE traffic and perhaps HTTPS or DNS traffic) is not
                encapsulated by the VPN protocol (IPsec). The ST author shall also identify in the TSS section any
                differences in the routing of IP traffic when using any supported baseband protocols (e.g. WiFi or
                LTE).<h:p/>
              </TSS>
              <Guidance>The evaluator shall verify that the following is addressed by the documentation:
                <h:ul>
                <h:li>The description above indicates that if a VPN client is enabled, all configurations route all
                IP traffic (other than IP traffic required to establish the VPN connection) through the
                VPN client.</h:li>
                <h:li>The operational guidance describes how the user and/or administrator can configure the TSF to
                  meet this requirement.</h:li>
                </h:ul><h:p/>
              </Guidance>
              <Tests>
                The evaluator shall perform the following test:<h:p/>
                Step 1 - The evaluator shall use the platform to enable a network connection without using IPsec.
                The evaluator shall use a packet sniffing tool between the platform and an Internet-connected
                network. The evaluator shall turn on the sniffing tool and perform actions with the device such as
                navigating to websites, using provided applications, accessing other Internet resources (Use Case 1),
                accessing another VPN client (Use Case 2), or accessing an IPsec-capable network device (Use Case
                3). The evaluator shall verify that the sniffing tool captures the traffic generated by these actions,
                turn off the sniffing tool, and save the session data.<h:p/>
                Step 2 - The evaluator shall configure an IPsec VPN client that supports the routing specified in this
                requirement, and if necessary, configure the device to perform the routing specified as described in
                the AGD guidance. The evaluator shall turn on the sniffing tool, establish the VPN connection, and
                perform the same actions with the device as performed in the first step. The evaluator shall verify
                that the sniffing tool captures traffic generated by these actions, turn off the sniffing tool, and save
                the session data.<h:p/>
                Step 3 - The evaluator shall examine the traffic from both step one and step two to verify that all IP
                traffic, aside from and after traffic necessary for establishing the VPN (such as IKE, DNS, and possibly
                HTTPS), is encapsulated by IPsec.<h:p/>
                Step 4 - The evaluator shall attempt to send packets to the TOE outside the VPN connection and
                shall verify that the TOE discards them.
              </Tests>
            </aactivity>
          </f-element>
	  <audit-event/>
        </f-component>
      </subsection>
    </obj-sfrs>
  </chapter>
  
  
  <bibliography>
    <cc-entry/>
    <entry id="bibOSPP">
      <tag>OS PP</tag>
      <description>
        <h:a href="https://www.niap-ccevs.org/Profile/Info.cfm?PPID=442&amp;id=442/">
			Protection Profile for General Purpose Operating Systems</h:a>, Version 4.2.1, April 2019
      </description>
    </entry>

    <entry id="bibMDPP">
      <tag>MD PP</tag>
      <description>
        <h:a href="https://www.niap-ccevs.org/Profile/Info.cfm?PPID=417&amp;id=417">
			Protection Profile for Mobile Device Fundamentals</h:a>, Version 3.1, June 2017
      </description>
    </entry>

    <entry id="bibMDMPP">
      <tag>MDM PP</tag>
      <description>
        <h:a href="https://www.niap-ccevs.org/Profile/Info.cfm?PPID=417&amp;id=417">
			Protection Profile for Mobile Device Management (This needs to be updated) </h:a>, Version 3.1, June 2017
      </description>
    </entry>

    <entry id="bibAppPP">
      <tag>App PP</tag>
      <description>
        <h:a href="https://www.niap-ccevs.org/Profile/Info.cfm?PPID=429&amp;id=429/">
			Protection Profile for Application Software</h:a>, Version 1.3, March 2019
      </description>
    </entry>

    <entry id="bibSD"> <!-- TODO: Not sure if this is even necessary or if the 'combined' document is going to be the primary one used -->
      <tag>SD</tag>
      <description>
        Supporting Document Mandatory Technical Document, PP-Module for Virtual Private Network (VPN) Clients, 
			Version 2.1, November 2019
      </description>
    </entry>

	</bibliography>

	<!-- Appendix G: Acronyms -->
	<acronyms/>
</Module>

